"use strict";var v=Object.create;var l=Object.defineProperty;var y=Object.getOwnPropertyDescriptor;var S=Object.getOwnPropertyNames;var M=Object.getPrototypeOf,x=Object.prototype.hasOwnProperty;var b=(t,e)=>{for(var o in e)l(t,o,{get:e[o],enumerable:!0})},d=(t,e,o,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of S(e))!x.call(t,i)&&i!==o&&l(t,i,{get:()=>e[i],enumerable:!(r=y(e,i))||r.enumerable});return t};var R=(t,e,o)=>(o=t!=null?v(M(t)):{},d(e||!t||!t.__esModule?l(o,"default",{value:t,enumerable:!0}):o,t)),k=t=>d(l({},"__esModule",{value:!0}),t);var V={};b(V,{default:()=>N});module.exports=k(V);var n=require("@raycast/api"),c=require("react");var f=require("@raycast/api"),w=require("child_process"),p=R(require("util")),A=p.default.promisify(w.exec),D=(0,f.getPreferenceValues)(),C="/Applications/Cloudflare WARP.app/Contents/Resources/warp-cli",F=D.wrapCliPath??C;async function u(t){let{stdout:e}=await A(`"${F}" -j ${t}`);return JSON.parse(e)}async function E(){try{let{status:t}=await u("connect");if(t==="Success")return!0;throw new Error("Failed to connect")}catch(t){return console.error(t),!1}}async function T(){try{let{status:t}=await u("disconnect");if(t==="Success")return!0;throw new Error("Failed to connect")}catch(t){return console.error(t),!1}}async function g(){let t=await u("mdm get-configs");return{available:t.available,active:t.active}}async function m(t){try{if(!await T())throw new Error("Failed to disconnect");let{status:o}=await u(`mdm set-config ${t}`);if(o!=="Success")throw new Error("Failed to set MDM profile");if(!await E())throw new Error("Failed to connect");return!0}catch(e){return console.error(e),!1}}var s=require("react/jsx-runtime"),L=({profile:t,activeProfile:e,onSwitchProfile:o})=>{let r=[];return t===e&&r.push({text:"Active"}),(0,s.jsx)(n.List.Item,{id:t,title:t,accessories:r,actions:(0,s.jsx)(n.ActionPanel,{title:"Actions",children:(0,s.jsx)(n.Action,{onAction:()=>o(t),title:"Switch"})})},t)},N=()=>{let[t,e]=(0,c.useState)(!0),[o,r]=(0,c.useState)([]),[i,P]=(0,c.useState)("");(0,c.useEffect)(()=>{e(!0),g().then(a=>{r(a.available),P(a.active)}).finally(()=>e(!1))},[]);let h=async a=>{await m(a)?await(0,n.showHUD)("Switched MDM Profile",{clearRootSearch:!0,popToRootType:n.PopToRootType.Immediate}):await(0,n.showToast)({style:n.Toast.Style.Failure,title:"Failed to switch MDM Profile"})};return!t&&o.length===0?(0,s.jsx)(n.List,{searchBarPlaceholder:"Search Profiles",isLoading:t,children:(0,s.jsx)(n.List.EmptyView,{title:"No MDM Profiles found"})}):(0,s.jsx)(n.List,{searchBarPlaceholder:"Search Profiles",isLoading:t,children:o.map(a=>(0,s.jsx)(L,{profile:a,activeProfile:i,onSwitchProfile:h},a))})};
