{
  "version": 3,
  "sources": ["../src/switch-mdm-profile.tsx", "../src/lib.ts"],
  "sourcesContent": ["import { Action, ActionPanel, List, PopToRootType, Toast, showHUD, showToast } from \"@raycast/api\";\nimport { useEffect, useState } from \"react\";\nimport { getMDMProfiles, setMDMProfile } from \"./lib\";\n\nconst ListItem = ({\n  profile,\n  activeProfile,\n  onSwitchProfile,\n}: {\n  profile: string;\n  activeProfile: string;\n  onSwitchProfile: (profile: string) => void;\n}) => {\n  const accessories = [];\n  if (profile === activeProfile) {\n    accessories.push({ text: \"Active\" });\n  }\n\n  return (\n    <List.Item\n      key={profile}\n      id={profile}\n      title={profile}\n      accessories={accessories}\n      actions={\n        <ActionPanel title=\"Actions\">\n          <Action onAction={() => onSwitchProfile(profile)} title=\"Switch\" />\n        </ActionPanel>\n      }\n    />\n  );\n};\n\nexport default () => {\n  const [isLoading, setIsLoading] = useState(true);\n  const [availableProfiles, setAvailableProfiles] = useState<string[]>([]);\n  const [activeProfile, setActiveProfile] = useState<string>(\"\");\n\n  useEffect(() => {\n    setIsLoading(true);\n    getMDMProfiles()\n      .then((res) => {\n        setAvailableProfiles(res.available);\n        setActiveProfile(res.active);\n      })\n      .finally(() => setIsLoading(false));\n  }, []);\n\n  const onSwitchProfile = async (profile: string) => {\n    const result = await setMDMProfile(profile);\n    if (result) {\n      await showHUD(\"Switched MDM Profile\", {\n        clearRootSearch: true,\n        popToRootType: PopToRootType.Immediate,\n      });\n    } else {\n      await showToast({\n        style: Toast.Style.Failure,\n        title: \"Failed to switch MDM Profile\",\n      });\n    }\n  };\n\n  if (!isLoading && availableProfiles.length === 0) {\n    return (\n      <List searchBarPlaceholder=\"Search Profiles\" isLoading={isLoading}>\n        <List.EmptyView title=\"No MDM Profiles found\" />\n      </List>\n    );\n  }\n\n  return (\n    <List searchBarPlaceholder=\"Search Profiles\" isLoading={isLoading}>\n      {availableProfiles.map((profile) => (\n        <ListItem key={profile} profile={profile} activeProfile={activeProfile} onSwitchProfile={onSwitchProfile} />\n      ))}\n    </List>\n  );\n};\n", "import { getPreferenceValues } from \"@raycast/api\";\nimport { exec } from \"child_process\";\nimport util from \"util\";\nconst execPromise = util.promisify(exec);\n\nconst preferences: { wrapCliPath: string } = getPreferenceValues();\nconst DEFAULT_WRAP_CLI_PATH = \"/Applications/Cloudflare WARP.app/Contents/Resources/warp-cli\";\nconst wrapCliCmd = preferences.wrapCliPath ?? DEFAULT_WRAP_CLI_PATH;\n\nexport async function execCommand<T>(cmd: string): Promise<T> {\n  const { stdout } = await execPromise(`\"${wrapCliCmd}\" -j ${cmd}`);\n  return JSON.parse(stdout);\n}\n\nexport async function connectToWarp(): Promise<boolean> {\n  try {\n    const { status } = await execCommand<{ status: string }>(\"connect\");\n    if (status === \"Success\") {\n      return true;\n    }\n    throw new Error(\"Failed to connect\");\n  } catch (e) {\n    console.error(e);\n    return false;\n  }\n}\n\nexport async function disconnectFromWarp(): Promise<boolean> {\n  try {\n    const { status } = await execCommand<{ status: string }>(\"disconnect\");\n    if (status === \"Success\") {\n      return true;\n    }\n    throw new Error(\"Failed to connect\");\n  } catch (e) {\n    console.error(e);\n    return false;\n  }\n}\n\nexport enum ConnectionStatus {\n  Connected = \"connected\",\n  Disconnected = \"disconnected\",\n  Unknown = \"unknown\",\n}\nexport type StatusResult = {\n  status: ConnectionStatus;\n  disconnectReason: string;\n};\nexport async function getWarpStatus(): Promise<StatusResult> {\n  const { status, reason } = await execCommand<{ status: string; reason?: string }>(\"status\");\n  if (status === \"Disconnected\") {\n    return { status: ConnectionStatus.Disconnected, disconnectReason: reason ?? \"unknown\" };\n  }\n  if (status === \"Connected\") {\n    return { status: ConnectionStatus.Connected, disconnectReason: \"\" };\n  }\n  return { status: ConnectionStatus.Unknown, disconnectReason: \"unknown\" };\n}\n\nexport type VirtualNetwork = {\n  id: string;\n  name: string;\n  description: string;\n  default: boolean;\n  active: boolean;\n};\n\ntype VNetResult = {\n  active_vnet_id: string;\n  virtual_networks: {\n    id: string;\n    name: string;\n    description: string;\n    default: boolean;\n  }[];\n};\nexport async function getVirtualNetworks(): Promise<VirtualNetwork[]> {\n  const { active_vnet_id: activeVnetId, virtual_networks: virtualNetwork } = await execCommand<VNetResult>(\"vnet\");\n  const networks = virtualNetwork.map((network) => {\n    return {\n      id: network.id,\n      name: network.name,\n      description: network.description,\n      default: network.default,\n      active: network.id === activeVnetId,\n    };\n  });\n\n  return networks;\n}\n\nexport async function switchVirtualNetwork(id: string): Promise<boolean> {\n  try {\n    const disconnected = await disconnectFromWarp();\n    if (!disconnected) {\n      throw new Error(\"Failed to disconnect\");\n    }\n    const { status } = await execCommand<{ status: string }>(`vnet ${id}`);\n    if (status !== \"Success\") {\n      throw new Error(\"Failed to switch network\");\n    }\n    const connectStatus = await connectToWarp();\n    if (!connectStatus) {\n      throw new Error(\"Failed to connect\");\n    }\n    return true;\n  } catch (e) {\n    console.error(e);\n    return false;\n  }\n}\n\nexport async function getMDMProfiles(): Promise<{ available: string[]; active: string }> {\n  const result = await execCommand<{ available: string[]; active: string }>(\"mdm get-configs\");\n  return { available: result.available, active: result.active };\n}\n\nexport async function setMDMProfile(profile: string): Promise<boolean> {\n  try {\n    const disconnected = await disconnectFromWarp();\n    if (!disconnected) {\n      throw new Error(\"Failed to disconnect\");\n    }\n    const { status } = await execCommand<{ status: string }>(`mdm set-config ${profile}`);\n    if (status !== \"Success\") {\n      throw new Error(\"Failed to set MDM profile\");\n    }\n    const connectStatus = await connectToWarp();\n    if (!connectStatus) {\n      throw new Error(\"Failed to connect\");\n    }\n    return true;\n  } catch (e) {\n    console.error(e);\n    return false;\n  }\n}\n"],
  "mappings": "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",
  "names": ["switch_mdm_profile_exports", "__export", "switch_mdm_profile_default", "__toCommonJS", "import_api", "import_react", "import_api", "import_child_process", "import_util", "execPromise", "util", "preferences", "DEFAULT_WRAP_CLI_PATH", "wrapCliCmd", "execCommand", "cmd", "stdout", "connectToWarp", "status", "e", "disconnectFromWarp", "getMDMProfiles", "result", "execCommand", "setMDMProfile", "profile", "disconnectFromWarp", "status", "connectToWarp", "import_jsx_runtime", "ListItem", "profile", "activeProfile", "onSwitchProfile", "accessories", "switch_mdm_profile_default", "isLoading", "setIsLoading", "availableProfiles", "setAvailableProfiles", "setActiveProfile", "getMDMProfiles", "res", "setMDMProfile"]
}
