"use strict";var h=Object.create;var u=Object.defineProperty;var y=Object.getOwnPropertyDescriptor;var k=Object.getOwnPropertyNames;var S=Object.getPrototypeOf,V=Object.prototype.hasOwnProperty;var P=(t,e)=>{for(var n in e)u(t,n,{get:e[n],enumerable:!0})},d=(t,e,n,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of k(e))!V.call(t,i)&&i!==n&&u(t,i,{get:()=>e[i],enumerable:!(r=y(e,i))||r.enumerable});return t};var v=(t,e,n)=>(n=t!=null?h(S(t)):{},d(e||!t||!t.__esModule?u(n,"default",{value:t,enumerable:!0}):n,t)),N=t=>d(u({},"__esModule",{value:!0}),t);var L={};P(L,{default:()=>T});module.exports=N(L);var o=require("@raycast/api"),c=require("react");var w=require("@raycast/api"),f=require("child_process"),p=v(require("util")),x=p.default.promisify(f.exec),R=(0,w.getPreferenceValues)(),b="/Applications/Cloudflare WARP.app/Contents/Resources/warp-cli",C=R.wrapCliPath??b;async function l(t){let{stdout:e}=await x(`"${C}" -j ${t}`);return JSON.parse(e)}async function F(){try{let{status:t}=await l("connect");if(t==="Success")return!0;throw new Error("Failed to connect")}catch(t){return console.error(t),!1}}async function A(){try{let{status:t}=await l("disconnect");if(t==="Success")return!0;throw new Error("Failed to connect")}catch(t){return console.error(t),!1}}async function m(){let{active_vnet_id:t,virtual_networks:e}=await l("vnet");return e.map(r=>({id:r.id,name:r.name,description:r.description,default:r.default,active:r.id===t}))}async function g(t){try{if(!await A())throw new Error("Failed to disconnect");let{status:n}=await l(`vnet ${t}`);if(n!=="Success")throw new Error("Failed to switch network");if(!await F())throw new Error("Failed to connect");return!0}catch(e){return console.error(e),!1}}var s=require("react/jsx-runtime"),E=({virtualNetwork:t,onSwitchVirtualNetwork:e})=>{let n=[];return t.active&&n.push({text:"Active"}),t.default&&n.push({text:"Default"}),(0,s.jsx)(o.List.Item,{id:t.id,title:t.name,subtitle:t.description,actions:(0,s.jsx)(o.ActionPanel,{title:"Actions",children:(0,s.jsx)(o.Action,{onAction:()=>e(t.id),title:"Switch"})}),accessories:n},t.id)},T=()=>{let[t,e]=(0,c.useState)(!0),[n,r]=(0,c.useState)([]);(0,c.useEffect)(()=>{e(!0),m().then(a=>r(a)).then(()=>e(!1))},[]);let i=async a=>{await g(a)?await(0,o.showHUD)("Switched Virtual Network",{clearRootSearch:!0,popToRootType:o.PopToRootType.Immediate}):await(0,o.showToast)({style:o.Toast.Style.Failure,title:"Failed to switch Virtual Network"})};return!t&&n.length===0?(0,s.jsxs)(o.List,{searchBarPlaceholder:"Search Virtual Networks",isLoading:t,children:[(0,s.jsx)(o.List.EmptyView,{title:"No Virtual Networks found"}),";"]}):(0,s.jsx)(o.List,{searchBarPlaceholder:"Search Virtual Networks",isLoading:t,children:n.map(a=>(0,s.jsx)(E,{virtualNetwork:a,onSwitchVirtualNetwork:i},a.id))})};
