"use strict";var za=Object.create;var Bi=Object.defineProperty;var Wa=Object.getOwnPropertyDescriptor;var ja=Object.getOwnPropertyNames;var Ha=Object.getPrototypeOf,Va=Object.prototype.hasOwnProperty;var Zn=(i,e)=>(e=Symbol[i])?e:Symbol.for("Symbol."+i),Yn=i=>{throw TypeError(i)};var Ga=(i,e)=>{for(var t in e)Bi(i,t,{get:e[t],enumerable:!0})},Xn=(i,e,t,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of ja(e))!Va.call(i,r)&&r!==t&&Bi(i,r,{get:()=>e[r],enumerable:!(s=Wa(e,r))||s.enumerable});return i};var p=(i,e,t)=>(t=i!=null?za(Ha(i)):{},Xn(e||!i||!i.__esModule?Bi(t,"default",{value:i,enumerable:!0}):t,i)),Ka=i=>Xn(Bi({},"__esModule",{value:!0}),i);var zi=(i,e,t)=>{if(e!=null){typeof e!="object"&&typeof e!="function"&&Yn("Object expected");var s,r;t&&(s=e[Zn("asyncDispose")]),s===void 0&&(s=e[Zn("dispose")],t&&(r=s)),typeof s!="function"&&Yn("Object not disposable"),r&&(s=function(){try{r.call(this)}catch(n){return Promise.reject(n)}}),i.push([t,s,e])}else t&&i.push([t]);return e},Wi=(i,e,t)=>{var s=typeof SuppressedError=="function"?SuppressedError:function(o,a,c,l){return l=Error(c),l.name="SuppressedError",l.error=o,l.suppressed=a,l},r=o=>e=t?new s(o,e,"An error was suppressed during disposal"):(t=!0,o),n=o=>{for(;o=i.pop();)try{var a=o[1]&&o[1].call(o[2]);if(o[0])return Promise.resolve(a).then(n,c=>(r(c),n()))}catch(c){r(c)}if(t)throw e};return n()};var ah={};Ga(ah,{default:()=>oh});module.exports=Ka(ah);var Vi=require("child_process"),Qt=require("@raycast/api");var Ae=require("child_process"),M=p(require("fs")),me=p(require("os")),A=p(require("path")),d=require("@raycast/api");var ot=p(require("react")),B=require("@raycast/api");var eo=p(require("node:child_process")),to=require("node:buffer"),Ot=p(require("node:stream")),io=require("node:util");var so=require("react/jsx-runtime");var or=globalThis;var ji=i=>!!i&&typeof i=="object"&&typeof i.removeListener=="function"&&typeof i.emit=="function"&&typeof i.reallyExit=="function"&&typeof i.listeners=="function"&&typeof i.kill=="function"&&typeof i.pid=="number"&&typeof i.on=="function",ar=Symbol.for("signal-exit emitter"),lr=class{constructor(){if(this.emitted={afterExit:!1,exit:!1},this.listeners={afterExit:[],exit:[]},this.count=0,this.id=Math.random(),or[ar])return or[ar];Object.defineProperty(or,ar,{value:this,writable:!1,enumerable:!1,configurable:!1})}on(e,t){this.listeners[e].push(t)}removeListener(e,t){let s=this.listeners[e],r=s.indexOf(t);r!==-1&&(r===0&&s.length===1?s.length=0:s.splice(r,1))}emit(e,t,s){if(this.emitted[e])return!1;this.emitted[e]=!0;let r=!1;for(let n of this.listeners[e])r=n(t,s)===!0||r;return e==="exit"&&(r=this.emit("afterExit",t,s)||r),r}},hr=class{onExit(){return()=>{}}load(){}unload(){}},fr=class{#e;#s;#t;#o;#n;#i;#r;#a;constructor(e){this.#e=process.platform==="win32"?"SIGINT":"SIGHUP",this.#s=new lr,this.#i={},this.#r=!1,this.#a=[],this.#a.push("SIGHUP","SIGINT","SIGTERM"),globalThis.process.platform!=="win32"&&this.#a.push("SIGALRM","SIGABRT","SIGVTALRM","SIGXCPU","SIGXFSZ","SIGUSR2","SIGTRAP","SIGSYS","SIGQUIT","SIGIOT"),globalThis.process.platform==="linux"&&this.#a.push("SIGIO","SIGPOLL","SIGPWR","SIGSTKFLT"),this.#t=e,this.#i={};for(let t of this.#a)this.#i[t]=()=>{let s=this.#t.listeners(t),{count:r}=this.#s,n=e;if(typeof n.__signal_exit_emitter__=="object"&&typeof n.__signal_exit_emitter__.count=="number"&&(r+=n.__signal_exit_emitter__.count),s.length===r){this.unload();let o=this.#s.emit("exit",null,t),a=t==="SIGHUP"?this.#e:t;o||e.kill(e.pid,a)}};this.#n=e.reallyExit,this.#o=e.emit}onExit(e,t){if(!ji(this.#t))return()=>{};this.#r===!1&&this.load();let s=t?.alwaysLast?"afterExit":"exit";return this.#s.on(s,e),()=>{this.#s.removeListener(s,e),this.#s.listeners.exit.length===0&&this.#s.listeners.afterExit.length===0&&this.unload()}}load(){if(!this.#r){this.#r=!0,this.#s.count+=1;for(let e of this.#a)try{let t=this.#i[e];t&&this.#t.on(e,t)}catch{}this.#t.emit=(e,...t)=>this.#l(e,...t),this.#t.reallyExit=e=>this.#c(e)}}unload(){this.#r&&(this.#r=!1,this.#a.forEach(e=>{let t=this.#i[e];if(!t)throw new Error("Listener not defined for signal: "+e);try{this.#t.removeListener(e,t)}catch{}}),this.#t.emit=this.#o,this.#t.reallyExit=this.#n,this.#s.count-=1)}#c(e){return ji(this.#t)?(this.#t.exitCode=e||0,this.#s.emit("exit",this.#t.exitCode,null),this.#n.call(this.#t,this.#t.exitCode)):0}#l(e,...t){let s=this.#o;if(e==="exit"&&ji(this.#t)){typeof t[0]=="number"&&(this.#t.exitCode=t[0]);let r=s.call(this.#t,e,...t);return this.#s.emit("exit",this.#t.exitCode,null),r}else return s.call(this.#t,e,...t)}},cr=null,Za=(i,e)=>(cr||(cr=ji(process)?new fr(process):new hr),cr.onExit(i,e));function Ya(i,{timeout:e}={}){let t=new Promise((a,c)=>{i.on("exit",(l,f)=>{a({exitCode:l,signal:f,timedOut:!1})}),i.on("error",l=>{c(l)}),i.stdin&&i.stdin.on("error",l=>{c(l)})}),s=Za(()=>{i.kill()});if(e===0||e===void 0)return t.finally(()=>s());let r,n=new Promise((a,c)=>{r=setTimeout(()=>{i.kill("SIGTERM"),c(Object.assign(new Error("Timed out"),{timedOut:!0,signal:"SIGTERM"}))},e)}),o=t.finally(()=>{clearTimeout(r)});return Promise.race([n,o]).finally(()=>s())}var ur=class extends Error{constructor(){super("The output is too big"),this.name="MaxBufferError"}};function Xa(i){let{encoding:e}=i,t=e==="buffer",s=new Ot.default.PassThrough({objectMode:!1});e&&e!=="buffer"&&s.setEncoding(e);let r=0,n=[];return s.on("data",o=>{n.push(o),r+=o.length}),s.getBufferedValue=()=>t?Buffer.concat(n,r):n.join(""),s.getBufferedLength=()=>r,s}async function Jn(i,e){let t=Xa(e);return await new Promise((s,r)=>{let n=o=>{o&&t.getBufferedLength()<=to.constants.MAX_LENGTH&&(o.bufferedData=t.getBufferedValue()),r(o)};(async()=>{try{await(0,io.promisify)(Ot.default.pipeline)(i,t),s()}catch(o){n(o)}})(),t.on("data",()=>{t.getBufferedLength()>8e7&&n(new ur)})}),t.getBufferedValue()}async function qn(i,e){i.destroy();try{return await e}catch(t){return t.bufferedData}}async function Ja({stdout:i,stderr:e},{encoding:t},s){let r=Jn(i,{encoding:t}),n=Jn(e,{encoding:t});try{return await Promise.all([s,r,n])}catch(o){return Promise.all([{error:o,exitCode:null,signal:o.signal,timedOut:o.timedOut||!1},qn(i,r),qn(e,n)])}}function qa(i){let e=typeof i=="string"?`
`:10,t=typeof i=="string"?"\r":13;return i[i.length-1]===e&&(i=i.slice(0,-1)),i[i.length-1]===t&&(i=i.slice(0,-1)),i}function Qn(i,e){return i.stripFinalNewline?qa(e):e}function Qa({timedOut:i,timeout:e,signal:t,exitCode:s}){return i?`timed out after ${e} milliseconds`:t!=null?`was killed with ${t}`:s!=null?`failed with exit code ${s}`:"failed"}function ec({stdout:i,stderr:e,error:t,signal:s,exitCode:r,command:n,timedOut:o,options:a,parentError:c}){let f=`Command ${Qa({timedOut:o,timeout:a?.timeout,signal:s,exitCode:r})}: ${n}`,h=t?`${f}
${t.message}`:f,m=[h,e,i].filter(Boolean).join(`
`);return t?t.originalMessage=t.message:t=c,t.message=m,t.shortMessage=h,t.command=n,t.exitCode=r,t.signal=s,t.stdout=i,t.stderr=e,"bufferedData"in t&&delete t.bufferedData,t}function tc({stdout:i,stderr:e,error:t,exitCode:s,signal:r,timedOut:n,command:o,options:a,parentError:c}){if(t||s!==0||r!==null)throw ec({error:t,exitCode:s,signal:r,stdout:i,stderr:e,command:o,timedOut:n,options:a,parentError:c});return i}async function _e(i,e,t){if(process.platform!=="darwin")throw new Error("AppleScript is only supported on macOS");let{humanReadableOutput:s,language:r,timeout:n,...o}=Array.isArray(e)?t||{}:e||{},a=s!==!1?[]:["-ss"];r==="JavaScript"&&a.push("-l","JavaScript"),Array.isArray(e)&&a.push("-",...e);let c=eo.default.spawn("osascript",a,{...o,env:{PATH:"/usr/local/bin:/usr/bin:/bin:/usr/sbin:/sbin"}}),l=Ya(c,{timeout:n??1e4});c.stdin.end(i);let[{error:f,exitCode:h,signal:m,timedOut:S},T,w]=await Ja(c,{encoding:"utf8"},l),U=Qn({stripFinalNewline:!0},T),k=Qn({stripFinalNewline:!0},w);return tc({stdout:U,stderr:k,error:f,exitCode:h,signal:m,timedOut:S,command:"osascript",options:t,parentError:new Error})}var vt=require("child_process"),Y=require("@raycast/api");var ro=require("fs");async function ic(){let i="";try{i=(0,vt.execSync)(`/bin/zsh -lc 'realpath "$(which brew)"'`).toString().trim()}catch(e){console.error(e)}if(i==="")return await(0,Y.showToast)({title:"Homebrew is required to install the AVIF encoder.",message:"Please install Homebrew and try again. Visit https://brew.sh for more information. Once Homebrew is installed, run the command `brew install libavif` to install the AVIF encoder manually (Otherwise, this command will be run automatically).",style:Y.Toast.Style.Failure}),!1;if(await(0,Y.confirmAlert)({title:"Install AVIF Encoder",message:"The libavif Homebrew formula is required to convert images to/from AVIF format. Would you like to install it now?",primaryAction:{title:"Install"}})){let e=await(0,Y.showToast)({title:"Installing AVIF Encoder...",style:Y.Toast.Style.Animated});try{if((0,vt.execSync)(`/bin/zsh -ilc '${i} install --quiet libavif || true'`),!sc())throw new Error("The avifenc binary has not been added to the user's $PATH");return e.title="AVIF Encoder installed successfully!",e.style=Y.Toast.Style.Success,!0}catch(t){console.error(t),ie("Failed to install AVIF Encoder.",t,e,"If you previously attempted to install libavif or avifenc, please run `brew doctor` followed by `brew cleanup` and try again.")}}return await(0,Y.showToast)({title:"AVIF Encoder not installed.",style:Y.Toast.Style.Failure}),!1}async function sc(){let t=!1,s=0;for(;!t&&s<7;){let r=(0,vt.execSync)("/bin/zsh -lc 'command -v avifenc'").toString().trim();if((0,ro.existsSync)(r)){t=!0;break}await new Promise(n=>setTimeout(n,1e3)),s++}return t}async function dr(){let i=await Y.LocalStorage.getItem("avifEncoderPath"),e=await Y.LocalStorage.getItem("avifDecoderPath");if(!i||!e)try{i=(0,vt.execSync)(`/bin/zsh -lc 'realpath "$(which avifenc)"'`).toString().trim(),e=(0,vt.execSync)(`/bin/zsh -lc 'realpath "$(which avifdec)"'`).toString().trim()}catch(t){if(await ic())try{return await dr()}catch(s){console.error(s),ie("AVIF Encoder not found.",s,void 0,"Please install the libavif Homebrew formula manually and try again.")}else ie("AVIF Encoder not found.",t,void 0,"Please install the libavif Homebrew formula and try again.")}return{encoderPath:i,decoderPath:e}}var no=async()=>_e(`use framework "AppKit"
      use framework "PDFKit"
      
      set pb to current application's NSPasteboard's generalPasteboard()
      set theItems to pb's readObjectsForClasses:({current application's NSURL, current application's NSImage, current application's NSAttributedString}) options:{}
      
      set theImages to {}
      repeat with i from 0 to ((theItems's |count|()) - 1)
        set theItem to (theItems's objectAtIndex:i)
        if (theItem's |class|()) is current application's NSImage then
          copy theItem to end of theImages
        else if (theItem's |class|()) is current application's NSURL then
          if (theItem's absoluteString() as text) ends with ".pdf" then
            set theImage to (current application's PDFDocument's alloc()'s initWithURL:theItem)
          else
            set theImage to (current application's NSImage's alloc()'s initWithContentsOfURL:theItem)
          end if
          if theImage is not missing value then
            copy theImage to end of theImages
          end if
        else if (theItem's |class|()) is current application's NSConcreteAttributedString then
          repeat with i from 0 to ((theItem's |length|()) - 1)
            set attrs to (theItem's attributesAtIndex:i longestEffectiveRange:(missing value) inRange:{i, (theItem's |length|()) - i})
            set theAttachment to (attrs's objectForKey:"NSAttachment")
            if theAttachment is not missing value then
              set cell to theAttachment's attachmentCell()
              set theImage to cell's image()
              copy theImage to end of theImages
            end if
          end repeat
        end if
      end repeat
      
      set tempDir to current application's NSTemporaryDirectory() as text
      set filePaths to {}
      repeat with i from 1 to count theImages
        set theImage to item i of theImages
        set theFile to tempDir & "clipboardImage_" & i
        if theImage's |class|() is current application's PDFDocument then
          set theFile to theFile & ".pdf"
          (theImage's writeToFile:theFile)
        else
          set theFile to theFile & ".png"
          set theTIFFData to theImage's TIFFRepresentation()
          set theBitmap to (current application's NSBitmapImageRep's alloc()'s initWithData:theTIFFData)
          set thePNGData to (theBitmap's representationUsingType:(current application's NSBitmapImageFileTypePNG) |properties|:(current application's NSDictionary's alloc()'s init()))
          (thePNGData's writeToFile:theFile atomically:false)
        end if
        copy theFile to end of filePaths
      end repeat
      
      return filePaths`),oo=async i=>{let e=Array.isArray(i)?i:[i];await _e(`use framework "Foundation"
      use framework "PDFKit"
      use scripting additions
  
      set thePasteboard to current application's NSPasteboard's generalPasteboard()
      thePasteboard's clearContents()
      
      -- Handle PDFs separately
      set pdfPaths to {"${e.filter(t=>t.endsWith(".pdf")).join('", "')}"}
  
      set pdfItems to current application's NSMutableArray's alloc()'s init()
      repeat with pdfPath in pdfPaths
        if length of pdfPath is not 0 then
          set pdfItem to current application's NSPasteboardItem's alloc()'s init()
          set pdfData to current application's NSData's dataWithContentsOfFile:pdfPath
          pdfItem's setData:pdfData forType:(current application's NSPasteboardTypePDF)
          pdfItems's addObject:pdfItem
        end if
      end repeat
  
      if pdfItems's |count|() > 0 then
        thePasteboard's writeObjects:pdfItems
      end if
        
      -- Handle all other image types
      set theFiles to {"${e.join('", "')}"}
    
      set theImages to {}
      repeat with theFile in theFiles
        if length of theFile is not 0 then
          set theImage to (current application's NSImage's alloc()'s initWithContentsOfFile:theFile)
          if theImage is not missing value then
            copy theImage to end of theImages
          end if
        end if
      end repeat
      
      if (count theImages) > 0 then
        thePasteboard's writeObjects:theImages
      end if`)};var ct=p(require("path"));var Hi=require("child_process");function at(i,e){let t=e?.command,s=e?.language,r=[...e?.leadingArgs?.map(h=>h.toString())||[]],n=e?.trailingArgs||[];!t&&(s===void 0||s==="AppleScript"||s==="JXA")&&(t="/usr/bin/osascript",r.push("-l",s==="JXA"?"JavaScript":"AppleScript",...i.startsWith("/")?[]:["-e"],i,...n.map(h=>h.toString())));let o=process.env;if(e?.command&&(o.PATH=`${o.PATH}:${(0,Hi.execSync)(`$(/bin/bash -lc 'echo $SHELL') -lc 'echo "$PATH"'`).toString()}`,t=e.command,r.push(i,...n.map(h=>h.toString()))),!t)throw new Error("No command specified.");let a="",c=h=>{console.log(h)},l=(0,Hi.spawn)(t,r,{env:o});return e?.logDebugMessages&&console.log(`Running shell command "${t} ${r.join(" ")}"`),l.stdout?.on("data",h=>{a+=h.toString(),e?.logIntermediateOutput&&console.log(`Data from script: ${a}`)}),l.stderr?.on("data",h=>{e?.stderrCallback&&e.stderrCallback(h.toString()),e?.logErrors&&console.error(h.toString())}),l.stdin.on("error",h=>{e?.logErrors&&console.error(`Error writing to stdin: ${h}`)}),c=async h=>{h?.length>0&&(l.stdin.cork(),l.stdin.write(`${h}\r
`),process.nextTick(()=>l.stdin.uncork()),e?.logSentMessages&&console.log(`Sent message: ${h}`))},{data:(async()=>new Promise((h,m)=>{let S=e?.timeout?setTimeout(()=>{try{l.kill()}catch(T){e?.logErrors&&console.error(`Error killing process: ${T}`)}return e?.logErrors&&console.error("Script timed out"),l.stdin.end(),l.kill(),m("Script timed out")},e?.timeout):void 0;l.on("close",T=>{if(T!==0)return e?.logErrors&&console.error(`Script exited with code ${T}`),l.stdin.end(),l.kill(),m(`Script exited with code ${T}`);clearTimeout(S);let w;try{w=JSON.parse(a)}catch{w=a.trim()}return e?.logFinalOutput&&console.log(`Script output: ${w}`),h(w)})}))(),sendMessage:c}}var lt=require("@raycast/api");async function ao(){let i=ct.default.join(lt.environment.assetsPath,"scripts","finder.scpt"),e=await at(i,{language:"AppleScript",stderrCallback:t=>ie("Finder Selection Error",new Error(t))}).data;return Array.isArray(e)?e:e.split(",").map(t=>t.trim())}async function co(){let i=ct.default.join(lt.environment.assetsPath,"scripts","houdahSpot.scpt"),e=await at(i,{language:"AppleScript",stderrCallback:t=>ie("HoudahSpot Selection Error",new Error(t))}).data;return Array.isArray(e)?e:e.split(",").map(t=>t.trim())}async function lo(){let i=ct.default.join(lt.environment.assetsPath,"scripts","neofinder.scpt"),e=await at(i,{language:"AppleScript",stderrCallback:t=>ie("NeoFinder Selection Error",new Error(t))}).data;return Array.isArray(e)?e:e.split(",").map(t=>t.trim())}async function ho(){let i=ct.default.join(lt.environment.assetsPath,"scripts","pathfinder.scpt"),e=await at(i,{language:"JXA",stderrCallback:t=>ie("Path Finder Selection Error",new Error(t))}).data;return Array.isArray(e)?e:e.split(",").map(t=>t.trim())}async function fo(){let i=ct.default.join(lt.environment.assetsPath,"scripts","qspace.scpt"),e=await at(i,{language:"JXA",stderrCallback:t=>ie("QSpace Pro Selection Error",new Error(t))}).data;return Array.isArray(e)?e:e.split(",").map(t=>t.trim())}async function uo(){let i=ct.default.join(lt.environment.assetsPath,"scripts","forklift-beta.scpt"),e=await at(i,{language:"JXA",stderrCallback:t=>ie("ForkLift Selection Error",new Error(t))}).data;return Array.isArray(e)?e:e.split(",").map(t=>t.trim())}var mr=async(i,e)=>{let t=A.default.join(me.tmpdir(),`${i}.${e}`);return{path:t,[Symbol.asyncDispose]:async()=>{M.existsSync(t)&&await M.promises.rm(t,{recursive:!0})}}};var Jt=async()=>{let e=(await d.LocalStorage.getItem("itemsToRemove")??"").toString().split(", ");for(let t of e)M.existsSync(t)&&await M.promises.rm(t,{recursive:!0});await d.LocalStorage.removeItem("itemsToRemove")},pr=async()=>{let i=[],t=(0,d.getPreferenceValues)().inputMethod,s=!1;if(t=="Clipboard")try{let o=(await no()).split(", ");if(await d.LocalStorage.setItem("itemsToRemove",o.join(", ")),o.filter(a=>a.trim().length>0).length>0)return o}catch(o){console.error(`Couldn't get images from clipboard: ${o}`),s=!0}let r=t;try{r=(await(0,d.getFrontmostApplication)()).name}catch(o){console.error(`Couldn't get frontmost application: ${o}`)}try{(t=="Path Finder"||r=="Path Finder")&&(i=await ho())}catch(o){console.error(`Couldn't get images from Path Finder: ${o}`),s=!0}try{(t=="NeoFinder"||r=="NeoFinder")&&(i=await lo())}catch(o){console.error(`Couldn't get images from NeoFinder: ${o}`),s=!0}try{(t=="HoudahSpot"||r=="HoudahSpot")&&(i=await co())}catch(o){console.error(`Couldn't get images from HoudahSpot: ${o}`),s=!0}try{(t=="QSpace Pro"||r=="QSpace Pro")&&(i=await fo())}catch(o){console.error(`Couldn't get images from QSpace Pro: ${o}`),s=!0}try{(t=="ForkLift"||r=="ForkLift")&&(i=await uo())}catch(o){console.error(`Couldn't get images from ForkLift: ${o}`),s=!0}if(i.length>0)return i.filter((o,a)=>i.indexOf(o)===a);let n=await ao();return r=="Finder"||t=="Finder"||s?i=n:n.forEach(o=>{o.split("/").at(-2)=="Desktop"&&!i.includes(o)&&i.push(o)}),i.filter((o,a)=>i.indexOf(o)===a)},po=async i=>{let e="Finder";try{e=(await(0,d.getFrontmostApplication)()).name}catch(s){console.error(`Couldn't get frontmost application: : ${s}`)}let t=(0,d.getPreferenceValues)();t.imageResultHandling=="copyToClipboard"?(await oo(i),mo(i)):t.imageResultHandling=="openInPreview"?(await ac(i),mo(i)):t.inputMethod=="NeoFinder"||e=="NeoFinder"?await(0,d.showInFinder)(i[0]):(t.inputMethod=="HoudahSpot"||e=="HoudahSpot")&&await(0,d.showInFinder)(i[0])},nc=async()=>(me.cpus()[0].model.includes("Apple")?"arm":"x86")=="arm"?((0,Ae.execSync)(`chmod +x ${d.environment.assetsPath}/webp/arm/dwebp`),(0,Ae.execSync)(`chmod +x ${d.environment.assetsPath}/webp/arm/cwebp`),M.existsSync(`${d.environment.assetsPath}/webp/x86/dwebp`)&&await M.promises.rm(`${d.environment.assetsPath}/webp/x86/dwebp`),M.existsSync(`${d.environment.assetsPath}/webp/x86/cwebp`)&&await M.promises.rm(`${d.environment.assetsPath}/webp/x86/cwebp`),[`${d.environment.assetsPath}/webp/arm/dwebp`,`${d.environment.assetsPath}/webp/arm/cwebp`]):((0,Ae.execSync)(`chmod +x ${d.environment.assetsPath}/webp/x86/dwebp`),(0,Ae.execSync)(`chmod +x ${d.environment.assetsPath}/webp/x86/cwebp`),M.existsSync(`${d.environment.assetsPath}/webp/arm/dwebp`)&&await M.promises.rm(`${d.environment.assetsPath}/webp/arm/dwebp`),M.existsSync(`${d.environment.assetsPath}/webp/arm/cwebp`)&&await M.promises.rm(`${d.environment.assetsPath}/webp/arm/cwebp`),[`${d.environment.assetsPath}/webp/x86/dwebp`,`${d.environment.assetsPath}/webp/x86/cwebp`]),go=async(i,e)=>{var a=[];try{let t=(0,d.getPreferenceValues)();let s=zi(a,await mr("tmp","png"),!0);let r=(await qt([e]))[0];let[n,o]=await nc();(0,Ae.execSync)(`${n} "${e}" -o "${s.path}" && ${i} "${s.path}" && ${o} ${t.useLosslessConversion?"-lossless":""} "${s.path}" -o "${r}"`);return r}catch(c){var l=c,f=!0}finally{var h=Wi(a,l,f);h&&await h}},yo=async(i,e)=>{var a=[];try{let t=(0,d.getPreferenceValues)();let s=zi(a,await mr("tmp","png"),!0);let r=(await qt([e]))[0];let{encoderPath:n,decoderPath:o}=await dr();(0,Ae.execSync)(`${o} "${e}" "${s.path}" && ${i} "${s.path}" && ${n} ${t.useLosslessConversion?"-s 0 --min 0 --max 0 --minalpha 0 --maxalpha 0 --qcolor 100 --qalpha 100":""}  "${s.path}" "${r}"`);return r}catch(c){var l=c,f=!0}finally{var h=Wi(a,l,f);h&&await h}},bo=async(i,e)=>{var r=[];try{let t=zi(r,await mr("tmp","bmp"),!0);let s=(await qt([e]))[0];await oc("BMP",e,t.path);(0,Ae.execSync)(`chmod +x ${d.environment.assetsPath}/potrace/potrace`);(0,Ae.execSync)(`${i} "${t.path}" && ${d.environment.assetsPath}/potrace/potrace -s --tight -o "${s}" "${t.path}"`);return s}catch(n){var o=n,a=!0}finally{var c=Wi(r,o,a);c&&await c}},oc=async(i,e,t)=>_e(`use framework "Foundation"
  use scripting additions

  -- Load SVG image from file
  set svgFilePath to "${e}"
  set svgData to current application's NSData's alloc()'s initWithContentsOfFile:svgFilePath
  
  -- Create image from SVG data
  set svgImage to current application's NSImage's alloc()'s initWithData:svgData
  
  -- Convert image to PNG data
  set tiffData to svgImage's TIFFRepresentation()
  set theBitmap to current application's NSBitmapImageRep's alloc()'s initWithData:tiffData

  try
    set pngData to theBitmap's representationUsingType:(current application's NSBitmapImageFileType${i}) |properties|:(missing value)
  on error
    set pngData to theBitmap's representationUsingType:(current application's NSBitmapImageFileTypePNG) |properties|:(missing value)
  end
  
  -- Save PNG data to file
  pngData's writeToFile:"${t}" atomically:false`);var ac=async i=>{let e=Array.isArray(i)?i:[i],t=e.some(s=>A.default.extname(s)==".svg");await _e(`use framework "Foundation"
    use scripting additions
    set pageImages to {${e.map(s=>`current application's NSURL's fileURLWithPath:"${s}"`).join(", ")}}

    set workspace to current application's NSWorkspace's sharedWorkspace()
    set config to current application's NSWorkspaceOpenConfiguration's configuration()

    ${t?`tell application "Finder"
            set safariPath to POSIX path of ((application file id "com.apple.Safari") as text)
            set safariURL to current application's NSURL's fileURLWithPath:safariPath
          end tell

          workspace's openURLs:pageImages withApplicationAtURL:safariURL configuration:config completionHandler:(missing value)
          
          tell application "Safari"
            set finished to false
            set iter to 0
            repeat while ((count of windows) = 0 or finished is not true) and iter < 10
              delay 0.5
              set iter to iter + 1

              set currentStatus to true
              repeat with doc in (path of documents as list)
                repeat with thePath in {"${e.map(s=>encodeURI(`file://${s}`)).join('", "')}"}
                  if thePath is not in doc then
                    set currentStatus to false
                  end if
                end repeat
              end repeat
              set finished to currentStatus
            end repeat
          end tell
          `:`tell application "Finder"
            set previewPath to POSIX path of ((application file id "com.apple.Preview") as text)
            set previewURL to current application's NSURL's fileURLWithPath:previewPath
          end tell

          workspace's openURLs:pageImages withApplicationAtURL:previewURL configuration:config completionHandler:(missing value)
          
          tell application "Preview"
            set finished to false
            set iter to 0
            repeat while ((count of windows) = 0 or finished is not true) and iter < 10
              delay 0.5
              set iter to iter + 1

              set currentStatus to true
              repeat with doc in (path of documents as list)
                repeat with thePath in {"${e.join('", "')}"}
                  if thePath is not in doc then
                    set currentStatus to false
                  end if
                end repeat
              end repeat
              set finished to currentStatus
            end repeat
          end tell`}`)},mo=i=>{let e=Array.isArray(i)?i:[i];for(let t of e)M.unlinkSync(t)},cc=async()=>_e(`use framework "Foundation"
    use scripting additions
    set workspace to current application's NSWorkspace's sharedWorkspace()
    set runningApps to workspace's runningApplications()
    
    set targetApp to missing value
    repeat with theApp in runningApps
      if theApp's ownsMenuBar() then
        set targetApp to theApp
        exit repeat
      end if
    end repeat
    
    if targetApp is missing value then
      return "Finder"
    else
      return targetApp's localizedName() as text
    end if`),lc=async i=>{let e="Finder";try{e=await cc()}catch(t){console.error(`Couldn't get frontmost application: ${t}`)}try{if(e=="Path Finder")return _e(`tell application "Path Finder"
        if 1 \u2264 (count finder windows) then
          try
          get POSIX path of (target of finder window 1)
          on error message number -1728
            -- Folder is nonstandard, use container of selection
            tell application "System Events"
              set itemPath to POSIX file "${i}" as alias
              return POSIX path of container of itemPath
            end tell
          end try
        else
          get POSIX path of desktop
        end if
      end tell`)}catch(t){console.error(`Couldn't get current directory of Path Finder: ${t}`)}return _e(`tell application "Finder"
    if 1 \u2264 (count Finder windows) then
      try
        return POSIX path of (target of window 1 as alias)
      on error message number -1700
        -- Folder is nonstandard, use container of selection
        set itemPath to POSIX file "${i}" as alias
        return POSIX path of (container of itemPath as alias)
      end try
    else
      return POSIX path of (desktop as alias)
    end if
  end tell`)},qt=async(i,e=!1,t=void 0)=>{let s=(0,d.getPreferenceValues)(),r=await lc(i[0]);return i.map(n=>{let o=n;if(s.imageResultHandling=="saveToDownloads"?o=A.default.join(me.homedir(),"Downloads",A.default.basename(o)):s.imageResultHandling=="saveToDesktop"?o=A.default.join(me.homedir(),"Desktop",A.default.basename(o)):(s.imageResultHandling=="saveInContainingFolder"||s.imageResultHandling=="replaceOriginal")&&(s.inputMethod=="Clipboard"||e)?o=A.default.join(r,A.default.basename(o)):(s.imageResultHandling=="copyToClipboard"||s.imageResultHandling=="openInPreview")&&(o=A.default.join(me.tmpdir(),A.default.basename(o))),o=t?o.replace(A.default.extname(o),`.${t}`):o,s.imageResultHandling!="replaceOriginal"&&me.tmpdir()!=A.default.dirname(o)){let a=2;for(;M.existsSync(o);)o=A.default.join(A.default.dirname(o),A.default.basename(o,A.default.extname(o))+`-${a}${A.default.extname(o)}`),a++}return o})},ie=async(i,e,t,s)=>{console.error(e),t?(t.title=i,t.message=s??e.message,t.style=d.Toast.Style.Failure,t.primaryAction={title:"Copy Error",onAction:async()=>{await d.Clipboard.copy(e.message)}}):t=await(0,d.showToast)({title:i,message:s??e.message,style:d.Toast.Style.Failure,primaryAction:{title:"Copy Error",onAction:async()=>{await d.Clipboard.copy(e.message)}}})};var wo=i=>{let e=me.homedir();if(i.startsWith("~"))return i.replace(/^~(?=$|\/|\\)/,e);let t=/(\/Users\/.*?)\/.*/,s=i.match(t);return s?i.replace(s[1],e):i};async function Gi(i,e){let t=(0,Qt.getPreferenceValues)(),s=i.map(a=>wo(a)),r=await qt(s),n=[],o=e==="path"?"exiftool":`"${Qt.environment.supportPath}/exiftool/exiftool"`;e==="support"&&(0,Vi.execSync)(`chmod +x "${Qt.environment.supportPath}/exiftool/exiftool"`);for(let a of s)if(a.toLowerCase().endsWith(".webp"))n.push(await go(`${o} -all= "${a}"`,a));else if(a.toLowerCase().endsWith(".svg"))n.push(await bo(`${o} -all= "${a}"`,a));else if(a.toLowerCase().endsWith(".avif"))n.push(await yo(`${o} -all= "${a}" -overwrite_original`,a));else{let c=r[s.indexOf(a)];n.push(c),t.imageResultHandling==="replaceOriginal"?(0,Vi.execSync)(`${o} -all= "${a}" -overwrite_original`):(0,Vi.execSync)(`${o} -all= -o "${c}" "${a}"`)}return await po(n),await Jt(),n}var Vn=require("child_process"),Ca=p(require("crypto")),ke=p(require("fs")),Ma=p(require("https")),Ua=p(require("path")),E=require("@raycast/api");var To=p(require("events"),1),G=p(require("fs"),1);var Qi=require("node:events"),xr=p(require("node:stream"),1),$o=require("node:string_decoder"),So=typeof process=="object"&&process?process:{stdout:null,stderr:null},fc=i=>!!i&&typeof i=="object"&&(i instanceof ri||i instanceof xr.default||uc(i)||dc(i)),uc=i=>!!i&&typeof i=="object"&&i instanceof Qi.EventEmitter&&typeof i.pipe=="function"&&i.pipe!==xr.default.Writable.prototype.pipe,dc=i=>!!i&&typeof i=="object"&&i instanceof Qi.EventEmitter&&typeof i.write=="function"&&typeof i.end=="function",Oe=Symbol("EOF"),ve=Symbol("maybeEmitEnd"),He=Symbol("emittedEnd"),Ki=Symbol("emittingEnd"),ei=Symbol("emittedError"),Zi=Symbol("closed"),Eo=Symbol("read"),Yi=Symbol("flush"),xo=Symbol("flushChunk"),oe=Symbol("encoding"),It=Symbol("decoder"),O=Symbol("flowing"),ti=Symbol("paused"),Pt=Symbol("resume"),v=Symbol("buffer"),V=Symbol("pipes"),I=Symbol("bufferLength"),gr=Symbol("bufferPush"),Xi=Symbol("bufferShift"),z=Symbol("objectMode"),x=Symbol("destroyed"),yr=Symbol("error"),br=Symbol("emitData"),Ro=Symbol("emitEnd"),wr=Symbol("emitEnd2"),pe=Symbol("async"),Sr=Symbol("abort"),Ji=Symbol("aborted"),ii=Symbol("signal"),ht=Symbol("dataListeners"),J=Symbol("discarded"),si=i=>Promise.resolve().then(i),mc=i=>i(),pc=i=>i==="end"||i==="finish"||i==="prefinish",gc=i=>i instanceof ArrayBuffer||!!i&&typeof i=="object"&&i.constructor&&i.constructor.name==="ArrayBuffer"&&i.byteLength>=0,yc=i=>!Buffer.isBuffer(i)&&ArrayBuffer.isView(i),qi=class{src;dest;opts;ondrain;constructor(e,t,s){this.src=e,this.dest=t,this.opts=s,this.ondrain=()=>e[Pt](),this.dest.on("drain",this.ondrain)}unpipe(){this.dest.removeListener("drain",this.ondrain)}proxyErrors(e){}end(){this.unpipe(),this.opts.end&&this.dest.end()}},Er=class extends qi{unpipe(){this.src.removeListener("error",this.proxyErrors),super.unpipe()}constructor(e,t,s){super(e,t,s),this.proxyErrors=r=>t.emit("error",r),e.on("error",this.proxyErrors)}},bc=i=>!!i.objectMode,wc=i=>!i.objectMode&&!!i.encoding&&i.encoding!=="buffer",ri=class extends Qi.EventEmitter{[O]=!1;[ti]=!1;[V]=[];[v]=[];[z];[oe];[pe];[It];[Oe]=!1;[He]=!1;[Ki]=!1;[Zi]=!1;[ei]=null;[I]=0;[x]=!1;[ii];[Ji]=!1;[ht]=0;[J]=!1;writable=!0;readable=!0;constructor(...e){let t=e[0]||{};if(super(),t.objectMode&&typeof t.encoding=="string")throw new TypeError("Encoding and objectMode may not be used together");bc(t)?(this[z]=!0,this[oe]=null):wc(t)?(this[oe]=t.encoding,this[z]=!1):(this[z]=!1,this[oe]=null),this[pe]=!!t.async,this[It]=this[oe]?new $o.StringDecoder(this[oe]):null,t&&t.debugExposeBuffer===!0&&Object.defineProperty(this,"buffer",{get:()=>this[v]}),t&&t.debugExposePipes===!0&&Object.defineProperty(this,"pipes",{get:()=>this[V]});let{signal:s}=t;s&&(this[ii]=s,s.aborted?this[Sr]():s.addEventListener("abort",()=>this[Sr]()))}get bufferLength(){return this[I]}get encoding(){return this[oe]}set encoding(e){throw new Error("Encoding must be set at instantiation time")}setEncoding(e){throw new Error("Encoding must be set at instantiation time")}get objectMode(){return this[z]}set objectMode(e){throw new Error("objectMode must be set at instantiation time")}get async(){return this[pe]}set async(e){this[pe]=this[pe]||!!e}[Sr](){this[Ji]=!0,this.emit("abort",this[ii]?.reason),this.destroy(this[ii]?.reason)}get aborted(){return this[Ji]}set aborted(e){}write(e,t,s){if(this[Ji])return!1;if(this[Oe])throw new Error("write after end");if(this[x])return this.emit("error",Object.assign(new Error("Cannot call write after a stream was destroyed"),{code:"ERR_STREAM_DESTROYED"})),!0;typeof t=="function"&&(s=t,t="utf8"),t||(t="utf8");let r=this[pe]?si:mc;if(!this[z]&&!Buffer.isBuffer(e)){if(yc(e))e=Buffer.from(e.buffer,e.byteOffset,e.byteLength);else if(gc(e))e=Buffer.from(e);else if(typeof e!="string")throw new Error("Non-contiguous data written to non-objectMode stream")}return this[z]?(this[O]&&this[I]!==0&&this[Yi](!0),this[O]?this.emit("data",e):this[gr](e),this[I]!==0&&this.emit("readable"),s&&r(s),this[O]):e.length?(typeof e=="string"&&!(t===this[oe]&&!this[It]?.lastNeed)&&(e=Buffer.from(e,t)),Buffer.isBuffer(e)&&this[oe]&&(e=this[It].write(e)),this[O]&&this[I]!==0&&this[Yi](!0),this[O]?this.emit("data",e):this[gr](e),this[I]!==0&&this.emit("readable"),s&&r(s),this[O]):(this[I]!==0&&this.emit("readable"),s&&r(s),this[O])}read(e){if(this[x])return null;if(this[J]=!1,this[I]===0||e===0||e&&e>this[I])return this[ve](),null;this[z]&&(e=null),this[v].length>1&&!this[z]&&(this[v]=[this[oe]?this[v].join(""):Buffer.concat(this[v],this[I])]);let t=this[Eo](e||null,this[v][0]);return this[ve](),t}[Eo](e,t){if(this[z])this[Xi]();else{let s=t;e===s.length||e===null?this[Xi]():typeof s=="string"?(this[v][0]=s.slice(e),t=s.slice(0,e),this[I]-=e):(this[v][0]=s.subarray(e),t=s.subarray(0,e),this[I]-=e)}return this.emit("data",t),!this[v].length&&!this[Oe]&&this.emit("drain"),t}end(e,t,s){return typeof e=="function"&&(s=e,e=void 0),typeof t=="function"&&(s=t,t="utf8"),e!==void 0&&this.write(e,t),s&&this.once("end",s),this[Oe]=!0,this.writable=!1,(this[O]||!this[ti])&&this[ve](),this}[Pt](){this[x]||(!this[ht]&&!this[V].length&&(this[J]=!0),this[ti]=!1,this[O]=!0,this.emit("resume"),this[v].length?this[Yi]():this[Oe]?this[ve]():this.emit("drain"))}resume(){return this[Pt]()}pause(){this[O]=!1,this[ti]=!0,this[J]=!1}get destroyed(){return this[x]}get flowing(){return this[O]}get paused(){return this[ti]}[gr](e){this[z]?this[I]+=1:this[I]+=e.length,this[v].push(e)}[Xi](){return this[z]?this[I]-=1:this[I]-=this[v][0].length,this[v].shift()}[Yi](e=!1){do;while(this[xo](this[Xi]())&&this[v].length);!e&&!this[v].length&&!this[Oe]&&this.emit("drain")}[xo](e){return this.emit("data",e),this[O]}pipe(e,t){if(this[x])return e;this[J]=!1;let s=this[He];return t=t||{},e===So.stdout||e===So.stderr?t.end=!1:t.end=t.end!==!1,t.proxyErrors=!!t.proxyErrors,s?t.end&&e.end():(this[V].push(t.proxyErrors?new Er(this,e,t):new qi(this,e,t)),this[pe]?si(()=>this[Pt]()):this[Pt]()),e}unpipe(e){let t=this[V].find(s=>s.dest===e);t&&(this[V].length===1?(this[O]&&this[ht]===0&&(this[O]=!1),this[V]=[]):this[V].splice(this[V].indexOf(t),1),t.unpipe())}addListener(e,t){return this.on(e,t)}on(e,t){let s=super.on(e,t);if(e==="data")this[J]=!1,this[ht]++,!this[V].length&&!this[O]&&this[Pt]();else if(e==="readable"&&this[I]!==0)super.emit("readable");else if(pc(e)&&this[He])super.emit(e),this.removeAllListeners(e);else if(e==="error"&&this[ei]){let r=t;this[pe]?si(()=>r.call(this,this[ei])):r.call(this,this[ei])}return s}removeListener(e,t){return this.off(e,t)}off(e,t){let s=super.off(e,t);return e==="data"&&(this[ht]=this.listeners("data").length,this[ht]===0&&!this[J]&&!this[V].length&&(this[O]=!1)),s}removeAllListeners(e){let t=super.removeAllListeners(e);return(e==="data"||e===void 0)&&(this[ht]=0,!this[J]&&!this[V].length&&(this[O]=!1)),t}get emittedEnd(){return this[He]}[ve](){!this[Ki]&&!this[He]&&!this[x]&&this[v].length===0&&this[Oe]&&(this[Ki]=!0,this.emit("end"),this.emit("prefinish"),this.emit("finish"),this[Zi]&&this.emit("close"),this[Ki]=!1)}emit(e,...t){let s=t[0];if(e!=="error"&&e!=="close"&&e!==x&&this[x])return!1;if(e==="data")return!this[z]&&!s?!1:this[pe]?(si(()=>this[br](s)),!0):this[br](s);if(e==="end")return this[Ro]();if(e==="close"){if(this[Zi]=!0,!this[He]&&!this[x])return!1;let n=super.emit("close");return this.removeAllListeners("close"),n}else if(e==="error"){this[ei]=s,super.emit(yr,s);let n=!this[ii]||this.listeners("error").length?super.emit("error",s):!1;return this[ve](),n}else if(e==="resume"){let n=super.emit("resume");return this[ve](),n}else if(e==="finish"||e==="prefinish"){let n=super.emit(e);return this.removeAllListeners(e),n}let r=super.emit(e,...t);return this[ve](),r}[br](e){for(let s of this[V])s.dest.write(e)===!1&&this.pause();let t=this[J]?!1:super.emit("data",e);return this[ve](),t}[Ro](){return this[He]?!1:(this[He]=!0,this.readable=!1,this[pe]?(si(()=>this[wr]()),!0):this[wr]())}[wr](){if(this[It]){let t=this[It].end();if(t){for(let s of this[V])s.dest.write(t);this[J]||super.emit("data",t)}}for(let t of this[V])t.end();let e=super.emit("end");return this.removeAllListeners("end"),e}async collect(){let e=Object.assign([],{dataLength:0});this[z]||(e.dataLength=0);let t=this.promise();return this.on("data",s=>{e.push(s),this[z]||(e.dataLength+=s.length)}),await t,e}async concat(){if(this[z])throw new Error("cannot concat in objectMode");let e=await this.collect();return this[oe]?e.join(""):Buffer.concat(e,e.dataLength)}async promise(){return new Promise((e,t)=>{this.on(x,()=>t(new Error("stream destroyed"))),this.on("error",s=>t(s)),this.on("end",()=>e())})}[Symbol.asyncIterator](){this[J]=!1;let e=!1,t=async()=>(this.pause(),e=!0,{value:void 0,done:!0});return{next:()=>{if(e)return t();let r=this.read();if(r!==null)return Promise.resolve({done:!1,value:r});if(this[Oe])return t();let n,o,a=h=>{this.off("data",c),this.off("end",l),this.off(x,f),t(),o(h)},c=h=>{this.off("error",a),this.off("end",l),this.off(x,f),this.pause(),n({value:h,done:!!this[Oe]})},l=()=>{this.off("error",a),this.off("data",c),this.off(x,f),t(),n({done:!0,value:void 0})},f=()=>a(new Error("stream destroyed"));return new Promise((h,m)=>{o=m,n=h,this.once(x,f),this.once("error",a),this.once("end",l),this.once("data",c)})},throw:t,return:t,[Symbol.asyncIterator](){return this}}}[Symbol.iterator](){this[J]=!1;let e=!1,t=()=>(this.pause(),this.off(yr,t),this.off(x,t),this.off("end",t),e=!0,{done:!0,value:void 0}),s=()=>{if(e)return t();let r=this.read();return r===null?t():{done:!1,value:r}};return this.once("end",t),this.once(yr,t),this.once(x,t),{next:s,throw:t,return:t,[Symbol.iterator](){return this}}}destroy(e){if(this[x])return e?this.emit("error",e):this.emit(x),this;this[x]=!0,this[J]=!0,this[v].length=0,this[I]=0;let t=this;return typeof t.close=="function"&&!this[Zi]&&t.close(),e?this.emit("error",e):this.emit(x),this}static get isStream(){return fc}};var Sc=G.default.writev,Ge=Symbol("_autoClose"),ce=Symbol("_close"),ni=Symbol("_ended"),y=Symbol("_fd"),Rr=Symbol("_finished"),Pe=Symbol("_flags"),$r=Symbol("_flush"),Ar=Symbol("_handleChunk"),Or=Symbol("_makeBuf"),ai=Symbol("_mode"),es=Symbol("_needDrain"),Lt=Symbol("_onerror"),Nt=Symbol("_onopen"),Tr=Symbol("_onread"),Dt=Symbol("_onwrite"),Ke=Symbol("_open"),ae=Symbol("_path"),Ve=Symbol("_pos"),ge=Symbol("_queue"),Ft=Symbol("_read"),kr=Symbol("_readSize"),Ie=Symbol("_reading"),oi=Symbol("_remain"),_r=Symbol("_size"),ts=Symbol("_write"),ft=Symbol("_writing"),is=Symbol("_defaultFlag"),ut=Symbol("_errored"),dt=class extends ri{[ut]=!1;[y];[ae];[kr];[Ie]=!1;[_r];[oi];[Ge];constructor(e,t){if(t=t||{},super(t),this.readable=!0,this.writable=!1,typeof e!="string")throw new TypeError("path must be a string");this[ut]=!1,this[y]=typeof t.fd=="number"?t.fd:void 0,this[ae]=e,this[kr]=t.readSize||16*1024*1024,this[Ie]=!1,this[_r]=typeof t.size=="number"?t.size:1/0,this[oi]=this[_r],this[Ge]=typeof t.autoClose=="boolean"?t.autoClose:!0,typeof this[y]=="number"?this[Ft]():this[Ke]()}get fd(){return this[y]}get path(){return this[ae]}write(){throw new TypeError("this is a readable stream")}end(){throw new TypeError("this is a readable stream")}[Ke](){G.default.open(this[ae],"r",(e,t)=>this[Nt](e,t))}[Nt](e,t){e?this[Lt](e):(this[y]=t,this.emit("open",t),this[Ft]())}[Or](){return Buffer.allocUnsafe(Math.min(this[kr],this[oi]))}[Ft](){if(!this[Ie]){this[Ie]=!0;let e=this[Or]();if(e.length===0)return process.nextTick(()=>this[Tr](null,0,e));G.default.read(this[y],e,0,e.length,null,(t,s,r)=>this[Tr](t,s,r))}}[Tr](e,t,s){this[Ie]=!1,e?this[Lt](e):this[Ar](t,s)&&this[Ft]()}[ce](){if(this[Ge]&&typeof this[y]=="number"){let e=this[y];this[y]=void 0,G.default.close(e,t=>t?this.emit("error",t):this.emit("close"))}}[Lt](e){this[Ie]=!0,this[ce](),this.emit("error",e)}[Ar](e,t){let s=!1;return this[oi]-=e,e>0&&(s=super.write(e<t.length?t.subarray(0,e):t)),(e===0||this[oi]<=0)&&(s=!1,this[ce](),super.end()),s}emit(e,...t){switch(e){case"prefinish":case"finish":return!1;case"drain":return typeof this[y]=="number"&&this[Ft](),!1;case"error":return this[ut]?!1:(this[ut]=!0,super.emit(e,...t));default:return super.emit(e,...t)}}},ss=class extends dt{[Ke](){let e=!0;try{this[Nt](null,G.default.openSync(this[ae],"r")),e=!1}finally{e&&this[ce]()}}[Ft](){let e=!0;try{if(!this[Ie]){this[Ie]=!0;do{let t=this[Or](),s=t.length===0?0:G.default.readSync(this[y],t,0,t.length,null);if(!this[Ar](s,t))break}while(!0);this[Ie]=!1}e=!1}finally{e&&this[ce]()}}[ce](){if(this[Ge]&&typeof this[y]=="number"){let e=this[y];this[y]=void 0,G.default.closeSync(e),this.emit("close")}}},De=class extends To.default{readable=!1;writable=!0;[ut]=!1;[ft]=!1;[ni]=!1;[ge]=[];[es]=!1;[ae];[ai];[Ge];[y];[is];[Pe];[Rr]=!1;[Ve];constructor(e,t){t=t||{},super(t),this[ae]=e,this[y]=typeof t.fd=="number"?t.fd:void 0,this[ai]=t.mode===void 0?438:t.mode,this[Ve]=typeof t.start=="number"?t.start:void 0,this[Ge]=typeof t.autoClose=="boolean"?t.autoClose:!0;let s=this[Ve]!==void 0?"r+":"w";this[is]=t.flags===void 0,this[Pe]=t.flags===void 0?s:t.flags,this[y]===void 0&&this[Ke]()}emit(e,...t){if(e==="error"){if(this[ut])return!1;this[ut]=!0}return super.emit(e,...t)}get fd(){return this[y]}get path(){return this[ae]}[Lt](e){this[ce](),this[ft]=!0,this.emit("error",e)}[Ke](){G.default.open(this[ae],this[Pe],this[ai],(e,t)=>this[Nt](e,t))}[Nt](e,t){this[is]&&this[Pe]==="r+"&&e&&e.code==="ENOENT"?(this[Pe]="w",this[Ke]()):e?this[Lt](e):(this[y]=t,this.emit("open",t),this[ft]||this[$r]())}end(e,t){return e&&this.write(e,t),this[ni]=!0,!this[ft]&&!this[ge].length&&typeof this[y]=="number"&&this[Dt](null,0),this}write(e,t){return typeof e=="string"&&(e=Buffer.from(e,t)),this[ni]?(this.emit("error",new Error("write() after end()")),!1):this[y]===void 0||this[ft]||this[ge].length?(this[ge].push(e),this[es]=!0,!1):(this[ft]=!0,this[ts](e),!0)}[ts](e){G.default.write(this[y],e,0,e.length,this[Ve],(t,s)=>this[Dt](t,s))}[Dt](e,t){e?this[Lt](e):(this[Ve]!==void 0&&typeof t=="number"&&(this[Ve]+=t),this[ge].length?this[$r]():(this[ft]=!1,this[ni]&&!this[Rr]?(this[Rr]=!0,this[ce](),this.emit("finish")):this[es]&&(this[es]=!1,this.emit("drain"))))}[$r](){if(this[ge].length===0)this[ni]&&this[Dt](null,0);else if(this[ge].length===1)this[ts](this[ge].pop());else{let e=this[ge];this[ge]=[],Sc(this[y],e,this[Ve],(t,s)=>this[Dt](t,s))}}[ce](){if(this[Ge]&&typeof this[y]=="number"){let e=this[y];this[y]=void 0,G.default.close(e,t=>t?this.emit("error",t):this.emit("close"))}}},Ct=class extends De{[Ke](){let e;if(this[is]&&this[Pe]==="r+")try{e=G.default.openSync(this[ae],this[Pe],this[ai])}catch(t){if(t?.code==="ENOENT")return this[Pe]="w",this[Ke]();throw t}else e=G.default.openSync(this[ae],this[Pe],this[ai]);this[Nt](null,e)}[ce](){if(this[Ge]&&typeof this[y]=="number"){let e=this[y];this[y]=void 0,G.default.closeSync(e),this.emit("close")}}[ts](e){let t=!0;try{this[Dt](null,G.default.writeSync(this[y],e,0,e.length,this[Ve])),t=!1}finally{if(t)try{this[ce]()}catch{}}}};var wn=p(require("node:path"),1);var $t=p(require("node:fs"),1),Fs=require("path");var Ec=new Map([["C","cwd"],["f","file"],["z","gzip"],["P","preservePaths"],["U","unlink"],["strip-components","strip"],["stripComponents","strip"],["keep-newer","newer"],["keepNewer","newer"],["keep-newer-files","newer"],["keepNewerFiles","newer"],["k","keep"],["keep-existing","keep"],["keepExisting","keep"],["m","noMtime"],["no-mtime","noMtime"],["p","preserveOwner"],["L","follow"],["h","follow"],["onentry","onReadEntry"]]),ko=i=>!!i.sync&&!!i.file,_o=i=>!i.sync&&!!i.file,Ao=i=>!!i.sync&&!i.file,Oo=i=>!i.sync&&!i.file;var vo=i=>!!i.file;var xc=i=>{let e=Ec.get(i);return e||i},ci=(i={})=>{if(!i)return{};let e={};for(let[t,s]of Object.entries(i)){let r=xc(t);e[r]=s}return e.chmod===void 0&&e.noChmod===!1&&(e.chmod=!0),delete e.noChmod,e};var ye=(i,e,t,s,r)=>Object.assign((n=[],o,a)=>{Array.isArray(n)&&(o=n,n={}),typeof o=="function"&&(a=o,o=void 0),o?o=Array.from(o):o=[];let c=ci(n);if(r?.(c,o),ko(c)){if(typeof a=="function")throw new TypeError("callback not supported for sync tar functions");return i(c,o)}else if(_o(c)){let l=e(c,o),f=a||void 0;return f?l.then(()=>f(),f):l}else if(Ao(c)){if(typeof a=="function")throw new TypeError("callback not supported for sync tar functions");return t(c,o)}else if(Oo(c)){if(typeof a=="function")throw new TypeError("callback only supported with file option");return s(c,o)}else throw new Error("impossible options??")},{syncFile:i,asyncFile:e,syncNoFile:t,asyncNoFile:s,validate:r});var ia=require("events");var fs=p(require("assert"),1),Ce=require("buffer");var hs=require("node:events"),Cr=p(require("node:stream"),1),Lo=require("node:string_decoder"),Io=typeof process=="object"&&process?process:{stdout:null,stderr:null},Rc=i=>!!i&&typeof i=="object"&&(i instanceof di||i instanceof Cr.default||$c(i)||Tc(i)),$c=i=>!!i&&typeof i=="object"&&i instanceof hs.EventEmitter&&typeof i.pipe=="function"&&i.pipe!==Cr.default.Writable.prototype.pipe,Tc=i=>!!i&&typeof i=="object"&&i instanceof hs.EventEmitter&&typeof i.write=="function"&&typeof i.end=="function",Fe=Symbol("EOF"),Le=Symbol("maybeEmitEnd"),Ze=Symbol("emittedEnd"),rs=Symbol("emittingEnd"),li=Symbol("emittedError"),ns=Symbol("closed"),Po=Symbol("read"),os=Symbol("flush"),Do=Symbol("flushChunk"),le=Symbol("encoding"),Mt=Symbol("decoder"),P=Symbol("flowing"),hi=Symbol("paused"),Ut=Symbol("resume"),D=Symbol("buffer"),K=Symbol("pipes"),F=Symbol("bufferLength"),Ir=Symbol("bufferPush"),as=Symbol("bufferShift"),W=Symbol("objectMode"),R=Symbol("destroyed"),Pr=Symbol("error"),Dr=Symbol("emitData"),Fo=Symbol("emitEnd"),Fr=Symbol("emitEnd2"),be=Symbol("async"),Lr=Symbol("abort"),cs=Symbol("aborted"),fi=Symbol("signal"),mt=Symbol("dataListeners"),q=Symbol("discarded"),ui=i=>Promise.resolve().then(i),kc=i=>i(),_c=i=>i==="end"||i==="finish"||i==="prefinish",Ac=i=>i instanceof ArrayBuffer||!!i&&typeof i=="object"&&i.constructor&&i.constructor.name==="ArrayBuffer"&&i.byteLength>=0,Oc=i=>!Buffer.isBuffer(i)&&ArrayBuffer.isView(i),ls=class{src;dest;opts;ondrain;constructor(e,t,s){this.src=e,this.dest=t,this.opts=s,this.ondrain=()=>e[Ut](),this.dest.on("drain",this.ondrain)}unpipe(){this.dest.removeListener("drain",this.ondrain)}proxyErrors(e){}end(){this.unpipe(),this.opts.end&&this.dest.end()}},Nr=class extends ls{unpipe(){this.src.removeListener("error",this.proxyErrors),super.unpipe()}constructor(e,t,s){super(e,t,s),this.proxyErrors=r=>t.emit("error",r),e.on("error",this.proxyErrors)}},vc=i=>!!i.objectMode,Ic=i=>!i.objectMode&&!!i.encoding&&i.encoding!=="buffer",di=class extends hs.EventEmitter{[P]=!1;[hi]=!1;[K]=[];[D]=[];[W];[le];[be];[Mt];[Fe]=!1;[Ze]=!1;[rs]=!1;[ns]=!1;[li]=null;[F]=0;[R]=!1;[fi];[cs]=!1;[mt]=0;[q]=!1;writable=!0;readable=!0;constructor(...e){let t=e[0]||{};if(super(),t.objectMode&&typeof t.encoding=="string")throw new TypeError("Encoding and objectMode may not be used together");vc(t)?(this[W]=!0,this[le]=null):Ic(t)?(this[le]=t.encoding,this[W]=!1):(this[W]=!1,this[le]=null),this[be]=!!t.async,this[Mt]=this[le]?new Lo.StringDecoder(this[le]):null,t&&t.debugExposeBuffer===!0&&Object.defineProperty(this,"buffer",{get:()=>this[D]}),t&&t.debugExposePipes===!0&&Object.defineProperty(this,"pipes",{get:()=>this[K]});let{signal:s}=t;s&&(this[fi]=s,s.aborted?this[Lr]():s.addEventListener("abort",()=>this[Lr]()))}get bufferLength(){return this[F]}get encoding(){return this[le]}set encoding(e){throw new Error("Encoding must be set at instantiation time")}setEncoding(e){throw new Error("Encoding must be set at instantiation time")}get objectMode(){return this[W]}set objectMode(e){throw new Error("objectMode must be set at instantiation time")}get async(){return this[be]}set async(e){this[be]=this[be]||!!e}[Lr](){this[cs]=!0,this.emit("abort",this[fi]?.reason),this.destroy(this[fi]?.reason)}get aborted(){return this[cs]}set aborted(e){}write(e,t,s){if(this[cs])return!1;if(this[Fe])throw new Error("write after end");if(this[R])return this.emit("error",Object.assign(new Error("Cannot call write after a stream was destroyed"),{code:"ERR_STREAM_DESTROYED"})),!0;typeof t=="function"&&(s=t,t="utf8"),t||(t="utf8");let r=this[be]?ui:kc;if(!this[W]&&!Buffer.isBuffer(e)){if(Oc(e))e=Buffer.from(e.buffer,e.byteOffset,e.byteLength);else if(Ac(e))e=Buffer.from(e);else if(typeof e!="string")throw new Error("Non-contiguous data written to non-objectMode stream")}return this[W]?(this[P]&&this[F]!==0&&this[os](!0),this[P]?this.emit("data",e):this[Ir](e),this[F]!==0&&this.emit("readable"),s&&r(s),this[P]):e.length?(typeof e=="string"&&!(t===this[le]&&!this[Mt]?.lastNeed)&&(e=Buffer.from(e,t)),Buffer.isBuffer(e)&&this[le]&&(e=this[Mt].write(e)),this[P]&&this[F]!==0&&this[os](!0),this[P]?this.emit("data",e):this[Ir](e),this[F]!==0&&this.emit("readable"),s&&r(s),this[P]):(this[F]!==0&&this.emit("readable"),s&&r(s),this[P])}read(e){if(this[R])return null;if(this[q]=!1,this[F]===0||e===0||e&&e>this[F])return this[Le](),null;this[W]&&(e=null),this[D].length>1&&!this[W]&&(this[D]=[this[le]?this[D].join(""):Buffer.concat(this[D],this[F])]);let t=this[Po](e||null,this[D][0]);return this[Le](),t}[Po](e,t){if(this[W])this[as]();else{let s=t;e===s.length||e===null?this[as]():typeof s=="string"?(this[D][0]=s.slice(e),t=s.slice(0,e),this[F]-=e):(this[D][0]=s.subarray(e),t=s.subarray(0,e),this[F]-=e)}return this.emit("data",t),!this[D].length&&!this[Fe]&&this.emit("drain"),t}end(e,t,s){return typeof e=="function"&&(s=e,e=void 0),typeof t=="function"&&(s=t,t="utf8"),e!==void 0&&this.write(e,t),s&&this.once("end",s),this[Fe]=!0,this.writable=!1,(this[P]||!this[hi])&&this[Le](),this}[Ut](){this[R]||(!this[mt]&&!this[K].length&&(this[q]=!0),this[hi]=!1,this[P]=!0,this.emit("resume"),this[D].length?this[os]():this[Fe]?this[Le]():this.emit("drain"))}resume(){return this[Ut]()}pause(){this[P]=!1,this[hi]=!0,this[q]=!1}get destroyed(){return this[R]}get flowing(){return this[P]}get paused(){return this[hi]}[Ir](e){this[W]?this[F]+=1:this[F]+=e.length,this[D].push(e)}[as](){return this[W]?this[F]-=1:this[F]-=this[D][0].length,this[D].shift()}[os](e=!1){do;while(this[Do](this[as]())&&this[D].length);!e&&!this[D].length&&!this[Fe]&&this.emit("drain")}[Do](e){return this.emit("data",e),this[P]}pipe(e,t){if(this[R])return e;this[q]=!1;let s=this[Ze];return t=t||{},e===Io.stdout||e===Io.stderr?t.end=!1:t.end=t.end!==!1,t.proxyErrors=!!t.proxyErrors,s?t.end&&e.end():(this[K].push(t.proxyErrors?new Nr(this,e,t):new ls(this,e,t)),this[be]?ui(()=>this[Ut]()):this[Ut]()),e}unpipe(e){let t=this[K].find(s=>s.dest===e);t&&(this[K].length===1?(this[P]&&this[mt]===0&&(this[P]=!1),this[K]=[]):this[K].splice(this[K].indexOf(t),1),t.unpipe())}addListener(e,t){return this.on(e,t)}on(e,t){let s=super.on(e,t);if(e==="data")this[q]=!1,this[mt]++,!this[K].length&&!this[P]&&this[Ut]();else if(e==="readable"&&this[F]!==0)super.emit("readable");else if(_c(e)&&this[Ze])super.emit(e),this.removeAllListeners(e);else if(e==="error"&&this[li]){let r=t;this[be]?ui(()=>r.call(this,this[li])):r.call(this,this[li])}return s}removeListener(e,t){return this.off(e,t)}off(e,t){let s=super.off(e,t);return e==="data"&&(this[mt]=this.listeners("data").length,this[mt]===0&&!this[q]&&!this[K].length&&(this[P]=!1)),s}removeAllListeners(e){let t=super.removeAllListeners(e);return(e==="data"||e===void 0)&&(this[mt]=0,!this[q]&&!this[K].length&&(this[P]=!1)),t}get emittedEnd(){return this[Ze]}[Le](){!this[rs]&&!this[Ze]&&!this[R]&&this[D].length===0&&this[Fe]&&(this[rs]=!0,this.emit("end"),this.emit("prefinish"),this.emit("finish"),this[ns]&&this.emit("close"),this[rs]=!1)}emit(e,...t){let s=t[0];if(e!=="error"&&e!=="close"&&e!==R&&this[R])return!1;if(e==="data")return!this[W]&&!s?!1:this[be]?(ui(()=>this[Dr](s)),!0):this[Dr](s);if(e==="end")return this[Fo]();if(e==="close"){if(this[ns]=!0,!this[Ze]&&!this[R])return!1;let n=super.emit("close");return this.removeAllListeners("close"),n}else if(e==="error"){this[li]=s,super.emit(Pr,s);let n=!this[fi]||this.listeners("error").length?super.emit("error",s):!1;return this[Le](),n}else if(e==="resume"){let n=super.emit("resume");return this[Le](),n}else if(e==="finish"||e==="prefinish"){let n=super.emit(e);return this.removeAllListeners(e),n}let r=super.emit(e,...t);return this[Le](),r}[Dr](e){for(let s of this[K])s.dest.write(e)===!1&&this.pause();let t=this[q]?!1:super.emit("data",e);return this[Le](),t}[Fo](){return this[Ze]?!1:(this[Ze]=!0,this.readable=!1,this[be]?(ui(()=>this[Fr]()),!0):this[Fr]())}[Fr](){if(this[Mt]){let t=this[Mt].end();if(t){for(let s of this[K])s.dest.write(t);this[q]||super.emit("data",t)}}for(let t of this[K])t.end();let e=super.emit("end");return this.removeAllListeners("end"),e}async collect(){let e=Object.assign([],{dataLength:0});this[W]||(e.dataLength=0);let t=this.promise();return this.on("data",s=>{e.push(s),this[W]||(e.dataLength+=s.length)}),await t,e}async concat(){if(this[W])throw new Error("cannot concat in objectMode");let e=await this.collect();return this[le]?e.join(""):Buffer.concat(e,e.dataLength)}async promise(){return new Promise((e,t)=>{this.on(R,()=>t(new Error("stream destroyed"))),this.on("error",s=>t(s)),this.on("end",()=>e())})}[Symbol.asyncIterator](){this[q]=!1;let e=!1,t=async()=>(this.pause(),e=!0,{value:void 0,done:!0});return{next:()=>{if(e)return t();let r=this.read();if(r!==null)return Promise.resolve({done:!1,value:r});if(this[Fe])return t();let n,o,a=h=>{this.off("data",c),this.off("end",l),this.off(R,f),t(),o(h)},c=h=>{this.off("error",a),this.off("end",l),this.off(R,f),this.pause(),n({value:h,done:!!this[Fe]})},l=()=>{this.off("error",a),this.off("data",c),this.off(R,f),t(),n({done:!0,value:void 0})},f=()=>a(new Error("stream destroyed"));return new Promise((h,m)=>{o=m,n=h,this.once(R,f),this.once("error",a),this.once("end",l),this.once("data",c)})},throw:t,return:t,[Symbol.asyncIterator](){return this}}}[Symbol.iterator](){this[q]=!1;let e=!1,t=()=>(this.pause(),this.off(Pr,t),this.off(R,t),this.off("end",t),e=!0,{done:!0,value:void 0}),s=()=>{if(e)return t();let r=this.read();return r===null?t():{done:!1,value:r}};return this.once("end",t),this.once(Pr,t),this.once(R,t),{next:s,throw:t,return:t,[Symbol.iterator](){return this}}}destroy(e){if(this[R])return e?this.emit("error",e):this.emit(R),this;this[R]=!0,this[q]=!0,this[D].length=0,this[F]=0;let t=this;return typeof t.close=="function"&&!this[ns]&&t.close(),e?this.emit("error",e):this.emit(R),this}static get isStream(){return Rc}};var Mo=p(require("zlib"),1);var No=p(require("zlib"),1),Pc=No.default.constants||{ZLIB_VERNUM:4736},Ne=Object.freeze(Object.assign(Object.create(null),{Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_VERSION_ERROR:-6,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,DEFLATE:1,INFLATE:2,GZIP:3,GUNZIP:4,DEFLATERAW:5,INFLATERAW:6,UNZIP:7,BROTLI_DECODE:8,BROTLI_ENCODE:9,Z_MIN_WINDOWBITS:8,Z_MAX_WINDOWBITS:15,Z_DEFAULT_WINDOWBITS:15,Z_MIN_CHUNK:64,Z_MAX_CHUNK:1/0,Z_DEFAULT_CHUNK:16384,Z_MIN_MEMLEVEL:1,Z_MAX_MEMLEVEL:9,Z_DEFAULT_MEMLEVEL:8,Z_MIN_LEVEL:-1,Z_MAX_LEVEL:9,Z_DEFAULT_LEVEL:-1,BROTLI_OPERATION_PROCESS:0,BROTLI_OPERATION_FLUSH:1,BROTLI_OPERATION_FINISH:2,BROTLI_OPERATION_EMIT_METADATA:3,BROTLI_MODE_GENERIC:0,BROTLI_MODE_TEXT:1,BROTLI_MODE_FONT:2,BROTLI_DEFAULT_MODE:0,BROTLI_MIN_QUALITY:0,BROTLI_MAX_QUALITY:11,BROTLI_DEFAULT_QUALITY:11,BROTLI_MIN_WINDOW_BITS:10,BROTLI_MAX_WINDOW_BITS:24,BROTLI_LARGE_MAX_WINDOW_BITS:30,BROTLI_DEFAULT_WINDOW:22,BROTLI_MIN_INPUT_BLOCK_BITS:16,BROTLI_MAX_INPUT_BLOCK_BITS:24,BROTLI_PARAM_MODE:0,BROTLI_PARAM_QUALITY:1,BROTLI_PARAM_LGWIN:2,BROTLI_PARAM_LGBLOCK:3,BROTLI_PARAM_DISABLE_LITERAL_CONTEXT_MODELING:4,BROTLI_PARAM_SIZE_HINT:5,BROTLI_PARAM_LARGE_WINDOW:6,BROTLI_PARAM_NPOSTFIX:7,BROTLI_PARAM_NDIRECT:8,BROTLI_DECODER_RESULT_ERROR:0,BROTLI_DECODER_RESULT_SUCCESS:1,BROTLI_DECODER_RESULT_NEEDS_MORE_INPUT:2,BROTLI_DECODER_RESULT_NEEDS_MORE_OUTPUT:3,BROTLI_DECODER_PARAM_DISABLE_RING_BUFFER_REALLOCATION:0,BROTLI_DECODER_PARAM_LARGE_WINDOW:1,BROTLI_DECODER_NO_ERROR:0,BROTLI_DECODER_SUCCESS:1,BROTLI_DECODER_NEEDS_MORE_INPUT:2,BROTLI_DECODER_NEEDS_MORE_OUTPUT:3,BROTLI_DECODER_ERROR_FORMAT_EXUBERANT_NIBBLE:-1,BROTLI_DECODER_ERROR_FORMAT_RESERVED:-2,BROTLI_DECODER_ERROR_FORMAT_EXUBERANT_META_NIBBLE:-3,BROTLI_DECODER_ERROR_FORMAT_SIMPLE_HUFFMAN_ALPHABET:-4,BROTLI_DECODER_ERROR_FORMAT_SIMPLE_HUFFMAN_SAME:-5,BROTLI_DECODER_ERROR_FORMAT_CL_SPACE:-6,BROTLI_DECODER_ERROR_FORMAT_HUFFMAN_SPACE:-7,BROTLI_DECODER_ERROR_FORMAT_CONTEXT_MAP_REPEAT:-8,BROTLI_DECODER_ERROR_FORMAT_BLOCK_LENGTH_1:-9,BROTLI_DECODER_ERROR_FORMAT_BLOCK_LENGTH_2:-10,BROTLI_DECODER_ERROR_FORMAT_TRANSFORM:-11,BROTLI_DECODER_ERROR_FORMAT_DICTIONARY:-12,BROTLI_DECODER_ERROR_FORMAT_WINDOW_BITS:-13,BROTLI_DECODER_ERROR_FORMAT_PADDING_1:-14,BROTLI_DECODER_ERROR_FORMAT_PADDING_2:-15,BROTLI_DECODER_ERROR_FORMAT_DISTANCE:-16,BROTLI_DECODER_ERROR_DICTIONARY_NOT_SET:-19,BROTLI_DECODER_ERROR_INVALID_ARGUMENTS:-20,BROTLI_DECODER_ERROR_ALLOC_CONTEXT_MODES:-21,BROTLI_DECODER_ERROR_ALLOC_TREE_GROUPS:-22,BROTLI_DECODER_ERROR_ALLOC_CONTEXT_MAP:-25,BROTLI_DECODER_ERROR_ALLOC_RING_BUFFER_1:-26,BROTLI_DECODER_ERROR_ALLOC_RING_BUFFER_2:-27,BROTLI_DECODER_ERROR_ALLOC_BLOCK_TYPE_TREES:-30,BROTLI_DECODER_ERROR_UNREACHABLE:-31},Pc));var Co=Ce.Buffer.concat,pt=Symbol("_superWrite"),Bt=class extends Error{code;errno;constructor(e){super("zlib: "+e.message),this.code=e.code,this.errno=e.errno,this.code||(this.code="ZLIB_ERROR"),this.message="zlib: "+e.message,Error.captureStackTrace(this,this.constructor)}get name(){return"ZlibError"}},Mr=Symbol("flushFlag"),us=class extends di{#e=!1;#s=!1;#t;#o;#n;#i;#r;get sawError(){return this.#e}get handle(){return this.#i}get flushFlag(){return this.#t}constructor(e,t){if(!e||typeof e!="object")throw new TypeError("invalid options for ZlibBase constructor");super(e),this.#t=e.flush??0,this.#o=e.finishFlush??0,this.#n=e.fullFlushFlag??0;try{this.#i=new Mo.default[t](e)}catch(s){throw new Bt(s)}this.#r=s=>{this.#e||(this.#e=!0,this.close(),this.emit("error",s))},this.#i?.on("error",s=>this.#r(new Bt(s))),this.once("end",()=>this.close)}close(){this.#i&&(this.#i.close(),this.#i=void 0,this.emit("close"))}reset(){if(!this.#e)return(0,fs.default)(this.#i,"zlib binding closed"),this.#i.reset?.()}flush(e){this.ended||(typeof e!="number"&&(e=this.#n),this.write(Object.assign(Ce.Buffer.alloc(0),{[Mr]:e})))}end(e,t,s){return typeof e=="function"&&(s=e,t=void 0,e=void 0),typeof t=="function"&&(s=t,t=void 0),e&&(t?this.write(e,t):this.write(e)),this.flush(this.#o),this.#s=!0,super.end(s)}get ended(){return this.#s}[pt](e){return super.write(e)}write(e,t,s){if(typeof t=="function"&&(s=t,t="utf8"),typeof e=="string"&&(e=Ce.Buffer.from(e,t)),this.#e)return;(0,fs.default)(this.#i,"zlib binding closed");let r=this.#i._handle,n=r.close;r.close=()=>{};let o=this.#i.close;this.#i.close=()=>{},Ce.Buffer.concat=l=>l;let a;try{let l=typeof e[Mr]=="number"?e[Mr]:this.#t;a=this.#i._processChunk(e,l),Ce.Buffer.concat=Co}catch(l){Ce.Buffer.concat=Co,this.#r(new Bt(l))}finally{this.#i&&(this.#i._handle=r,r.close=n,this.#i.close=o,this.#i.removeAllListeners("error"))}this.#i&&this.#i.on("error",l=>this.#r(new Bt(l)));let c;if(a)if(Array.isArray(a)&&a.length>0){let l=a[0];c=this[pt](Ce.Buffer.from(l));for(let f=1;f<a.length;f++)c=this[pt](a[f])}else c=this[pt](Ce.Buffer.from(a));return s&&s(),c}},ds=class extends us{#e;#s;constructor(e,t){e=e||{},e.flush=e.flush||Ne.Z_NO_FLUSH,e.finishFlush=e.finishFlush||Ne.Z_FINISH,e.fullFlushFlag=Ne.Z_FULL_FLUSH,super(e,t),this.#e=e.level,this.#s=e.strategy}params(e,t){if(!this.sawError){if(!this.handle)throw new Error("cannot switch params when binding is closed");if(!this.handle.params)throw new Error("not supported in this implementation");if(this.#e!==e||this.#s!==t){this.flush(Ne.Z_SYNC_FLUSH),(0,fs.default)(this.handle,"zlib binding closed");let s=this.handle.flush;this.handle.flush=(r,n)=>{typeof r=="function"&&(n=r,r=this.flushFlag),this.flush(r),n?.()};try{this.handle.params(e,t)}finally{this.handle.flush=s}this.handle&&(this.#e=e,this.#s=t)}}}};var ms=class extends ds{#e;constructor(e){super(e,"Gzip"),this.#e=e&&!!e.portable}[pt](e){return this.#e?(this.#e=!1,e[9]=255,super[pt](e)):super[pt](e)}};var ps=class extends ds{constructor(e){super(e,"Unzip")}},gs=class extends us{constructor(e,t){e=e||{},e.flush=e.flush||Ne.BROTLI_OPERATION_PROCESS,e.finishFlush=e.finishFlush||Ne.BROTLI_OPERATION_FINISH,e.fullFlushFlag=Ne.BROTLI_OPERATION_FLUSH,super(e,t)}},ys=class extends gs{constructor(e){super(e,"BrotliCompress")}},bs=class extends gs{constructor(e){super(e,"BrotliDecompress")}};var zt=class i{tail;head;length=0;static create(e=[]){return new i(e)}constructor(e=[]){for(let t of e)this.push(t)}*[Symbol.iterator](){for(let e=this.head;e;e=e.next)yield e.value}removeNode(e){if(e.list!==this)throw new Error("removing node which does not belong to this list");let t=e.next,s=e.prev;return t&&(t.prev=s),s&&(s.next=t),e===this.head&&(this.head=t),e===this.tail&&(this.tail=s),this.length--,e.next=void 0,e.prev=void 0,e.list=void 0,t}unshiftNode(e){if(e===this.head)return;e.list&&e.list.removeNode(e);let t=this.head;e.list=this,e.next=t,t&&(t.prev=e),this.head=e,this.tail||(this.tail=e),this.length++}pushNode(e){if(e===this.tail)return;e.list&&e.list.removeNode(e);let t=this.tail;e.list=this,e.prev=t,t&&(t.next=e),this.tail=e,this.head||(this.head=e),this.length++}push(...e){for(let t=0,s=e.length;t<s;t++)Lc(this,e[t]);return this.length}unshift(...e){for(var t=0,s=e.length;t<s;t++)Nc(this,e[t]);return this.length}pop(){if(!this.tail)return;let e=this.tail.value,t=this.tail;return this.tail=this.tail.prev,this.tail?this.tail.next=void 0:this.head=void 0,t.list=void 0,this.length--,e}shift(){if(!this.head)return;let e=this.head.value,t=this.head;return this.head=this.head.next,this.head?this.head.prev=void 0:this.tail=void 0,t.list=void 0,this.length--,e}forEach(e,t){t=t||this;for(let s=this.head,r=0;s;r++)e.call(t,s.value,r,this),s=s.next}forEachReverse(e,t){t=t||this;for(let s=this.tail,r=this.length-1;s;r--)e.call(t,s.value,r,this),s=s.prev}get(e){let t=0,s=this.head;for(;s&&t<e;t++)s=s.next;if(t===e&&s)return s.value}getReverse(e){let t=0,s=this.tail;for(;s&&t<e;t++)s=s.prev;if(t===e&&s)return s.value}map(e,t){t=t||this;let s=new i;for(let r=this.head;r;)s.push(e.call(t,r.value,this)),r=r.next;return s}mapReverse(e,t){t=t||this;var s=new i;for(let r=this.tail;r;)s.push(e.call(t,r.value,this)),r=r.prev;return s}reduce(e,t){let s,r=this.head;if(arguments.length>1)s=t;else if(this.head)r=this.head.next,s=this.head.value;else throw new TypeError("Reduce of empty list with no initial value");for(var n=0;r;n++)s=e(s,r.value,n),r=r.next;return s}reduceReverse(e,t){let s,r=this.tail;if(arguments.length>1)s=t;else if(this.tail)r=this.tail.prev,s=this.tail.value;else throw new TypeError("Reduce of empty list with no initial value");for(let n=this.length-1;r;n--)s=e(s,r.value,n),r=r.prev;return s}toArray(){let e=new Array(this.length);for(let t=0,s=this.head;s;t++)e[t]=s.value,s=s.next;return e}toArrayReverse(){let e=new Array(this.length);for(let t=0,s=this.tail;s;t++)e[t]=s.value,s=s.prev;return e}slice(e=0,t=this.length){t<0&&(t+=this.length),e<0&&(e+=this.length);let s=new i;if(t<e||t<0)return s;e<0&&(e=0),t>this.length&&(t=this.length);let r=this.head,n=0;for(n=0;r&&n<e;n++)r=r.next;for(;r&&n<t;n++,r=r.next)s.push(r.value);return s}sliceReverse(e=0,t=this.length){t<0&&(t+=this.length),e<0&&(e+=this.length);let s=new i;if(t<e||t<0)return s;e<0&&(e=0),t>this.length&&(t=this.length);let r=this.length,n=this.tail;for(;n&&r>t;r--)n=n.prev;for(;n&&r>e;r--,n=n.prev)s.push(n.value);return s}splice(e,t=0,...s){e>this.length&&(e=this.length-1),e<0&&(e=this.length+e);let r=this.head;for(let o=0;r&&o<e;o++)r=r.next;let n=[];for(let o=0;r&&o<t;o++)n.push(r.value),r=this.removeNode(r);r?r!==this.tail&&(r=r.prev):r=this.tail;for(let o of s)r=Fc(this,r,o);return n}reverse(){let e=this.head,t=this.tail;for(let s=e;s;s=s.prev){let r=s.prev;s.prev=s.next,s.next=r}return this.head=t,this.tail=e,this}};function Fc(i,e,t){let s=e,r=e?e.next:i.head,n=new mi(t,s,r,i);return n.next===void 0&&(i.tail=n),n.prev===void 0&&(i.head=n),i.length++,n}function Lc(i,e){i.tail=new mi(e,i.tail,void 0,i),i.head||(i.head=i.tail),i.length++}function Nc(i,e){i.head=new mi(e,void 0,i.head,i),i.tail||(i.tail=i.head),i.length++}var mi=class{list;next;prev;value;constructor(e,t,s,r){this.list=r,this.value=e,t?(t.next=this,this.prev=t):this.prev=void 0,s?(s.prev=this,this.next=s):this.next=void 0}};var bt=require("node:path");var Uo=(i,e)=>{if(Number.isSafeInteger(i))i<0?Mc(i,e):Cc(i,e);else throw Error("cannot encode number outside of javascript safe integer range");return e},Cc=(i,e)=>{e[0]=128;for(var t=e.length;t>1;t--)e[t-1]=i&255,i=Math.floor(i/256)},Mc=(i,e)=>{e[0]=255;var t=!1;i=i*-1;for(var s=e.length;s>1;s--){var r=i&255;i=Math.floor(i/256),t?e[s-1]=zo(r):r===0?e[s-1]=0:(t=!0,e[s-1]=Wo(r))}},Bo=i=>{let e=i[0],t=e===128?Bc(i.subarray(1,i.length)):e===255?Uc(i):null;if(t===null)throw Error("invalid base256 encoding");if(!Number.isSafeInteger(t))throw Error("parsed number outside of javascript safe integer range");return t},Uc=i=>{for(var e=i.length,t=0,s=!1,r=e-1;r>-1;r--){var n=Number(i[r]),o;s?o=zo(n):n===0?o=n:(s=!0,o=Wo(n)),o!==0&&(t-=o*Math.pow(256,e-r-1))}return t},Bc=i=>{for(var e=i.length,t=0,s=e-1;s>-1;s--){var r=Number(i[s]);r!==0&&(t+=r*Math.pow(256,e-s-1))}return t},zo=i=>(255^i)&255,Wo=i=>(255^i)+1&255;var ws=i=>Ss.has(i);var Ss=new Map([["0","File"],["","OldFile"],["1","Link"],["2","SymbolicLink"],["3","CharacterDevice"],["4","BlockDevice"],["5","Directory"],["6","FIFO"],["7","ContiguousFile"],["g","GlobalExtendedHeader"],["x","ExtendedHeader"],["A","SolarisACL"],["D","GNUDumpDir"],["I","Inode"],["K","NextFileHasLongLinkpath"],["L","NextFileHasLongPath"],["M","ContinuationFile"],["N","OldGnuLongPath"],["S","SparseFile"],["V","TapeVolumeHeader"],["X","OldExtendedHeader"]]),jo=new Map(Array.from(Ss).map(i=>[i[1],i[0]]));var Q=class{cksumValid=!1;needPax=!1;nullBlock=!1;block;path;mode;uid;gid;size;cksum;#e="Unsupported";linkpath;uname;gname;devmaj=0;devmin=0;atime;ctime;mtime;charset;comment;constructor(e,t=0,s,r){Buffer.isBuffer(e)?this.decode(e,t||0,s,r):e&&this.#s(e)}decode(e,t,s,r){if(t||(t=0),!e||!(e.length>=t+512))throw new Error("need 512 bytes for header");this.path=gt(e,t,100),this.mode=Ye(e,t+100,8),this.uid=Ye(e,t+108,8),this.gid=Ye(e,t+116,8),this.size=Ye(e,t+124,12),this.mtime=Ur(e,t+136,12),this.cksum=Ye(e,t+148,12),r&&this.#s(r,!0),s&&this.#s(s);let n=gt(e,t+156,1);if(ws(n)&&(this.#e=n||"0"),this.#e==="0"&&this.path.slice(-1)==="/"&&(this.#e="5"),this.#e==="5"&&(this.size=0),this.linkpath=gt(e,t+157,100),e.subarray(t+257,t+265).toString()==="ustar\x0000")if(this.uname=gt(e,t+265,32),this.gname=gt(e,t+297,32),this.devmaj=Ye(e,t+329,8)??0,this.devmin=Ye(e,t+337,8)??0,e[t+475]!==0){let a=gt(e,t+345,155);this.path=a+"/"+this.path}else{let a=gt(e,t+345,130);a&&(this.path=a+"/"+this.path),this.atime=Ur(e,t+476,12),this.ctime=Ur(e,t+488,12)}let o=8*32;for(let a=t;a<t+148;a++)o+=e[a];for(let a=t+156;a<t+512;a++)o+=e[a];this.cksumValid=o===this.cksum,this.cksum===void 0&&o===8*32&&(this.nullBlock=!0)}#s(e,t=!1){Object.assign(this,Object.fromEntries(Object.entries(e).filter(([s,r])=>!(r==null||s==="path"&&t||s==="linkpath"&&t||s==="global"))))}encode(e,t=0){if(e||(e=this.block=Buffer.alloc(512)),this.#e==="Unsupported"&&(this.#e="0"),!(e.length>=t+512))throw new Error("need 512 bytes for header");let s=this.ctime||this.atime?130:155,r=Wc(this.path||"",s),n=r[0],o=r[1];this.needPax=!!r[2],this.needPax=yt(e,t,100,n)||this.needPax,this.needPax=Xe(e,t+100,8,this.mode)||this.needPax,this.needPax=Xe(e,t+108,8,this.uid)||this.needPax,this.needPax=Xe(e,t+116,8,this.gid)||this.needPax,this.needPax=Xe(e,t+124,12,this.size)||this.needPax,this.needPax=Br(e,t+136,12,this.mtime)||this.needPax,e[t+156]=this.#e.charCodeAt(0),this.needPax=yt(e,t+157,100,this.linkpath)||this.needPax,e.write("ustar\x0000",t+257,8),this.needPax=yt(e,t+265,32,this.uname)||this.needPax,this.needPax=yt(e,t+297,32,this.gname)||this.needPax,this.needPax=Xe(e,t+329,8,this.devmaj)||this.needPax,this.needPax=Xe(e,t+337,8,this.devmin)||this.needPax,this.needPax=yt(e,t+345,s,o)||this.needPax,e[t+475]!==0?this.needPax=yt(e,t+345,155,o)||this.needPax:(this.needPax=yt(e,t+345,130,o)||this.needPax,this.needPax=Br(e,t+476,12,this.atime)||this.needPax,this.needPax=Br(e,t+488,12,this.ctime)||this.needPax);let a=8*32;for(let c=t;c<t+148;c++)a+=e[c];for(let c=t+156;c<t+512;c++)a+=e[c];return this.cksum=a,Xe(e,t+148,8,this.cksum),this.cksumValid=!0,this.needPax}get type(){return this.#e==="Unsupported"?this.#e:Ss.get(this.#e)}get typeKey(){return this.#e}set type(e){let t=String(jo.get(e));if(ws(t)||t==="Unsupported")this.#e=t;else if(ws(e))this.#e=e;else throw new TypeError("invalid entry type: "+e)}},Wc=(i,e)=>{let s=i,r="",n,o=bt.posix.parse(i).root||".";if(Buffer.byteLength(s)<100)n=[s,r,!1];else{r=bt.posix.dirname(s),s=bt.posix.basename(s);do Buffer.byteLength(s)<=100&&Buffer.byteLength(r)<=e?n=[s,r,!1]:Buffer.byteLength(s)>100&&Buffer.byteLength(r)<=e?n=[s.slice(0,99),r,!0]:(s=bt.posix.join(bt.posix.basename(r),s),r=bt.posix.dirname(r));while(r!==o&&n===void 0);n||(n=[i.slice(0,99),"",!0])}return n},gt=(i,e,t)=>i.subarray(e,e+t).toString("utf8").replace(/\0.*/,""),Ur=(i,e,t)=>jc(Ye(i,e,t)),jc=i=>i===void 0?void 0:new Date(i*1e3),Ye=(i,e,t)=>Number(i[e])&128?Bo(i.subarray(e,e+t)):Vc(i,e,t),Hc=i=>isNaN(i)?void 0:i,Vc=(i,e,t)=>Hc(parseInt(i.subarray(e,e+t).toString("utf8").replace(/\0.*$/,"").trim(),8)),Gc={12:8589934591,8:2097151},Xe=(i,e,t,s)=>s===void 0?!1:s>Gc[t]||s<0?(Uo(s,i.subarray(e,e+t)),!0):(Kc(i,e,t,s),!1),Kc=(i,e,t,s)=>i.write(Zc(s,t),e,t,"ascii"),Zc=(i,e)=>Yc(Math.floor(i).toString(8),e),Yc=(i,e)=>(i.length===e-1?i:new Array(e-i.length-1).join("0")+i+" ")+"\0",Br=(i,e,t,s)=>s===void 0?!1:Xe(i,e,t,s.getTime()/1e3),Xc=new Array(156).join("\0"),yt=(i,e,t,s)=>s===void 0?!1:(i.write(s+Xc,e,t,"utf8"),s.length!==Buffer.byteLength(s)||s.length>t);var Vo=require("node:path");var Je=class i{atime;mtime;ctime;charset;comment;gid;uid;gname;uname;linkpath;dev;ino;nlink;path;size;mode;global;constructor(e,t=!1){this.atime=e.atime,this.charset=e.charset,this.comment=e.comment,this.ctime=e.ctime,this.dev=e.dev,this.gid=e.gid,this.global=t,this.gname=e.gname,this.ino=e.ino,this.linkpath=e.linkpath,this.mtime=e.mtime,this.nlink=e.nlink,this.path=e.path,this.size=e.size,this.uid=e.uid,this.uname=e.uname}encode(){let e=this.encodeBody();if(e==="")return Buffer.allocUnsafe(0);let t=Buffer.byteLength(e),s=512*Math.ceil(1+t/512),r=Buffer.allocUnsafe(s);for(let n=0;n<512;n++)r[n]=0;new Q({path:("PaxHeader/"+(0,Vo.basename)(this.path??"")).slice(0,99),mode:this.mode||420,uid:this.uid,gid:this.gid,size:t,mtime:this.mtime,type:this.global?"GlobalExtendedHeader":"ExtendedHeader",linkpath:"",uname:this.uname||"",gname:this.gname||"",devmaj:0,devmin:0,atime:this.atime,ctime:this.ctime}).encode(r),r.write(e,512,t,"utf8");for(let n=t+512;n<r.length;n++)r[n]=0;return r}encodeBody(){return this.encodeField("path")+this.encodeField("ctime")+this.encodeField("atime")+this.encodeField("dev")+this.encodeField("ino")+this.encodeField("nlink")+this.encodeField("charset")+this.encodeField("comment")+this.encodeField("gid")+this.encodeField("gname")+this.encodeField("linkpath")+this.encodeField("mtime")+this.encodeField("size")+this.encodeField("uid")+this.encodeField("uname")}encodeField(e){if(this[e]===void 0)return"";let t=this[e],s=t instanceof Date?t.getTime()/1e3:t,r=" "+(e==="dev"||e==="ino"||e==="nlink"?"SCHILY.":"")+e+"="+s+`
`,n=Buffer.byteLength(r),o=Math.floor(Math.log(n)/Math.log(10))+1;return n+o>=Math.pow(10,o)&&(o+=1),o+n+r}static parse(e,t,s=!1){return new i(Jc(qc(e),t),s)}},Jc=(i,e)=>e?Object.assign({},e,i):i,qc=i=>i.replace(/\n$/,"").split(`
`).reduce(Qc,Object.create(null)),Qc=(i,e)=>{let t=parseInt(e,10);if(t!==Buffer.byteLength(e)+1)return i;e=e.slice((t+" ").length);let s=e.split("="),r=s.shift();if(!r)return i;let n=r.replace(/^SCHILY\.(dev|ino|nlink)/,"$1"),o=s.join("=");return i[n]=/^([A-Z]+\.)?([mac]|birth|creation)time$/.test(n)?new Date(Number(o)*1e3):/^[0-9]+$/.test(o)?+o:o,i};var _s=require("node:events"),Kr=p(require("node:stream"),1),Xo=require("node:string_decoder"),Go=typeof process=="object"&&process?process:{stdout:null,stderr:null},el=i=>!!i&&typeof i=="object"&&(i instanceof Se||i instanceof Kr.default||tl(i)||il(i)),tl=i=>!!i&&typeof i=="object"&&i instanceof _s.EventEmitter&&typeof i.pipe=="function"&&i.pipe!==Kr.default.Writable.prototype.pipe,il=i=>!!i&&typeof i=="object"&&i instanceof _s.EventEmitter&&typeof i.write=="function"&&typeof i.end=="function",Me=Symbol("EOF"),Ue=Symbol("maybeEmitEnd"),qe=Symbol("emittedEnd"),Es=Symbol("emittingEnd"),pi=Symbol("emittedError"),xs=Symbol("closed"),Ko=Symbol("read"),Rs=Symbol("flush"),Zo=Symbol("flushChunk"),he=Symbol("encoding"),Wt=Symbol("decoder"),L=Symbol("flowing"),gi=Symbol("paused"),jt=Symbol("resume"),N=Symbol("buffer"),Z=Symbol("pipes"),C=Symbol("bufferLength"),zr=Symbol("bufferPush"),$s=Symbol("bufferShift"),j=Symbol("objectMode"),$=Symbol("destroyed"),Wr=Symbol("error"),jr=Symbol("emitData"),Yo=Symbol("emitEnd"),Hr=Symbol("emitEnd2"),we=Symbol("async"),Vr=Symbol("abort"),Ts=Symbol("aborted"),yi=Symbol("signal"),wt=Symbol("dataListeners"),ee=Symbol("discarded"),bi=i=>Promise.resolve().then(i),sl=i=>i(),rl=i=>i==="end"||i==="finish"||i==="prefinish",nl=i=>i instanceof ArrayBuffer||!!i&&typeof i=="object"&&i.constructor&&i.constructor.name==="ArrayBuffer"&&i.byteLength>=0,ol=i=>!Buffer.isBuffer(i)&&ArrayBuffer.isView(i),ks=class{src;dest;opts;ondrain;constructor(e,t,s){this.src=e,this.dest=t,this.opts=s,this.ondrain=()=>e[jt](),this.dest.on("drain",this.ondrain)}unpipe(){this.dest.removeListener("drain",this.ondrain)}proxyErrors(e){}end(){this.unpipe(),this.opts.end&&this.dest.end()}},Gr=class extends ks{unpipe(){this.src.removeListener("error",this.proxyErrors),super.unpipe()}constructor(e,t,s){super(e,t,s),this.proxyErrors=r=>t.emit("error",r),e.on("error",this.proxyErrors)}},al=i=>!!i.objectMode,cl=i=>!i.objectMode&&!!i.encoding&&i.encoding!=="buffer",Se=class extends _s.EventEmitter{[L]=!1;[gi]=!1;[Z]=[];[N]=[];[j];[he];[we];[Wt];[Me]=!1;[qe]=!1;[Es]=!1;[xs]=!1;[pi]=null;[C]=0;[$]=!1;[yi];[Ts]=!1;[wt]=0;[ee]=!1;writable=!0;readable=!0;constructor(...e){let t=e[0]||{};if(super(),t.objectMode&&typeof t.encoding=="string")throw new TypeError("Encoding and objectMode may not be used together");al(t)?(this[j]=!0,this[he]=null):cl(t)?(this[he]=t.encoding,this[j]=!1):(this[j]=!1,this[he]=null),this[we]=!!t.async,this[Wt]=this[he]?new Xo.StringDecoder(this[he]):null,t&&t.debugExposeBuffer===!0&&Object.defineProperty(this,"buffer",{get:()=>this[N]}),t&&t.debugExposePipes===!0&&Object.defineProperty(this,"pipes",{get:()=>this[Z]});let{signal:s}=t;s&&(this[yi]=s,s.aborted?this[Vr]():s.addEventListener("abort",()=>this[Vr]()))}get bufferLength(){return this[C]}get encoding(){return this[he]}set encoding(e){throw new Error("Encoding must be set at instantiation time")}setEncoding(e){throw new Error("Encoding must be set at instantiation time")}get objectMode(){return this[j]}set objectMode(e){throw new Error("objectMode must be set at instantiation time")}get async(){return this[we]}set async(e){this[we]=this[we]||!!e}[Vr](){this[Ts]=!0,this.emit("abort",this[yi]?.reason),this.destroy(this[yi]?.reason)}get aborted(){return this[Ts]}set aborted(e){}write(e,t,s){if(this[Ts])return!1;if(this[Me])throw new Error("write after end");if(this[$])return this.emit("error",Object.assign(new Error("Cannot call write after a stream was destroyed"),{code:"ERR_STREAM_DESTROYED"})),!0;typeof t=="function"&&(s=t,t="utf8"),t||(t="utf8");let r=this[we]?bi:sl;if(!this[j]&&!Buffer.isBuffer(e)){if(ol(e))e=Buffer.from(e.buffer,e.byteOffset,e.byteLength);else if(nl(e))e=Buffer.from(e);else if(typeof e!="string")throw new Error("Non-contiguous data written to non-objectMode stream")}return this[j]?(this[L]&&this[C]!==0&&this[Rs](!0),this[L]?this.emit("data",e):this[zr](e),this[C]!==0&&this.emit("readable"),s&&r(s),this[L]):e.length?(typeof e=="string"&&!(t===this[he]&&!this[Wt]?.lastNeed)&&(e=Buffer.from(e,t)),Buffer.isBuffer(e)&&this[he]&&(e=this[Wt].write(e)),this[L]&&this[C]!==0&&this[Rs](!0),this[L]?this.emit("data",e):this[zr](e),this[C]!==0&&this.emit("readable"),s&&r(s),this[L]):(this[C]!==0&&this.emit("readable"),s&&r(s),this[L])}read(e){if(this[$])return null;if(this[ee]=!1,this[C]===0||e===0||e&&e>this[C])return this[Ue](),null;this[j]&&(e=null),this[N].length>1&&!this[j]&&(this[N]=[this[he]?this[N].join(""):Buffer.concat(this[N],this[C])]);let t=this[Ko](e||null,this[N][0]);return this[Ue](),t}[Ko](e,t){if(this[j])this[$s]();else{let s=t;e===s.length||e===null?this[$s]():typeof s=="string"?(this[N][0]=s.slice(e),t=s.slice(0,e),this[C]-=e):(this[N][0]=s.subarray(e),t=s.subarray(0,e),this[C]-=e)}return this.emit("data",t),!this[N].length&&!this[Me]&&this.emit("drain"),t}end(e,t,s){return typeof e=="function"&&(s=e,e=void 0),typeof t=="function"&&(s=t,t="utf8"),e!==void 0&&this.write(e,t),s&&this.once("end",s),this[Me]=!0,this.writable=!1,(this[L]||!this[gi])&&this[Ue](),this}[jt](){this[$]||(!this[wt]&&!this[Z].length&&(this[ee]=!0),this[gi]=!1,this[L]=!0,this.emit("resume"),this[N].length?this[Rs]():this[Me]?this[Ue]():this.emit("drain"))}resume(){return this[jt]()}pause(){this[L]=!1,this[gi]=!0,this[ee]=!1}get destroyed(){return this[$]}get flowing(){return this[L]}get paused(){return this[gi]}[zr](e){this[j]?this[C]+=1:this[C]+=e.length,this[N].push(e)}[$s](){return this[j]?this[C]-=1:this[C]-=this[N][0].length,this[N].shift()}[Rs](e=!1){do;while(this[Zo](this[$s]())&&this[N].length);!e&&!this[N].length&&!this[Me]&&this.emit("drain")}[Zo](e){return this.emit("data",e),this[L]}pipe(e,t){if(this[$])return e;this[ee]=!1;let s=this[qe];return t=t||{},e===Go.stdout||e===Go.stderr?t.end=!1:t.end=t.end!==!1,t.proxyErrors=!!t.proxyErrors,s?t.end&&e.end():(this[Z].push(t.proxyErrors?new Gr(this,e,t):new ks(this,e,t)),this[we]?bi(()=>this[jt]()):this[jt]()),e}unpipe(e){let t=this[Z].find(s=>s.dest===e);t&&(this[Z].length===1?(this[L]&&this[wt]===0&&(this[L]=!1),this[Z]=[]):this[Z].splice(this[Z].indexOf(t),1),t.unpipe())}addListener(e,t){return this.on(e,t)}on(e,t){let s=super.on(e,t);if(e==="data")this[ee]=!1,this[wt]++,!this[Z].length&&!this[L]&&this[jt]();else if(e==="readable"&&this[C]!==0)super.emit("readable");else if(rl(e)&&this[qe])super.emit(e),this.removeAllListeners(e);else if(e==="error"&&this[pi]){let r=t;this[we]?bi(()=>r.call(this,this[pi])):r.call(this,this[pi])}return s}removeListener(e,t){return this.off(e,t)}off(e,t){let s=super.off(e,t);return e==="data"&&(this[wt]=this.listeners("data").length,this[wt]===0&&!this[ee]&&!this[Z].length&&(this[L]=!1)),s}removeAllListeners(e){let t=super.removeAllListeners(e);return(e==="data"||e===void 0)&&(this[wt]=0,!this[ee]&&!this[Z].length&&(this[L]=!1)),t}get emittedEnd(){return this[qe]}[Ue](){!this[Es]&&!this[qe]&&!this[$]&&this[N].length===0&&this[Me]&&(this[Es]=!0,this.emit("end"),this.emit("prefinish"),this.emit("finish"),this[xs]&&this.emit("close"),this[Es]=!1)}emit(e,...t){let s=t[0];if(e!=="error"&&e!=="close"&&e!==$&&this[$])return!1;if(e==="data")return!this[j]&&!s?!1:this[we]?(bi(()=>this[jr](s)),!0):this[jr](s);if(e==="end")return this[Yo]();if(e==="close"){if(this[xs]=!0,!this[qe]&&!this[$])return!1;let n=super.emit("close");return this.removeAllListeners("close"),n}else if(e==="error"){this[pi]=s,super.emit(Wr,s);let n=!this[yi]||this.listeners("error").length?super.emit("error",s):!1;return this[Ue](),n}else if(e==="resume"){let n=super.emit("resume");return this[Ue](),n}else if(e==="finish"||e==="prefinish"){let n=super.emit(e);return this.removeAllListeners(e),n}let r=super.emit(e,...t);return this[Ue](),r}[jr](e){for(let s of this[Z])s.dest.write(e)===!1&&this.pause();let t=this[ee]?!1:super.emit("data",e);return this[Ue](),t}[Yo](){return this[qe]?!1:(this[qe]=!0,this.readable=!1,this[we]?(bi(()=>this[Hr]()),!0):this[Hr]())}[Hr](){if(this[Wt]){let t=this[Wt].end();if(t){for(let s of this[Z])s.dest.write(t);this[ee]||super.emit("data",t)}}for(let t of this[Z])t.end();let e=super.emit("end");return this.removeAllListeners("end"),e}async collect(){let e=Object.assign([],{dataLength:0});this[j]||(e.dataLength=0);let t=this.promise();return this.on("data",s=>{e.push(s),this[j]||(e.dataLength+=s.length)}),await t,e}async concat(){if(this[j])throw new Error("cannot concat in objectMode");let e=await this.collect();return this[he]?e.join(""):Buffer.concat(e,e.dataLength)}async promise(){return new Promise((e,t)=>{this.on($,()=>t(new Error("stream destroyed"))),this.on("error",s=>t(s)),this.on("end",()=>e())})}[Symbol.asyncIterator](){this[ee]=!1;let e=!1,t=async()=>(this.pause(),e=!0,{value:void 0,done:!0});return{next:()=>{if(e)return t();let r=this.read();if(r!==null)return Promise.resolve({done:!1,value:r});if(this[Me])return t();let n,o,a=h=>{this.off("data",c),this.off("end",l),this.off($,f),t(),o(h)},c=h=>{this.off("error",a),this.off("end",l),this.off($,f),this.pause(),n({value:h,done:!!this[Me]})},l=()=>{this.off("error",a),this.off("data",c),this.off($,f),t(),n({done:!0,value:void 0})},f=()=>a(new Error("stream destroyed"));return new Promise((h,m)=>{o=m,n=h,this.once($,f),this.once("error",a),this.once("end",l),this.once("data",c)})},throw:t,return:t,[Symbol.asyncIterator](){return this}}}[Symbol.iterator](){this[ee]=!1;let e=!1,t=()=>(this.pause(),this.off(Wr,t),this.off($,t),this.off("end",t),e=!0,{done:!0,value:void 0}),s=()=>{if(e)return t();let r=this.read();return r===null?t():{done:!1,value:r}};return this.once("end",t),this.once(Wr,t),this.once($,t),{next:s,throw:t,return:t,[Symbol.iterator](){return this}}}destroy(e){if(this[$])return e?this.emit("error",e):this.emit($),this;this[$]=!0,this[ee]=!0,this[N].length=0,this[C]=0;let t=this;return typeof t.close=="function"&&!this[xs]&&t.close(),e?this.emit("error",e):this.emit($),this}static get isStream(){return el}};var ll=process.env.TESTING_TAR_FAKE_PLATFORM||process.platform,u=ll!=="win32"?i=>i:i=>i&&i.replace(/\\/g,"/");var Ht=class extends Se{extended;globalExtended;header;startBlockSize;blockRemain;remain;type;meta=!1;ignore=!1;path;mode;uid;gid;uname;gname;size=0;mtime;atime;ctime;linkpath;dev;ino;nlink;invalid=!1;absolute;unsupported=!1;constructor(e,t,s){switch(super({}),this.pause(),this.extended=t,this.globalExtended=s,this.header=e,this.remain=e.size??0,this.startBlockSize=512*Math.ceil(this.remain/512),this.blockRemain=this.startBlockSize,this.type=e.type,this.type){case"File":case"OldFile":case"Link":case"SymbolicLink":case"CharacterDevice":case"BlockDevice":case"Directory":case"FIFO":case"ContiguousFile":case"GNUDumpDir":break;case"NextFileHasLongLinkpath":case"NextFileHasLongPath":case"OldGnuLongPath":case"GlobalExtendedHeader":case"ExtendedHeader":case"OldExtendedHeader":this.meta=!0;break;default:this.ignore=!0}if(!e.path)throw new Error("no path provided for tar.ReadEntry");this.path=u(e.path),this.mode=e.mode,this.mode&&(this.mode=this.mode&4095),this.uid=e.uid,this.gid=e.gid,this.uname=e.uname,this.gname=e.gname,this.size=this.remain,this.mtime=e.mtime,this.atime=e.atime,this.ctime=e.ctime,this.linkpath=e.linkpath?u(e.linkpath):void 0,this.uname=e.uname,this.gname=e.gname,t&&this.#e(t),s&&this.#e(s,!0)}write(e){let t=e.length;if(t>this.blockRemain)throw new Error("writing more to entry than is appropriate");let s=this.remain,r=this.blockRemain;return this.remain=Math.max(0,s-t),this.blockRemain=Math.max(0,r-t),this.ignore?!0:s>=t?super.write(e):super.write(e.subarray(0,s))}#e(e,t=!1){e.path&&(e.path=u(e.path)),e.linkpath&&(e.linkpath=u(e.linkpath)),Object.assign(this,Object.fromEntries(Object.entries(e).filter(([s,r])=>!(r==null||s==="path"&&t))))}};var St=(i,e,t,s={})=>{i.file&&(s.file=i.file),i.cwd&&(s.cwd=i.cwd),s.code=t instanceof Error&&t.code||e,s.tarCode=e,!i.strict&&s.recoverable!==!1?(t instanceof Error&&(s=Object.assign(t,s),t=t.message),i.emit("warn",e,t,s)):t instanceof Error?i.emit("error",Object.assign(t,s)):i.emit("error",Object.assign(new Error(`${e}: ${t}`),s))};var hl=1024*1024,Zr=Buffer.from([31,139]),se=Symbol("state"),Et=Symbol("writeEntry"),Be=Symbol("readEntry"),Yr=Symbol("nextEntry"),Jo=Symbol("processEntry"),Ee=Symbol("extendedHeader"),wi=Symbol("globalExtendedHeader"),Qe=Symbol("meta"),qo=Symbol("emitMeta"),b=Symbol("buffer"),ze=Symbol("queue"),et=Symbol("ended"),Xr=Symbol("emittedEnd"),xt=Symbol("emit"),_=Symbol("unzip"),As=Symbol("consumeChunk"),Os=Symbol("consumeChunkSub"),Jr=Symbol("consumeBody"),Qo=Symbol("consumeMeta"),ea=Symbol("consumeHeader"),Si=Symbol("consuming"),qr=Symbol("bufferConcat"),vs=Symbol("maybeEnd"),Vt=Symbol("writing"),tt=Symbol("aborted"),Is=Symbol("onDone"),Rt=Symbol("sawValidEntry"),Ps=Symbol("sawNullBlock"),Ds=Symbol("sawEOF"),ta=Symbol("closeStream"),fl=()=>!0,We=class extends ia.EventEmitter{file;strict;maxMetaEntrySize;filter;brotli;writable=!0;readable=!1;[ze]=new zt;[b];[Be];[Et];[se]="begin";[Qe]="";[Ee];[wi];[et]=!1;[_];[tt]=!1;[Rt];[Ps]=!1;[Ds]=!1;[Vt]=!1;[Si]=!1;[Xr]=!1;constructor(e={}){super(),this.file=e.file||"",this.on(Is,()=>{(this[se]==="begin"||this[Rt]===!1)&&this.warn("TAR_BAD_ARCHIVE","Unrecognized archive format")}),e.ondone?this.on(Is,e.ondone):this.on(Is,()=>{this.emit("prefinish"),this.emit("finish"),this.emit("end")}),this.strict=!!e.strict,this.maxMetaEntrySize=e.maxMetaEntrySize||hl,this.filter=typeof e.filter=="function"?e.filter:fl;let t=e.file&&(e.file.endsWith(".tar.br")||e.file.endsWith(".tbr"));this.brotli=!e.gzip&&e.brotli!==void 0?e.brotli:t?void 0:!1,this.on("end",()=>this[ta]()),typeof e.onwarn=="function"&&this.on("warn",e.onwarn),typeof e.onReadEntry=="function"&&this.on("entry",e.onReadEntry)}warn(e,t,s={}){St(this,e,t,s)}[ea](e,t){this[Rt]===void 0&&(this[Rt]=!1);let s;try{s=new Q(e,t,this[Ee],this[wi])}catch(r){return this.warn("TAR_ENTRY_INVALID",r)}if(s.nullBlock)this[Ps]?(this[Ds]=!0,this[se]==="begin"&&(this[se]="header"),this[xt]("eof")):(this[Ps]=!0,this[xt]("nullBlock"));else if(this[Ps]=!1,!s.cksumValid)this.warn("TAR_ENTRY_INVALID","checksum failure",{header:s});else if(!s.path)this.warn("TAR_ENTRY_INVALID","path is required",{header:s});else{let r=s.type;if(/^(Symbolic)?Link$/.test(r)&&!s.linkpath)this.warn("TAR_ENTRY_INVALID","linkpath required",{header:s});else if(!/^(Symbolic)?Link$/.test(r)&&!/^(Global)?ExtendedHeader$/.test(r)&&s.linkpath)this.warn("TAR_ENTRY_INVALID","linkpath forbidden",{header:s});else{let n=this[Et]=new Ht(s,this[Ee],this[wi]);if(!this[Rt])if(n.remain){let o=()=>{n.invalid||(this[Rt]=!0)};n.on("end",o)}else this[Rt]=!0;n.meta?n.size>this.maxMetaEntrySize?(n.ignore=!0,this[xt]("ignoredEntry",n),this[se]="ignore",n.resume()):n.size>0&&(this[Qe]="",n.on("data",o=>this[Qe]+=o),this[se]="meta"):(this[Ee]=void 0,n.ignore=n.ignore||!this.filter(n.path,n),n.ignore?(this[xt]("ignoredEntry",n),this[se]=n.remain?"ignore":"header",n.resume()):(n.remain?this[se]="body":(this[se]="header",n.end()),this[Be]?this[ze].push(n):(this[ze].push(n),this[Yr]())))}}}[ta](){queueMicrotask(()=>this.emit("close"))}[Jo](e){let t=!0;if(!e)this[Be]=void 0,t=!1;else if(Array.isArray(e)){let[s,...r]=e;this.emit(s,...r)}else this[Be]=e,this.emit("entry",e),e.emittedEnd||(e.on("end",()=>this[Yr]()),t=!1);return t}[Yr](){do;while(this[Jo](this[ze].shift()));if(!this[ze].length){let e=this[Be];!e||e.flowing||e.size===e.remain?this[Vt]||this.emit("drain"):e.once("drain",()=>this.emit("drain"))}}[Jr](e,t){let s=this[Et];if(!s)throw new Error("attempt to consume body without entry??");let r=s.blockRemain??0,n=r>=e.length&&t===0?e:e.subarray(t,t+r);return s.write(n),s.blockRemain||(this[se]="header",this[Et]=void 0,s.end()),n.length}[Qo](e,t){let s=this[Et],r=this[Jr](e,t);return!this[Et]&&s&&this[qo](s),r}[xt](e,t,s){!this[ze].length&&!this[Be]?this.emit(e,t,s):this[ze].push([e,t,s])}[qo](e){switch(this[xt]("meta",this[Qe]),e.type){case"ExtendedHeader":case"OldExtendedHeader":this[Ee]=Je.parse(this[Qe],this[Ee],!1);break;case"GlobalExtendedHeader":this[wi]=Je.parse(this[Qe],this[wi],!0);break;case"NextFileHasLongPath":case"OldGnuLongPath":{let t=this[Ee]??Object.create(null);this[Ee]=t,t.path=this[Qe].replace(/\0.*/,"");break}case"NextFileHasLongLinkpath":{let t=this[Ee]||Object.create(null);this[Ee]=t,t.linkpath=this[Qe].replace(/\0.*/,"");break}default:throw new Error("unknown meta: "+e.type)}}abort(e){this[tt]=!0,this.emit("abort",e),this.warn("TAR_ABORT",e,{recoverable:!1})}write(e,t,s){if(typeof t=="function"&&(s=t,t=void 0),typeof e=="string"&&(e=Buffer.from(e,typeof t=="string"?t:"utf8")),this[tt])return s?.(),!1;if((this[_]===void 0||this.brotli===void 0&&this[_]===!1)&&e){if(this[b]&&(e=Buffer.concat([this[b],e]),this[b]=void 0),e.length<Zr.length)return this[b]=e,s?.(),!0;for(let a=0;this[_]===void 0&&a<Zr.length;a++)e[a]!==Zr[a]&&(this[_]=!1);let o=this.brotli===void 0;if(this[_]===!1&&o)if(e.length<512)if(this[et])this.brotli=!0;else return this[b]=e,s?.(),!0;else try{new Q(e.subarray(0,512)),this.brotli=!1}catch{this.brotli=!0}if(this[_]===void 0||this[_]===!1&&this.brotli){let a=this[et];this[et]=!1,this[_]=this[_]===void 0?new ps({}):new bs({}),this[_].on("data",l=>this[As](l)),this[_].on("error",l=>this.abort(l)),this[_].on("end",()=>{this[et]=!0,this[As]()}),this[Vt]=!0;let c=!!this[_][a?"end":"write"](e);return this[Vt]=!1,s?.(),c}}this[Vt]=!0,this[_]?this[_].write(e):this[As](e),this[Vt]=!1;let n=this[ze].length?!1:this[Be]?this[Be].flowing:!0;return!n&&!this[ze].length&&this[Be]?.once("drain",()=>this.emit("drain")),s?.(),n}[qr](e){e&&!this[tt]&&(this[b]=this[b]?Buffer.concat([this[b],e]):e)}[vs](){if(this[et]&&!this[Xr]&&!this[tt]&&!this[Si]){this[Xr]=!0;let e=this[Et];if(e&&e.blockRemain){let t=this[b]?this[b].length:0;this.warn("TAR_BAD_ARCHIVE",`Truncated input (needed ${e.blockRemain} more bytes, only ${t} available)`,{entry:e}),this[b]&&e.write(this[b]),e.end()}this[xt](Is)}}[As](e){if(this[Si]&&e)this[qr](e);else if(!e&&!this[b])this[vs]();else if(e){if(this[Si]=!0,this[b]){this[qr](e);let t=this[b];this[b]=void 0,this[Os](t)}else this[Os](e);for(;this[b]&&this[b]?.length>=512&&!this[tt]&&!this[Ds];){let t=this[b];this[b]=void 0,this[Os](t)}this[Si]=!1}(!this[b]||this[et])&&this[vs]()}[Os](e){let t=0,s=e.length;for(;t+512<=s&&!this[tt]&&!this[Ds];)switch(this[se]){case"begin":case"header":this[ea](e,t),t+=512;break;case"ignore":case"body":t+=this[Jr](e,t);break;case"meta":t+=this[Qo](e,t);break;default:throw new Error("invalid state: "+this[se])}t<s&&(this[b]?this[b]=Buffer.concat([e.subarray(t),this[b]]):this[b]=e.subarray(t))}end(e,t,s){return typeof e=="function"&&(s=e,t=void 0,e=void 0),typeof t=="function"&&(s=t,t=void 0),typeof e=="string"&&(e=Buffer.from(e,t)),s&&this.once("finish",s),this[tt]||(this[_]?(e&&this[_].write(e),this[_].end()):(this[et]=!0,this.brotli===void 0&&(e=e||Buffer.alloc(0)),e&&this.write(e),this[vs]())),this}};var xe=i=>{let e=i.length-1,t=-1;for(;e>-1&&i.charAt(e)==="/";)t=e,e--;return t===-1?i:i.slice(0,t)};var ul=i=>{let e=i.onReadEntry;i.onReadEntry=e?t=>{e(t),t.resume()}:t=>t.resume()},Qr=(i,e)=>{let t=new Map(e.map(n=>[xe(n),!0])),s=i.filter,r=(n,o="")=>{let a=o||(0,Fs.parse)(n).root||".",c;if(n===a)c=!1;else{let l=t.get(n);l!==void 0?c=l:c=r((0,Fs.dirname)(n),a)}return t.set(n,c),c};i.filter=s?(n,o)=>s(n,o)&&r(xe(n)):n=>r(xe(n))},dl=i=>{let e=new We(i),t=i.file,s;try{let r=$t.default.statSync(t),n=i.maxReadSize||16*1024*1024;if(r.size<n)e.end($t.default.readFileSync(t));else{let o=0,a=Buffer.allocUnsafe(n);for(s=$t.default.openSync(t,"r");o<r.size;){let c=$t.default.readSync(s,a,0,n,o);o+=c,e.write(a.subarray(0,c))}e.end()}}finally{if(typeof s=="number")try{$t.default.closeSync(s)}catch{}}},ml=(i,e)=>{let t=new We(i),s=i.maxReadSize||16*1024*1024,r=i.file;return new Promise((o,a)=>{t.on("error",a),t.on("end",o),$t.default.stat(r,(c,l)=>{if(c)a(c);else{let f=new dt(r,{readSize:s,size:l.size});f.on("error",a),f.pipe(t)}})})},Tt=ye(dl,ml,i=>new We(i),i=>new We(i),(i,e)=>{e?.length&&Qr(i,e),i.noResume||ul(i)});var ki=p(require("fs"),1);var fe=p(require("fs"),1);var nn=p(require("path"),1);var en=(i,e,t)=>(i&=4095,t&&(i=(i|384)&-19),e&&(i&256&&(i|=64),i&32&&(i|=8),i&4&&(i|=1)),i);var ra=require("node:path"),{isAbsolute:pl,parse:sa}=ra.win32,Ei=i=>{let e="",t=sa(i);for(;pl(i)||t.root;){let s=i.charAt(0)==="/"&&i.slice(0,4)!=="//?/"?"/":t.root;i=i.slice(s.length),e+=s,t=sa(i)}return[e,i]};var Ls=["|","<",">","?",":"],tn=Ls.map(i=>String.fromCharCode(61440+i.charCodeAt(0))),gl=new Map(Ls.map((i,e)=>[i,tn[e]])),yl=new Map(tn.map((i,e)=>[i,Ls[e]])),sn=i=>Ls.reduce((e,t)=>e.split(t).join(gl.get(t)),i),na=i=>tn.reduce((e,t)=>e.split(t).join(yl.get(t)),i);var fa=(i,e)=>e?(i=u(i).replace(/^\.(\/|$)/,""),xe(e)+"/"+i):u(i),bl=16*1024*1024,aa=Symbol("process"),ca=Symbol("file"),la=Symbol("directory"),on=Symbol("symlink"),ha=Symbol("hardlink"),xi=Symbol("header"),Ns=Symbol("read"),an=Symbol("lstat"),Cs=Symbol("onlstat"),cn=Symbol("onread"),ln=Symbol("onreadlink"),hn=Symbol("openfile"),fn=Symbol("onopenfile"),it=Symbol("close"),Ms=Symbol("mode"),un=Symbol("awaitDrain"),rn=Symbol("ondrain"),Re=Symbol("prefix"),Ri=class extends Se{path;portable;myuid=process.getuid&&process.getuid()||0;myuser=process.env.USER||"";maxReadSize;linkCache;statCache;preservePaths;cwd;strict;mtime;noPax;noMtime;prefix;fd;blockLen=0;blockRemain=0;buf;pos=0;remain=0;length=0;offset=0;win32;absolute;header;type;linkpath;stat;onWriteEntry;#e=!1;constructor(e,t={}){let s=ci(t);super(),this.path=u(e),this.portable=!!s.portable,this.maxReadSize=s.maxReadSize||bl,this.linkCache=s.linkCache||new Map,this.statCache=s.statCache||new Map,this.preservePaths=!!s.preservePaths,this.cwd=u(s.cwd||process.cwd()),this.strict=!!s.strict,this.noPax=!!s.noPax,this.noMtime=!!s.noMtime,this.mtime=s.mtime,this.prefix=s.prefix?u(s.prefix):void 0,this.onWriteEntry=s.onWriteEntry,typeof s.onwarn=="function"&&this.on("warn",s.onwarn);let r=!1;if(!this.preservePaths){let[o,a]=Ei(this.path);o&&typeof a=="string"&&(this.path=a,r=o)}this.win32=!!s.win32||process.platform==="win32",this.win32&&(this.path=na(this.path.replace(/\\/g,"/")),e=e.replace(/\\/g,"/")),this.absolute=u(s.absolute||nn.default.resolve(this.cwd,e)),this.path===""&&(this.path="./"),r&&this.warn("TAR_ENTRY_INFO",`stripping ${r} from absolute path`,{entry:this,path:r+this.path});let n=this.statCache.get(this.absolute);n?this[Cs](n):this[an]()}warn(e,t,s={}){return St(this,e,t,s)}emit(e,...t){return e==="error"&&(this.#e=!0),super.emit(e,...t)}[an](){fe.default.lstat(this.absolute,(e,t)=>{if(e)return this.emit("error",e);this[Cs](t)})}[Cs](e){this.statCache.set(this.absolute,e),this.stat=e,e.isFile()||(e.size=0),this.type=wl(e),this.emit("stat",e),this[aa]()}[aa](){switch(this.type){case"File":return this[ca]();case"Directory":return this[la]();case"SymbolicLink":return this[on]();default:return this.end()}}[Ms](e){return en(e,this.type==="Directory",this.portable)}[Re](e){return fa(e,this.prefix)}[xi](){if(!this.stat)throw new Error("cannot write header before stat");this.type==="Directory"&&this.portable&&(this.noMtime=!0),this.onWriteEntry?.(this),this.header=new Q({path:this[Re](this.path),linkpath:this.type==="Link"&&this.linkpath!==void 0?this[Re](this.linkpath):this.linkpath,mode:this[Ms](this.stat.mode),uid:this.portable?void 0:this.stat.uid,gid:this.portable?void 0:this.stat.gid,size:this.stat.size,mtime:this.noMtime?void 0:this.mtime||this.stat.mtime,type:this.type==="Unsupported"?void 0:this.type,uname:this.portable?void 0:this.stat.uid===this.myuid?this.myuser:"",atime:this.portable?void 0:this.stat.atime,ctime:this.portable?void 0:this.stat.ctime}),this.header.encode()&&!this.noPax&&super.write(new Je({atime:this.portable?void 0:this.header.atime,ctime:this.portable?void 0:this.header.ctime,gid:this.portable?void 0:this.header.gid,mtime:this.noMtime?void 0:this.mtime||this.header.mtime,path:this[Re](this.path),linkpath:this.type==="Link"&&this.linkpath!==void 0?this[Re](this.linkpath):this.linkpath,size:this.header.size,uid:this.portable?void 0:this.header.uid,uname:this.portable?void 0:this.header.uname,dev:this.portable?void 0:this.stat.dev,ino:this.portable?void 0:this.stat.ino,nlink:this.portable?void 0:this.stat.nlink}).encode());let e=this.header?.block;if(!e)throw new Error("failed to encode header");super.write(e)}[la](){if(!this.stat)throw new Error("cannot create directory entry without stat");this.path.slice(-1)!=="/"&&(this.path+="/"),this.stat.size=0,this[xi](),this.end()}[on](){fe.default.readlink(this.absolute,(e,t)=>{if(e)return this.emit("error",e);this[ln](t)})}[ln](e){this.linkpath=u(e),this[xi](),this.end()}[ha](e){if(!this.stat)throw new Error("cannot create link entry without stat");this.type="Link",this.linkpath=u(nn.default.relative(this.cwd,e)),this.stat.size=0,this[xi](),this.end()}[ca](){if(!this.stat)throw new Error("cannot create file entry without stat");if(this.stat.nlink>1){let e=`${this.stat.dev}:${this.stat.ino}`,t=this.linkCache.get(e);if(t?.indexOf(this.cwd)===0)return this[ha](t);this.linkCache.set(e,this.absolute)}if(this[xi](),this.stat.size===0)return this.end();this[hn]()}[hn](){fe.default.open(this.absolute,"r",(e,t)=>{if(e)return this.emit("error",e);this[fn](t)})}[fn](e){if(this.fd=e,this.#e)return this[it]();if(!this.stat)throw new Error("should stat before calling onopenfile");this.blockLen=512*Math.ceil(this.stat.size/512),this.blockRemain=this.blockLen;let t=Math.min(this.blockLen,this.maxReadSize);this.buf=Buffer.allocUnsafe(t),this.offset=0,this.pos=0,this.remain=this.stat.size,this.length=this.buf.length,this[Ns]()}[Ns](){let{fd:e,buf:t,offset:s,length:r,pos:n}=this;if(e===void 0||t===void 0)throw new Error("cannot read file without first opening");fe.default.read(e,t,s,r,n,(o,a)=>{if(o)return this[it](()=>this.emit("error",o));this[cn](a)})}[it](e=()=>{}){this.fd!==void 0&&fe.default.close(this.fd,e)}[cn](e){if(e<=0&&this.remain>0){let r=Object.assign(new Error("encountered unexpected EOF"),{path:this.absolute,syscall:"read",code:"EOF"});return this[it](()=>this.emit("error",r))}if(e>this.remain){let r=Object.assign(new Error("did not encounter expected EOF"),{path:this.absolute,syscall:"read",code:"EOF"});return this[it](()=>this.emit("error",r))}if(!this.buf)throw new Error("should have created buffer prior to reading");if(e===this.remain)for(let r=e;r<this.length&&e<this.blockRemain;r++)this.buf[r+this.offset]=0,e++,this.remain++;let t=this.offset===0&&e===this.buf.length?this.buf:this.buf.subarray(this.offset,this.offset+e);this.write(t)?this[rn]():this[un](()=>this[rn]())}[un](e){this.once("drain",e)}write(e,t,s){if(typeof t=="function"&&(s=t,t=void 0),typeof e=="string"&&(e=Buffer.from(e,typeof t=="string"?t:"utf8")),this.blockRemain<e.length){let r=Object.assign(new Error("writing more data than expected"),{path:this.absolute});return this.emit("error",r)}return this.remain-=e.length,this.blockRemain-=e.length,this.pos+=e.length,this.offset+=e.length,super.write(e,null,s)}[rn](){if(!this.remain)return this.blockRemain&&super.write(Buffer.alloc(this.blockRemain)),this[it](e=>e?this.emit("error",e):this.end());if(!this.buf)throw new Error("buffer lost somehow in ONDRAIN");this.offset>=this.length&&(this.buf=Buffer.allocUnsafe(Math.min(this.blockRemain,this.buf.length)),this.offset=0),this.length=this.buf.length-this.offset,this[Ns]()}},Us=class extends Ri{sync=!0;[an](){this[Cs](fe.default.lstatSync(this.absolute))}[on](){this[ln](fe.default.readlinkSync(this.absolute))}[hn](){this[fn](fe.default.openSync(this.absolute,"r"))}[Ns](){let e=!0;try{let{fd:t,buf:s,offset:r,length:n,pos:o}=this;if(t===void 0||s===void 0)throw new Error("fd and buf must be set in READ method");let a=fe.default.readSync(t,s,r,n,o);this[cn](a),e=!1}finally{if(e)try{this[it](()=>{})}catch{}}}[un](e){e()}[it](e=()=>{}){this.fd!==void 0&&fe.default.closeSync(this.fd),e()}},Bs=class extends Se{blockLen=0;blockRemain=0;buf=0;pos=0;remain=0;length=0;preservePaths;portable;strict;noPax;noMtime;readEntry;type;prefix;path;mode;uid;gid;uname;gname;header;mtime;atime;ctime;linkpath;size;onWriteEntry;warn(e,t,s={}){return St(this,e,t,s)}constructor(e,t={}){let s=ci(t);super(),this.preservePaths=!!s.preservePaths,this.portable=!!s.portable,this.strict=!!s.strict,this.noPax=!!s.noPax,this.noMtime=!!s.noMtime,this.onWriteEntry=s.onWriteEntry,this.readEntry=e;let{type:r}=e;if(r==="Unsupported")throw new Error("writing entry that should be ignored");this.type=r,this.type==="Directory"&&this.portable&&(this.noMtime=!0),this.prefix=s.prefix,this.path=u(e.path),this.mode=e.mode!==void 0?this[Ms](e.mode):void 0,this.uid=this.portable?void 0:e.uid,this.gid=this.portable?void 0:e.gid,this.uname=this.portable?void 0:e.uname,this.gname=this.portable?void 0:e.gname,this.size=e.size,this.mtime=this.noMtime?void 0:s.mtime||e.mtime,this.atime=this.portable?void 0:e.atime,this.ctime=this.portable?void 0:e.ctime,this.linkpath=e.linkpath!==void 0?u(e.linkpath):void 0,typeof s.onwarn=="function"&&this.on("warn",s.onwarn);let n=!1;if(!this.preservePaths){let[a,c]=Ei(this.path);a&&typeof c=="string"&&(this.path=c,n=a)}this.remain=e.size,this.blockRemain=e.startBlockSize,this.onWriteEntry?.(this),this.header=new Q({path:this[Re](this.path),linkpath:this.type==="Link"&&this.linkpath!==void 0?this[Re](this.linkpath):this.linkpath,mode:this.mode,uid:this.portable?void 0:this.uid,gid:this.portable?void 0:this.gid,size:this.size,mtime:this.noMtime?void 0:this.mtime,type:this.type,uname:this.portable?void 0:this.uname,atime:this.portable?void 0:this.atime,ctime:this.portable?void 0:this.ctime}),n&&this.warn("TAR_ENTRY_INFO",`stripping ${n} from absolute path`,{entry:this,path:n+this.path}),this.header.encode()&&!this.noPax&&super.write(new Je({atime:this.portable?void 0:this.atime,ctime:this.portable?void 0:this.ctime,gid:this.portable?void 0:this.gid,mtime:this.noMtime?void 0:this.mtime,path:this[Re](this.path),linkpath:this.type==="Link"&&this.linkpath!==void 0?this[Re](this.linkpath):this.linkpath,size:this.size,uid:this.portable?void 0:this.uid,uname:this.portable?void 0:this.uname,dev:this.portable?void 0:this.readEntry.dev,ino:this.portable?void 0:this.readEntry.ino,nlink:this.portable?void 0:this.readEntry.nlink}).encode());let o=this.header?.block;if(!o)throw new Error("failed to encode header");super.write(o),e.pipe(this)}[Re](e){return fa(e,this.prefix)}[Ms](e){return en(e,this.type==="Directory",this.portable)}write(e,t,s){typeof t=="function"&&(s=t,t=void 0),typeof e=="string"&&(e=Buffer.from(e,typeof t=="string"?t:"utf8"));let r=e.length;if(r>this.blockRemain)throw new Error("writing more to entry than is appropriate");return this.blockRemain-=r,super.write(e,s)}end(e,t,s){return this.blockRemain&&super.write(Buffer.alloc(this.blockRemain)),typeof e=="function"&&(s=e,t=void 0,e=void 0),typeof t=="function"&&(s=t,t=void 0),typeof e=="string"&&(e=Buffer.from(e,t??"utf8")),s&&this.once("finish",s),e?super.end(e,s):super.end(s),this}},wl=i=>i.isFile()?"File":i.isDirectory()?"Directory":i.isSymbolicLink()?"SymbolicLink":"Unsupported";var bn=p(require("path"),1);var Gs=class{path;absolute;entry;stat;readdir;pending=!1;ignore=!1;piped=!1;constructor(e,t){this.path=e||"./",this.absolute=t}},ua=Buffer.alloc(1024),zs=Symbol("onStat"),$i=Symbol("ended"),ue=Symbol("queue"),Gt=Symbol("current"),kt=Symbol("process"),Ti=Symbol("processing"),da=Symbol("processJob"),de=Symbol("jobs"),dn=Symbol("jobDone"),Ws=Symbol("addFSEntry"),ma=Symbol("addTarEntry"),gn=Symbol("stat"),yn=Symbol("readdir"),js=Symbol("onreaddir"),Hs=Symbol("pipe"),pa=Symbol("entry"),mn=Symbol("entryOpt"),Vs=Symbol("writeEntryClass"),ga=Symbol("write"),pn=Symbol("ondrain"),st=class extends Se{opt;cwd;maxReadSize;preservePaths;strict;noPax;prefix;linkCache;statCache;file;portable;zip;readdirCache;noDirRecurse;follow;noMtime;mtime;filter;jobs;[Vs];onWriteEntry;[ue];[de]=0;[Ti]=!1;[$i]=!1;constructor(e={}){if(super(),this.opt=e,this.file=e.file||"",this.cwd=e.cwd||process.cwd(),this.maxReadSize=e.maxReadSize,this.preservePaths=!!e.preservePaths,this.strict=!!e.strict,this.noPax=!!e.noPax,this.prefix=u(e.prefix||""),this.linkCache=e.linkCache||new Map,this.statCache=e.statCache||new Map,this.readdirCache=e.readdirCache||new Map,this.onWriteEntry=e.onWriteEntry,this[Vs]=Ri,typeof e.onwarn=="function"&&this.on("warn",e.onwarn),this.portable=!!e.portable,e.gzip||e.brotli){if(e.gzip&&e.brotli)throw new TypeError("gzip and brotli are mutually exclusive");if(e.gzip&&(typeof e.gzip!="object"&&(e.gzip={}),this.portable&&(e.gzip.portable=!0),this.zip=new ms(e.gzip)),e.brotli&&(typeof e.brotli!="object"&&(e.brotli={}),this.zip=new ys(e.brotli)),!this.zip)throw new Error("impossible");let t=this.zip;t.on("data",s=>super.write(s)),t.on("end",()=>super.end()),t.on("drain",()=>this[pn]()),this.on("resume",()=>t.resume())}else this.on("drain",this[pn]);this.noDirRecurse=!!e.noDirRecurse,this.follow=!!e.follow,this.noMtime=!!e.noMtime,e.mtime&&(this.mtime=e.mtime),this.filter=typeof e.filter=="function"?e.filter:()=>!0,this[ue]=new zt,this[de]=0,this.jobs=Number(e.jobs)||4,this[Ti]=!1,this[$i]=!1}[ga](e){return super.write(e)}add(e){return this.write(e),this}end(e,t,s){return typeof e=="function"&&(s=e,e=void 0),typeof t=="function"&&(s=t,t=void 0),e&&this.add(e),this[$i]=!0,this[kt](),s&&s(),this}write(e){if(this[$i])throw new Error("write after end");return e instanceof Ht?this[ma](e):this[Ws](e),this.flowing}[ma](e){let t=u(bn.default.resolve(this.cwd,e.path));if(!this.filter(e.path,e))e.resume();else{let s=new Gs(e.path,t);s.entry=new Bs(e,this[mn](s)),s.entry.on("end",()=>this[dn](s)),this[de]+=1,this[ue].push(s)}this[kt]()}[Ws](e){let t=u(bn.default.resolve(this.cwd,e));this[ue].push(new Gs(e,t)),this[kt]()}[gn](e){e.pending=!0,this[de]+=1;let t=this.follow?"stat":"lstat";ki.default[t](e.absolute,(s,r)=>{e.pending=!1,this[de]-=1,s?this.emit("error",s):this[zs](e,r)})}[zs](e,t){this.statCache.set(e.absolute,t),e.stat=t,this.filter(e.path,t)||(e.ignore=!0),this[kt]()}[yn](e){e.pending=!0,this[de]+=1,ki.default.readdir(e.absolute,(t,s)=>{if(e.pending=!1,this[de]-=1,t)return this.emit("error",t);this[js](e,s)})}[js](e,t){this.readdirCache.set(e.absolute,t),e.readdir=t,this[kt]()}[kt](){if(!this[Ti]){this[Ti]=!0;for(let e=this[ue].head;e&&this[de]<this.jobs;e=e.next)if(this[da](e.value),e.value.ignore){let t=e.next;this[ue].removeNode(e),e.next=t}this[Ti]=!1,this[$i]&&!this[ue].length&&this[de]===0&&(this.zip?this.zip.end(ua):(super.write(ua),super.end()))}}get[Gt](){return this[ue]&&this[ue].head&&this[ue].head.value}[dn](e){this[ue].shift(),this[de]-=1,this[kt]()}[da](e){if(!e.pending){if(e.entry){e===this[Gt]&&!e.piped&&this[Hs](e);return}if(!e.stat){let t=this.statCache.get(e.absolute);t?this[zs](e,t):this[gn](e)}if(e.stat&&!e.ignore){if(!this.noDirRecurse&&e.stat.isDirectory()&&!e.readdir){let t=this.readdirCache.get(e.absolute);if(t?this[js](e,t):this[yn](e),!e.readdir)return}if(e.entry=this[pa](e),!e.entry){e.ignore=!0;return}e===this[Gt]&&!e.piped&&this[Hs](e)}}}[mn](e){return{onwarn:(t,s,r)=>this.warn(t,s,r),noPax:this.noPax,cwd:this.cwd,absolute:e.absolute,preservePaths:this.preservePaths,maxReadSize:this.maxReadSize,strict:this.strict,portable:this.portable,linkCache:this.linkCache,statCache:this.statCache,noMtime:this.noMtime,mtime:this.mtime,prefix:this.prefix,onWriteEntry:this.onWriteEntry}}[pa](e){this[de]+=1;try{return new this[Vs](e.path,this[mn](e)).on("end",()=>this[dn](e)).on("error",s=>this.emit("error",s))}catch(t){this.emit("error",t)}}[pn](){this[Gt]&&this[Gt].entry&&this[Gt].entry.resume()}[Hs](e){e.piped=!0,e.readdir&&e.readdir.forEach(r=>{let n=e.path,o=n==="./"?"":n.replace(/\/*$/,"/");this[Ws](o+r)});let t=e.entry,s=this.zip;if(!t)throw new Error("cannot pipe without source");s?t.on("data",r=>{s.write(r)||t.pause()}):t.on("data",r=>{super.write(r)||t.pause()})}pause(){return this.zip&&this.zip.pause(),super.pause()}warn(e,t,s={}){St(this,e,t,s)}},_t=class extends st{sync=!0;constructor(e){super(e),this[Vs]=Us}pause(){}resume(){}[gn](e){let t=this.follow?"statSync":"lstatSync";this[zs](e,ki.default[t](e.absolute))}[yn](e){this[js](e,ki.default.readdirSync(e.absolute))}[Hs](e){let t=e.entry,s=this.zip;if(e.readdir&&e.readdir.forEach(r=>{let n=e.path,o=n==="./"?"":n.replace(/\/*$/,"/");this[Ws](o+r)}),!t)throw new Error("Cannot pipe without source");s?t.on("data",r=>{s.write(r)}):t.on("data",r=>{super[ga](r)})}};var Sl=(i,e)=>{let t=new _t(i),s=new Ct(i.file,{mode:i.mode||438});t.pipe(s),ya(t,e)},El=(i,e)=>{let t=new st(i),s=new De(i.file,{mode:i.mode||438});t.pipe(s);let r=new Promise((n,o)=>{s.on("error",o),s.on("close",n),t.on("error",o)});return ba(t,e),r},ya=(i,e)=>{e.forEach(t=>{t.charAt(0)==="@"?Tt({file:wn.default.resolve(i.cwd,t.slice(1)),sync:!0,noResume:!0,onReadEntry:s=>i.add(s)}):i.add(t)}),i.end()},ba=async(i,e)=>{for(let t=0;t<e.length;t++){let s=String(e[t]);s.charAt(0)==="@"?await Tt({file:wn.default.resolve(String(i.cwd),s.slice(1)),noResume:!0,onReadEntry:r=>{i.add(r)}}):i.add(s)}i.end()},xl=(i,e)=>{let t=new _t(i);return ya(t,e),t},Rl=(i,e)=>{let t=new st(i);return ba(t,e),t},$l=ye(Sl,El,xl,Rl,(i,e)=>{if(!e?.length)throw new TypeError("no paths specified to add to archive")});var Wn=p(require("node:fs"),1);var Fa=p(require("node:assert"),1),zn=require("node:crypto"),g=p(require("node:fs"),1),Te=p(require("node:path"),1);var Sn=p(require("fs"),1),Tl=process.env.__FAKE_PLATFORM__||process.platform,kl=Tl==="win32",{O_CREAT:_l,O_TRUNC:Al,O_WRONLY:Ol}=Sn.default.constants,wa=Number(process.env.__FAKE_FS_O_FILENAME__)||Sn.default.constants.UV_FS_O_FILEMAP||0,vl=kl&&!!wa,Il=512*1024,Pl=wa|Al|_l|Ol,En=vl?i=>i<Il?Pl:"w":()=>"w";var _i=p(require("node:fs"),1),Kt=p(require("node:path"),1),xn=(i,e,t)=>{try{return _i.default.lchownSync(i,e,t)}catch(s){if(s?.code!=="ENOENT")throw s}},Ks=(i,e,t,s)=>{_i.default.lchown(i,e,t,r=>{s(r&&r?.code!=="ENOENT"?r:null)})},Dl=(i,e,t,s,r)=>{if(e.isDirectory())Rn(Kt.default.resolve(i,e.name),t,s,n=>{if(n)return r(n);let o=Kt.default.resolve(i,e.name);Ks(o,t,s,r)});else{let n=Kt.default.resolve(i,e.name);Ks(n,t,s,r)}},Rn=(i,e,t,s)=>{_i.default.readdir(i,{withFileTypes:!0},(r,n)=>{if(r){if(r.code==="ENOENT")return s();if(r.code!=="ENOTDIR"&&r.code!=="ENOTSUP")return s(r)}if(r||!n.length)return Ks(i,e,t,s);let o=n.length,a=null,c=l=>{if(!a){if(l)return s(a=l);if(--o===0)return Ks(i,e,t,s)}};for(let l of n)Dl(i,l,e,t,c)})},Fl=(i,e,t,s)=>{e.isDirectory()&&$n(Kt.default.resolve(i,e.name),t,s),xn(Kt.default.resolve(i,e.name),t,s)},$n=(i,e,t)=>{let s;try{s=_i.default.readdirSync(i,{withFileTypes:!0})}catch(r){let n=r;if(n?.code==="ENOENT")return;if(n?.code==="ENOTDIR"||n?.code==="ENOTSUP")return xn(i,e,t);throw n}for(let r of s)Fl(i,r,e,t);return xn(i,e,t)};var te=p(require("fs"),1);var Tn=require("path");var rt=require("fs"),re=i=>{if(!i)i={mode:511};else if(typeof i=="object")i={mode:511,...i};else if(typeof i=="number")i={mode:i};else if(typeof i=="string")i={mode:parseInt(i,8)};else throw new TypeError("invalid options argument");let e=i,t=i.fs||{};return i.mkdir=i.mkdir||t.mkdir||rt.mkdir,i.mkdirAsync=i.mkdirAsync?i.mkdirAsync:async(s,r)=>new Promise((n,o)=>e.mkdir(s,r,(a,c)=>a?o(a):n(c))),i.stat=i.stat||t.stat||rt.stat,i.statAsync=i.statAsync?i.statAsync:async s=>new Promise((r,n)=>e.stat(s,(o,a)=>o?n(o):r(a))),i.statSync=i.statSync||t.statSync||rt.statSync,i.mkdirSync=i.mkdirSync||t.mkdirSync||rt.mkdirSync,e};var $e=(i,e,t)=>{let s=(0,Tn.dirname)(i),r={...re(e),recursive:!1};if(s===i)try{return r.mkdirSync(i,r)}catch(n){let o=n;if(o&&o.code!=="EISDIR")throw n;return}try{return r.mkdirSync(i,r),t||i}catch(n){let o=n;if(o&&o.code==="ENOENT")return $e(i,r,$e(s,r,t));if(o&&o.code!=="EEXIST"&&o&&o.code!=="EROFS")throw n;try{if(!r.statSync(i).isDirectory())throw n}catch{throw n}}},je=Object.assign(async(i,e,t)=>{let s=re(e);s.recursive=!1;let r=(0,Tn.dirname)(i);return r===i?s.mkdirAsync(i,s).catch(n=>{let o=n;if(o&&o.code!=="EISDIR")throw n}):s.mkdirAsync(i,s).then(()=>t||i,async n=>{let o=n;if(o&&o.code==="ENOENT")return je(r,s).then(a=>je(i,s,a));if(o&&o.code!=="EEXIST"&&o.code!=="EROFS")throw n;return s.statAsync(i).then(a=>{if(a.isDirectory())return t;throw n},()=>{throw n})})},{sync:$e});var On=require("path");var kn=require("path"),_n=async(i,e,t)=>{if(t!==e)return i.statAsync(e).then(s=>s.isDirectory()?t:void 0,s=>{let r=s;return r&&r.code==="ENOENT"?_n(i,(0,kn.dirname)(e),e):void 0})},An=(i,e,t)=>{if(t!==e)try{return i.statSync(e).isDirectory()?t:void 0}catch(s){let r=s;return r&&r.code==="ENOENT"?An(i,(0,kn.dirname)(e),e):void 0}};var Zt=(i,e)=>{let t=re(e);if(t.recursive=!0,(0,On.dirname)(i)===i)return t.mkdirSync(i,t);let r=An(t,i);try{return t.mkdirSync(i,t),r}catch(n){let o=n;if(o&&o.code==="ENOENT")return $e(i,t);throw n}},Ai=Object.assign(async(i,e)=>{let t={...re(e),recursive:!0};return(0,On.dirname)(i)===i?await t.mkdirAsync(i,t):_n(t,i).then(r=>t.mkdirAsync(i,t).then(n=>r||n).catch(n=>{let o=n;if(o&&o.code==="ENOENT")return je(i,t);throw n}))},{sync:Zt});var Zs=require("path"),Ll=process.env.__TESTING_MKDIRP_PLATFORM__||process.platform,vn=i=>{if(/\0/.test(i))throw Object.assign(new TypeError("path must be a string without null bytes"),{path:i,code:"ERR_INVALID_ARG_VALUE"});if(i=(0,Zs.resolve)(i),Ll==="win32"){let e=/[*|"<>?:]/,{root:t}=(0,Zs.parse)(i);if(e.test(i.substring(t.length)))throw Object.assign(new Error("Illegal characters in path."),{path:i,code:"EINVAL"})}return i};var Ys=require("fs");var Nl=process.env.__TESTING_MKDIRP_NODE_VERSION__||process.version,In=Nl.replace(/^v/,"").split("."),Sa=+In[0]>10||+In[0]==10&&+In[1]>=12,Oi=Sa?i=>re(i).mkdirSync===Ys.mkdirSync:()=>!1,Xs=Object.assign(Sa?i=>re(i).mkdir===Ys.mkdir:()=>!1,{sync:Oi});var Js=(i,e)=>{i=vn(i);let t=re(e);return Oi(t)?Zt(i,t):$e(i,t)};var Ea=Object.assign(async(i,e)=>{i=vn(i);let t=re(e);return Xs(t)?Ai(i,t):je(i,t)},{mkdirpSync:Js,mkdirpNative:Ai,mkdirpNativeSync:Zt,mkdirpManual:je,mkdirpManualSync:$e,sync:Js,native:Ai,nativeSync:Zt,manual:je,manualSync:$e,useNative:Xs,useNativeSync:Oi});var Di=p(require("node:path"),1);var vi=class extends Error{path;code;syscall="chdir";constructor(e,t){super(`${t}: Cannot cd into '${e}'`),this.path=e,this.code=t}get name(){return"CwdError"}};var Ii=class extends Error{path;symlink;syscall="symlink";code="TAR_SYMLINK_ERROR";constructor(e,t){super("TAR_SYMLINK_ERROR: Cannot extract through symbolic link"),this.symlink=e,this.path=t}get name(){return"SymlinkError"}};var qs=(i,e)=>i.get(u(e)),Pi=(i,e,t)=>i.set(u(e),t),Cl=(i,e)=>{te.default.stat(i,(t,s)=>{(t||!s.isDirectory())&&(t=new vi(i,t?.code||"ENOTDIR")),e(t)})},xa=(i,e,t)=>{i=u(i);let s=e.umask??18,r=e.mode|448,n=(r&s)!==0,o=e.uid,a=e.gid,c=typeof o=="number"&&typeof a=="number"&&(o!==e.processUid||a!==e.processGid),l=e.preserve,f=e.unlink,h=e.cache,m=u(e.cwd),S=(U,k)=>{U?t(U):(Pi(h,i,!0),k&&c?Rn(k,o,a,Gn=>S(Gn)):n?te.default.chmod(i,r,t):t())};if(h&&qs(h,i)===!0)return S();if(i===m)return Cl(i,S);if(l)return Ea(i,{mode:r}).then(U=>S(null,U??void 0),S);let w=u(Di.default.relative(m,i)).split("/");Qs(m,w,r,h,f,m,void 0,S)},Qs=(i,e,t,s,r,n,o,a)=>{if(!e.length)return a(null,o);let c=e.shift(),l=u(Di.default.resolve(i+"/"+c));if(qs(s,l))return Qs(l,e,t,s,r,n,o,a);te.default.mkdir(l,t,Ra(l,e,t,s,r,n,o,a))},Ra=(i,e,t,s,r,n,o,a)=>c=>{c?te.default.lstat(i,(l,f)=>{if(l)l.path=l.path&&u(l.path),a(l);else if(f.isDirectory())Qs(i,e,t,s,r,n,o,a);else if(r)te.default.unlink(i,h=>{if(h)return a(h);te.default.mkdir(i,t,Ra(i,e,t,s,r,n,o,a))});else{if(f.isSymbolicLink())return a(new Ii(i,i+"/"+e.join("/")));a(c)}}):(o=o||i,Qs(i,e,t,s,r,n,o,a))},Ml=i=>{let e=!1,t;try{e=te.default.statSync(i).isDirectory()}catch(s){t=s?.code}finally{if(!e)throw new vi(i,t??"ENOTDIR")}},$a=(i,e)=>{i=u(i);let t=e.umask??18,s=e.mode|448,r=(s&t)!==0,n=e.uid,o=e.gid,a=typeof n=="number"&&typeof o=="number"&&(n!==e.processUid||o!==e.processGid),c=e.preserve,l=e.unlink,f=e.cache,h=u(e.cwd),m=U=>{Pi(f,i,!0),U&&a&&$n(U,n,o),r&&te.default.chmodSync(i,s)};if(f&&qs(f,i)===!0)return m();if(i===h)return Ml(h),m();if(c)return m(Js(i,s)??void 0);let T=u(Di.default.relative(h,i)).split("/"),w;for(let U=T.shift(),k=h;U&&(k+="/"+U);U=T.shift())if(k=u(Di.default.resolve(k)),!qs(f,k))try{te.default.mkdirSync(k,s),w=w||k,Pi(f,k,!0)}catch{let Kn=te.default.lstatSync(k);if(Kn.isDirectory()){Pi(f,k,!0);continue}else if(l){te.default.unlinkSync(k),te.default.mkdirSync(k,s),w=w||k,Pi(f,k,!0);continue}else if(Kn.isSymbolicLink())return new Ii(k,k+"/"+T.join("/"))}return m(w)};var Pn=Object.create(null),{hasOwnProperty:Ul}=Object.prototype,er=i=>(Ul.call(Pn,i)||(Pn[i]=i.normalize("NFD")),Pn[i]);var Dn=require("node:path");var Bl=process.env.TESTING_TAR_FAKE_PLATFORM||process.platform,zl=Bl==="win32",Wl=i=>i.split("/").slice(0,-1).reduce((t,s)=>{let r=t[t.length-1];return r!==void 0&&(s=(0,Dn.join)(r,s)),t.push(s||"/"),t},[]),tr=class{#e=new Map;#s=new Map;#t=new Set;reserve(e,t){e=zl?["win32 parallelization disabled"]:e.map(r=>xe((0,Dn.join)(er(r))).toLowerCase());let s=new Set(e.map(r=>Wl(r)).reduce((r,n)=>r.concat(n)));this.#s.set(t,{dirs:s,paths:e});for(let r of e){let n=this.#e.get(r);n?n.push(t):this.#e.set(r,[t])}for(let r of s){let n=this.#e.get(r);if(!n)this.#e.set(r,[new Set([t])]);else{let o=n[n.length-1];o instanceof Set?o.add(t):n.push(new Set([t]))}}return this.#n(t)}#o(e){let t=this.#s.get(e);if(!t)throw new Error("function does not have any path reservations");return{paths:t.paths.map(s=>this.#e.get(s)),dirs:[...t.dirs].map(s=>this.#e.get(s))}}check(e){let{paths:t,dirs:s}=this.#o(e);return t.every(r=>r&&r[0]===e)&&s.every(r=>r&&r[0]instanceof Set&&r[0].has(e))}#n(e){return this.#t.has(e)||!this.check(e)?!1:(this.#t.add(e),e(()=>this.#i(e)),!0)}#i(e){if(!this.#t.has(e))return!1;let t=this.#s.get(e);if(!t)throw new Error("invalid reservation");let{paths:s,dirs:r}=t,n=new Set;for(let o of s){let a=this.#e.get(o);if(!a||a?.[0]!==e)continue;let c=a[1];if(!c){this.#e.delete(o);continue}if(a.shift(),typeof c=="function")n.add(c);else for(let l of c)n.add(l)}for(let o of r){let a=this.#e.get(o),c=a?.[0];if(!(!a||!(c instanceof Set)))if(c.size===1&&a.length===1){this.#e.delete(o);continue}else if(c.size===1){a.shift();let l=a[0];typeof l=="function"&&n.add(l)}else c.delete(e)}return this.#t.delete(e),n.forEach(o=>this.#n(o)),!0}};var Ta=Symbol("onEntry"),Nn=Symbol("checkFs"),ka=Symbol("checkFs2"),rr=Symbol("pruneCache"),Cn=Symbol("isReusable"),ne=Symbol("makeFs"),Mn=Symbol("file"),Un=Symbol("directory"),nr=Symbol("link"),_a=Symbol("symlink"),Aa=Symbol("hardlink"),Oa=Symbol("unsupported"),va=Symbol("checkPath"),nt=Symbol("mkdir"),H=Symbol("onError"),ir=Symbol("pending"),Ia=Symbol("pend"),Yt=Symbol("unpend"),Fn=Symbol("ended"),Ln=Symbol("maybeClose"),Bn=Symbol("skip"),Fi=Symbol("doChown"),Li=Symbol("uid"),Ni=Symbol("gid"),Ci=Symbol("checkedCwd"),jl=process.env.TESTING_TAR_FAKE_PLATFORM||process.platform,Mi=jl==="win32",Hl=1024,Vl=(i,e)=>{if(!Mi)return g.default.unlink(i,e);let t=i+".DELETE."+(0,zn.randomBytes)(16).toString("hex");g.default.rename(i,t,s=>{if(s)return e(s);g.default.unlink(t,e)})},Gl=i=>{if(!Mi)return g.default.unlinkSync(i);let e=i+".DELETE."+(0,zn.randomBytes)(16).toString("hex");g.default.renameSync(i,e),g.default.unlinkSync(e)},Pa=(i,e,t)=>i!==void 0&&i===i>>>0?i:e!==void 0&&e===e>>>0?e:t,Da=i=>xe(u(er(i))).toLowerCase(),Kl=(i,e)=>{e=Da(e);for(let t of i.keys()){let s=Da(t);(s===e||s.indexOf(e+"/")===0)&&i.delete(t)}},Zl=i=>{for(let e of i.keys())i.delete(e)},Xt=class extends We{[Fn]=!1;[Ci]=!1;[ir]=0;reservations=new tr;transform;writable=!0;readable=!1;dirCache;uid;gid;setOwner;preserveOwner;processGid;processUid;maxDepth;forceChown;win32;newer;keep;noMtime;preservePaths;unlink;cwd;strip;processUmask;umask;dmode;fmode;chmod;constructor(e={}){if(e.ondone=()=>{this[Fn]=!0,this[Ln]()},super(e),this.transform=e.transform,this.dirCache=e.dirCache||new Map,this.chmod=!!e.chmod,typeof e.uid=="number"||typeof e.gid=="number"){if(typeof e.uid!="number"||typeof e.gid!="number")throw new TypeError("cannot set owner without number uid and gid");if(e.preserveOwner)throw new TypeError("cannot preserve owner in archive and also set owner explicitly");this.uid=e.uid,this.gid=e.gid,this.setOwner=!0}else this.uid=void 0,this.gid=void 0,this.setOwner=!1;e.preserveOwner===void 0&&typeof e.uid!="number"?this.preserveOwner=!!(process.getuid&&process.getuid()===0):this.preserveOwner=!!e.preserveOwner,this.processUid=(this.preserveOwner||this.setOwner)&&process.getuid?process.getuid():void 0,this.processGid=(this.preserveOwner||this.setOwner)&&process.getgid?process.getgid():void 0,this.maxDepth=typeof e.maxDepth=="number"?e.maxDepth:Hl,this.forceChown=e.forceChown===!0,this.win32=!!e.win32||Mi,this.newer=!!e.newer,this.keep=!!e.keep,this.noMtime=!!e.noMtime,this.preservePaths=!!e.preservePaths,this.unlink=!!e.unlink,this.cwd=u(Te.default.resolve(e.cwd||process.cwd())),this.strip=Number(e.strip)||0,this.processUmask=this.chmod?typeof e.processUmask=="number"?e.processUmask:process.umask():0,this.umask=typeof e.umask=="number"?e.umask:this.processUmask,this.dmode=e.dmode||511&~this.umask,this.fmode=e.fmode||438&~this.umask,this.on("entry",t=>this[Ta](t))}warn(e,t,s={}){return(e==="TAR_BAD_ARCHIVE"||e==="TAR_ABORT")&&(s.recoverable=!1),super.warn(e,t,s)}[Ln](){this[Fn]&&this[ir]===0&&(this.emit("prefinish"),this.emit("finish"),this.emit("end"))}[va](e){let t=u(e.path),s=t.split("/");if(this.strip){if(s.length<this.strip)return!1;if(e.type==="Link"){let r=u(String(e.linkpath)).split("/");if(r.length>=this.strip)e.linkpath=r.slice(this.strip).join("/");else return!1}s.splice(0,this.strip),e.path=s.join("/")}if(isFinite(this.maxDepth)&&s.length>this.maxDepth)return this.warn("TAR_ENTRY_ERROR","path excessively deep",{entry:e,path:t,depth:s.length,maxDepth:this.maxDepth}),!1;if(!this.preservePaths){if(s.includes("..")||Mi&&/^[a-z]:\.\.$/i.test(s[0]??""))return this.warn("TAR_ENTRY_ERROR","path contains '..'",{entry:e,path:t}),!1;let[r,n]=Ei(t);r&&(e.path=String(n),this.warn("TAR_ENTRY_INFO",`stripping ${r} from absolute path`,{entry:e,path:t}))}if(Te.default.isAbsolute(e.path)?e.absolute=u(Te.default.resolve(e.path)):e.absolute=u(Te.default.resolve(this.cwd,e.path)),!this.preservePaths&&typeof e.absolute=="string"&&e.absolute.indexOf(this.cwd+"/")!==0&&e.absolute!==this.cwd)return this.warn("TAR_ENTRY_ERROR","path escaped extraction target",{entry:e,path:u(e.path),resolvedPath:e.absolute,cwd:this.cwd}),!1;if(e.absolute===this.cwd&&e.type!=="Directory"&&e.type!=="GNUDumpDir")return!1;if(this.win32){let{root:r}=Te.default.win32.parse(String(e.absolute));e.absolute=r+sn(String(e.absolute).slice(r.length));let{root:n}=Te.default.win32.parse(e.path);e.path=n+sn(e.path.slice(n.length))}return!0}[Ta](e){if(!this[va](e))return e.resume();switch(Fa.default.equal(typeof e.absolute,"string"),e.type){case"Directory":case"GNUDumpDir":e.mode&&(e.mode=e.mode|448);case"File":case"OldFile":case"ContiguousFile":case"Link":case"SymbolicLink":return this[Nn](e);case"CharacterDevice":case"BlockDevice":case"FIFO":default:return this[Oa](e)}}[H](e,t){e.name==="CwdError"?this.emit("error",e):(this.warn("TAR_ENTRY_ERROR",e,{entry:t}),this[Yt](),t.resume())}[nt](e,t,s){xa(u(e),{uid:this.uid,gid:this.gid,processUid:this.processUid,processGid:this.processGid,umask:this.processUmask,preserve:this.preservePaths,unlink:this.unlink,cache:this.dirCache,cwd:this.cwd,mode:t},s)}[Fi](e){return this.forceChown||this.preserveOwner&&(typeof e.uid=="number"&&e.uid!==this.processUid||typeof e.gid=="number"&&e.gid!==this.processGid)||typeof this.uid=="number"&&this.uid!==this.processUid||typeof this.gid=="number"&&this.gid!==this.processGid}[Li](e){return Pa(this.uid,e.uid,this.processUid)}[Ni](e){return Pa(this.gid,e.gid,this.processGid)}[Mn](e,t){let s=typeof e.mode=="number"?e.mode&4095:this.fmode,r=new De(String(e.absolute),{flags:En(e.size),mode:s,autoClose:!1});r.on("error",c=>{r.fd&&g.default.close(r.fd,()=>{}),r.write=()=>!0,this[H](c,e),t()});let n=1,o=c=>{if(c){r.fd&&g.default.close(r.fd,()=>{}),this[H](c,e),t();return}--n===0&&r.fd!==void 0&&g.default.close(r.fd,l=>{l?this[H](l,e):this[Yt](),t()})};r.on("finish",()=>{let c=String(e.absolute),l=r.fd;if(typeof l=="number"&&e.mtime&&!this.noMtime){n++;let f=e.atime||new Date,h=e.mtime;g.default.futimes(l,f,h,m=>m?g.default.utimes(c,f,h,S=>o(S&&m)):o())}if(typeof l=="number"&&this[Fi](e)){n++;let f=this[Li](e),h=this[Ni](e);typeof f=="number"&&typeof h=="number"&&g.default.fchown(l,f,h,m=>m?g.default.chown(c,f,h,S=>o(S&&m)):o())}o()});let a=this.transform&&this.transform(e)||e;a!==e&&(a.on("error",c=>{this[H](c,e),t()}),e.pipe(a)),a.pipe(r)}[Un](e,t){let s=typeof e.mode=="number"?e.mode&4095:this.dmode;this[nt](String(e.absolute),s,r=>{if(r){this[H](r,e),t();return}let n=1,o=()=>{--n===0&&(t(),this[Yt](),e.resume())};e.mtime&&!this.noMtime&&(n++,g.default.utimes(String(e.absolute),e.atime||new Date,e.mtime,o)),this[Fi](e)&&(n++,g.default.chown(String(e.absolute),Number(this[Li](e)),Number(this[Ni](e)),o)),o()})}[Oa](e){e.unsupported=!0,this.warn("TAR_ENTRY_UNSUPPORTED",`unsupported entry type: ${e.type}`,{entry:e}),e.resume()}[_a](e,t){this[nr](e,String(e.linkpath),"symlink",t)}[Aa](e,t){let s=u(Te.default.resolve(this.cwd,String(e.linkpath)));this[nr](e,s,"link",t)}[Ia](){this[ir]++}[Yt](){this[ir]--,this[Ln]()}[Bn](e){this[Yt](),e.resume()}[Cn](e,t){return e.type==="File"&&!this.unlink&&t.isFile()&&t.nlink<=1&&!Mi}[Nn](e){this[Ia]();let t=[e.path];e.linkpath&&t.push(e.linkpath),this.reservations.reserve(t,s=>this[ka](e,s))}[rr](e){e.type==="SymbolicLink"?Zl(this.dirCache):e.type!=="Directory"&&Kl(this.dirCache,String(e.absolute))}[ka](e,t){this[rr](e);let s=a=>{this[rr](e),t(a)},r=()=>{this[nt](this.cwd,this.dmode,a=>{if(a){this[H](a,e),s();return}this[Ci]=!0,n()})},n=()=>{if(e.absolute!==this.cwd){let a=u(Te.default.dirname(String(e.absolute)));if(a!==this.cwd)return this[nt](a,this.dmode,c=>{if(c){this[H](c,e),s();return}o()})}o()},o=()=>{g.default.lstat(String(e.absolute),(a,c)=>{if(c&&(this.keep||this.newer&&c.mtime>(e.mtime??c.mtime))){this[Bn](e),s();return}if(a||this[Cn](e,c))return this[ne](null,e,s);if(c.isDirectory()){if(e.type==="Directory"){let l=this.chmod&&e.mode&&(c.mode&4095)!==e.mode,f=h=>this[ne](h??null,e,s);return l?g.default.chmod(String(e.absolute),Number(e.mode),f):f()}if(e.absolute!==this.cwd)return g.default.rmdir(String(e.absolute),l=>this[ne](l??null,e,s))}if(e.absolute===this.cwd)return this[ne](null,e,s);Vl(String(e.absolute),l=>this[ne](l??null,e,s))})};this[Ci]?n():r()}[ne](e,t,s){if(e){this[H](e,t),s();return}switch(t.type){case"File":case"OldFile":case"ContiguousFile":return this[Mn](t,s);case"Link":return this[Aa](t,s);case"SymbolicLink":return this[_a](t,s);case"Directory":case"GNUDumpDir":return this[Un](t,s)}}[nr](e,t,s,r){g.default[s](t,String(e.absolute),n=>{n?this[H](n,e):(this[Yt](),e.resume()),r()})}},sr=i=>{try{return[null,i()]}catch(e){return[e,null]}},Ui=class extends Xt{sync=!0;[ne](e,t){return super[ne](e,t,()=>{})}[Nn](e){if(this[rr](e),!this[Ci]){let n=this[nt](this.cwd,this.dmode);if(n)return this[H](n,e);this[Ci]=!0}if(e.absolute!==this.cwd){let n=u(Te.default.dirname(String(e.absolute)));if(n!==this.cwd){let o=this[nt](n,this.dmode);if(o)return this[H](o,e)}}let[t,s]=sr(()=>g.default.lstatSync(String(e.absolute)));if(s&&(this.keep||this.newer&&s.mtime>(e.mtime??s.mtime)))return this[Bn](e);if(t||this[Cn](e,s))return this[ne](null,e);if(s.isDirectory()){if(e.type==="Directory"){let o=this.chmod&&e.mode&&(s.mode&4095)!==e.mode,[a]=o?sr(()=>{g.default.chmodSync(String(e.absolute),Number(e.mode))}):[];return this[ne](a,e)}let[n]=sr(()=>g.default.rmdirSync(String(e.absolute)));this[ne](n,e)}let[r]=e.absolute===this.cwd?[]:sr(()=>Gl(String(e.absolute)));this[ne](r,e)}[Mn](e,t){let s=typeof e.mode=="number"?e.mode&4095:this.fmode,r=a=>{let c;try{g.default.closeSync(n)}catch(l){c=l}(a||c)&&this[H](a||c,e),t()},n;try{n=g.default.openSync(String(e.absolute),En(e.size),s)}catch(a){return r(a)}let o=this.transform&&this.transform(e)||e;o!==e&&(o.on("error",a=>this[H](a,e)),e.pipe(o)),o.on("data",a=>{try{g.default.writeSync(n,a,0,a.length)}catch(c){r(c)}}),o.on("end",()=>{let a=null;if(e.mtime&&!this.noMtime){let c=e.atime||new Date,l=e.mtime;try{g.default.futimesSync(n,c,l)}catch(f){try{g.default.utimesSync(String(e.absolute),c,l)}catch{a=f}}}if(this[Fi](e)){let c=this[Li](e),l=this[Ni](e);try{g.default.fchownSync(n,Number(c),Number(l))}catch(f){try{g.default.chownSync(String(e.absolute),Number(c),Number(l))}catch{a=a||f}}}r(a)})}[Un](e,t){let s=typeof e.mode=="number"?e.mode&4095:this.dmode,r=this[nt](String(e.absolute),s);if(r){this[H](r,e),t();return}if(e.mtime&&!this.noMtime)try{g.default.utimesSync(String(e.absolute),e.atime||new Date,e.mtime)}catch{}if(this[Fi](e))try{g.default.chownSync(String(e.absolute),Number(this[Li](e)),Number(this[Ni](e)))}catch{}t(),e.resume()}[nt](e,t){try{return $a(u(e),{uid:this.uid,gid:this.gid,processUid:this.processUid,processGid:this.processGid,umask:this.processUmask,preserve:this.preservePaths,unlink:this.unlink,cache:this.dirCache,cwd:this.cwd,mode:t})}catch(s){return s}}[nr](e,t,s,r){let n=`${s}Sync`;try{g.default[n](t,String(e.absolute)),r(),e.resume()}catch(o){return this[H](o,e)}}};var Yl=i=>{let e=new Ui(i),t=i.file,s=Wn.default.statSync(t),r=i.maxReadSize||16*1024*1024;new ss(t,{readSize:r,size:s.size}).pipe(e)},Xl=(i,e)=>{let t=new Xt(i),s=i.maxReadSize||16*1024*1024,r=i.file;return new Promise((o,a)=>{t.on("error",a),t.on("close",o),Wn.default.stat(r,(c,l)=>{if(c)a(c);else{let f=new dt(r,{readSize:s,size:l.size});f.on("error",a),f.pipe(t)}})})},jn=ye(Yl,Xl,i=>new Ui(i),i=>new Xt(i),(i,e)=>{e?.length&&Qr(i,e)});var X=p(require("node:fs"),1),Hn=p(require("node:path"),1);var Jl=(i,e)=>{let t=new _t(i),s=!0,r,n;try{try{r=X.default.openSync(i.file,"r+")}catch(c){if(c?.code==="ENOENT")r=X.default.openSync(i.file,"w+");else throw c}let o=X.default.fstatSync(r),a=Buffer.alloc(512);e:for(n=0;n<o.size;n+=512){for(let f=0,h=0;f<512;f+=h){if(h=X.default.readSync(r,a,f,a.length-f,n+f),n===0&&a[0]===31&&a[1]===139)throw new Error("cannot append to compressed archives");if(!h)break e}let c=new Q(a);if(!c.cksumValid)break;let l=512*Math.ceil((c.size||0)/512);if(n+l+512>o.size)break;n+=l,i.mtimeCache&&c.mtime&&i.mtimeCache.set(String(c.path),c.mtime)}s=!1,ql(i,t,n,r,e)}finally{if(s)try{X.default.closeSync(r)}catch{}}},ql=(i,e,t,s,r)=>{let n=new Ct(i.file,{fd:s,start:t});e.pipe(n),eh(e,r)},Ql=(i,e)=>{e=Array.from(e);let t=new st(i),s=(n,o,a)=>{let c=(S,T)=>{S?X.default.close(n,w=>a(S)):a(null,T)},l=0;if(o===0)return c(null,0);let f=0,h=Buffer.alloc(512),m=(S,T)=>{if(S||typeof T>"u")return c(S);if(f+=T,f<512&&T)return X.default.read(n,h,f,h.length-f,l+f,m);if(l===0&&h[0]===31&&h[1]===139)return c(new Error("cannot append to compressed archives"));if(f<512)return c(null,l);let w=new Q(h);if(!w.cksumValid)return c(null,l);let U=512*Math.ceil((w.size??0)/512);if(l+U+512>o||(l+=U+512,l>=o))return c(null,l);i.mtimeCache&&w.mtime&&i.mtimeCache.set(String(w.path),w.mtime),f=0,X.default.read(n,h,0,512,l,m)};X.default.read(n,h,0,512,l,m)};return new Promise((n,o)=>{t.on("error",o);let a="r+",c=(l,f)=>{if(l&&l.code==="ENOENT"&&a==="r+")return a="w+",X.default.open(i.file,a,c);if(l||!f)return o(l);X.default.fstat(f,(h,m)=>{if(h)return X.default.close(f,()=>o(h));s(f,m.size,(S,T)=>{if(S)return o(S);let w=new De(i.file,{fd:f,start:T});t.pipe(w),w.on("error",o),w.on("close",n),th(t,e)})})};X.default.open(i.file,a,c)})},eh=(i,e)=>{e.forEach(t=>{t.charAt(0)==="@"?Tt({file:Hn.default.resolve(i.cwd,t.slice(1)),sync:!0,noResume:!0,onReadEntry:s=>i.add(s)}):i.add(t)}),i.end()},th=async(i,e)=>{for(let t=0;t<e.length;t++){let s=String(e[t]);s.charAt(0)==="@"?await Tt({file:Hn.default.resolve(String(i.cwd),s.slice(1)),noResume:!0,onReadEntry:r=>i.add(r)}):i.add(s)}i.end()},At=ye(Jl,Ql,()=>{throw new TypeError("file is required")},()=>{throw new TypeError("file is required")},(i,e)=>{if(!vo(i))throw new TypeError("file is required");if(i.gzip||i.brotli||i.file.endsWith(".br")||i.file.endsWith(".tbr"))throw new TypeError("cannot append to compressed archives");if(!e?.length)throw new TypeError("no paths specified to add/replace")});var ih=ye(At.syncFile,At.asyncFile,At.syncNoFile,At.asyncNoFile,(i,e=[])=>{At.validate?.(i,e),sh(i)}),sh=i=>{let e=i.filter;i.mtimeCache||(i.mtimeCache=new Map),i.filter=e?(t,s)=>e(t,s)&&!((i.mtimeCache?.get(t)??s.mtime??0)>(s.mtime??0)):(t,s)=>!((i.mtimeCache?.get(t)??s.mtime??0)>(s.mtime??0))};var La=require("@raycast/api");async function nh(){let i=ke.existsSync(`${E.environment.supportPath}/Image-ExifTool-12.74`);if(await(0,E.confirmAlert)({title:"Install ExifTool",message:i?`A new version of ExifTool is required to strip EXIF data. Would you like to install it now?

This will use 30.2 MB of disk space.`:"ExifTool is required to strip EXIF data. Would you like to install it now?",primaryAction:{title:"Install"}})){if(i){let o=await(0,E.showToast)({title:"Removing old version...",style:E.Toast.Style.Animated});await ke.promises.rmdir(`${E.environment.supportPath}/Image-ExifTool-12.74`,{recursive:!0}),o.title="Old version removed",o.style=E.Toast.Style.Success}let e=await(0,E.showToast)({title:"Installing ExifTool...",style:E.Toast.Style.Animated}),t=E.environment.supportPath,s="https://exiftool.org/Image-ExifTool-13.21.tar.gz",r="c009024d0405ddc12fb448f0d3b2acc63ed5d87d55bf1f242522f22f0a03985c",n=!0;for(Ma.get(s,async o=>{let c=Ua.default.join(t,"Image-ExifTool-13.21.tar.gz"),l=ke.createWriteStream(c);o.pipe(l);let f=!1,h=Ca.createHash("sha256");o.on("data",m=>h.update(m)),o.on("end",async()=>{if(h.digest("hex")!==r){e.title="Checksum verification failed",e.style=E.Toast.Style.Failure,n=!1;return}f=!0}),l.on("finish",async()=>{l.close(),f&&(await jn({file:`${t}/Image-ExifTool-13.21.tar.gz`,cwd:t}),await ke.promises.rename(`${t}/Image-ExifTool-13.21`,`${t}/exiftool`),await E.LocalStorage.setItem("exifToolLocation","support"),n=!1,e.title="Done!",e.style=E.Toast.Style.Success),await ke.promises.unlink(c)})});n;)await new Promise(o=>setTimeout(o,1e3))}else await E.LocalStorage.removeItem("exifToolLocation")}async function Na(){try{(0,Vn.execSync)("exiftool -ver"),await E.LocalStorage.setItem("exifToolLocation","path")}catch{await nh()}}async function Ba(){let i=await E.LocalStorage.getItem("exifToolLocation");if(i!=="path"&&(i!=="support"||!ke.existsSync(`${E.environment.supportPath}/exiftool/exiftool`))&&(ke.existsSync(`${E.environment.supportPath}/exiftool/exiftool`)?await E.LocalStorage.setItem("exifToolLocation","support"):await Na()),i==="path")try{return(0,Vn.execSync)("exiftool -ver"),"path"}catch{await Na()}return await E.LocalStorage.getItem("exifToolLocation")}async function oh({imagePaths:i}){let e=i?.length?i:await pr(),t=await Ba();if(!t)throw Error("Failed to find ExifTool");let s=await Gi(e,t);return await Jt(),s}
