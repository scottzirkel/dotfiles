"use strict";var Ha=Object.create;var Bi=Object.defineProperty;var Va=Object.getOwnPropertyDescriptor;var Ga=Object.getOwnPropertyNames;var Ka=Object.getPrototypeOf,Za=Object.prototype.hasOwnProperty;var Xn=(i,e)=>(e=Symbol[i])?e:Symbol.for("Symbol."+i),Jn=i=>{throw TypeError(i)};var Ya=(i,e)=>{for(var t in e)Bi(i,t,{get:e[t],enumerable:!0})},qn=(i,e,t,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of Ga(e))!Za.call(i,r)&&r!==t&&Bi(i,r,{get:()=>e[r],enumerable:!(s=Va(e,r))||s.enumerable});return i};var p=(i,e,t)=>(t=i!=null?Ha(Ka(i)):{},qn(e||!i||!i.__esModule?Bi(t,"default",{value:i,enumerable:!0}):t,i)),Xa=i=>qn(Bi({},"__esModule",{value:!0}),i);var zi=(i,e,t)=>{if(e!=null){typeof e!="object"&&typeof e!="function"&&Jn("Object expected");var s,r;t&&(s=e[Xn("asyncDispose")]),s===void 0&&(s=e[Xn("dispose")],t&&(r=s)),typeof s!="function"&&Jn("Object not disposable"),r&&(s=function(){try{r.call(this)}catch(n){return Promise.reject(n)}}),i.push([t,s,e])}else t&&i.push([t]);return e},Wi=(i,e,t)=>{var s=typeof SuppressedError=="function"?SuppressedError:function(o,a,c,l){return l=Error(c),l.name="SuppressedError",l.error=o,l.suppressed=a,l},r=o=>e=t?new s(o,e,"An error was suppressed during disposal"):(t=!0,o),n=o=>{for(;o=i.pop();)try{var a=o[1]&&o[1].call(o[2]);if(o[0])return Promise.resolve(a).then(n,c=>(r(c),n()))}catch(c){r(c)}if(t)throw e};return n()};var ch={};Ya(ch,{default:()=>ja,getExifToolLocation:()=>Wa,installExifTool:()=>za,setExifToolLocation:()=>Gn});module.exports=Xa(ch);var Kn=require("child_process"),Ma=p(require("crypto")),ke=p(require("fs")),Ua=p(require("https")),Ba=p(require("path")),w=require("@raycast/api");var ro=p(require("events"),1),G=p(require("fs"),1);var Yi=require("node:events"),ur=p(require("node:stream"),1),so=require("node:string_decoder"),Qn=typeof process=="object"&&process?process:{stdout:null,stderr:null},Ja=i=>!!i&&typeof i=="object"&&(i instanceof ii||i instanceof ur.default||qa(i)||Qa(i)),qa=i=>!!i&&typeof i=="object"&&i instanceof Yi.EventEmitter&&typeof i.pipe=="function"&&i.pipe!==ur.default.Writable.prototype.pipe,Qa=i=>!!i&&typeof i=="object"&&i instanceof Yi.EventEmitter&&typeof i.write=="function"&&typeof i.end=="function",_e=Symbol("EOF"),Ae=Symbol("maybeEmitEnd"),He=Symbol("emittedEnd"),ji=Symbol("emittingEnd"),qt=Symbol("emittedError"),Hi=Symbol("closed"),eo=Symbol("read"),Vi=Symbol("flush"),to=Symbol("flushChunk"),oe=Symbol("encoding"),vt=Symbol("decoder"),A=Symbol("flowing"),Qt=Symbol("paused"),It=Symbol("resume"),O=Symbol("buffer"),V=Symbol("pipes"),v=Symbol("bufferLength"),or=Symbol("bufferPush"),Gi=Symbol("bufferShift"),B=Symbol("objectMode"),x=Symbol("destroyed"),ar=Symbol("error"),cr=Symbol("emitData"),io=Symbol("emitEnd"),lr=Symbol("emitEnd2"),me=Symbol("async"),hr=Symbol("abort"),Ki=Symbol("aborted"),ei=Symbol("signal"),ot=Symbol("dataListeners"),J=Symbol("discarded"),ti=i=>Promise.resolve().then(i),ec=i=>i(),tc=i=>i==="end"||i==="finish"||i==="prefinish",ic=i=>i instanceof ArrayBuffer||!!i&&typeof i=="object"&&i.constructor&&i.constructor.name==="ArrayBuffer"&&i.byteLength>=0,sc=i=>!Buffer.isBuffer(i)&&ArrayBuffer.isView(i),Zi=class{src;dest;opts;ondrain;constructor(e,t,s){this.src=e,this.dest=t,this.opts=s,this.ondrain=()=>e[It](),this.dest.on("drain",this.ondrain)}unpipe(){this.dest.removeListener("drain",this.ondrain)}proxyErrors(e){}end(){this.unpipe(),this.opts.end&&this.dest.end()}},fr=class extends Zi{unpipe(){this.src.removeListener("error",this.proxyErrors),super.unpipe()}constructor(e,t,s){super(e,t,s),this.proxyErrors=r=>t.emit("error",r),e.on("error",this.proxyErrors)}},rc=i=>!!i.objectMode,nc=i=>!i.objectMode&&!!i.encoding&&i.encoding!=="buffer",ii=class extends Yi.EventEmitter{[A]=!1;[Qt]=!1;[V]=[];[O]=[];[B];[oe];[me];[vt];[_e]=!1;[He]=!1;[ji]=!1;[Hi]=!1;[qt]=null;[v]=0;[x]=!1;[ei];[Ki]=!1;[ot]=0;[J]=!1;writable=!0;readable=!0;constructor(...e){let t=e[0]||{};if(super(),t.objectMode&&typeof t.encoding=="string")throw new TypeError("Encoding and objectMode may not be used together");rc(t)?(this[B]=!0,this[oe]=null):nc(t)?(this[oe]=t.encoding,this[B]=!1):(this[B]=!1,this[oe]=null),this[me]=!!t.async,this[vt]=this[oe]?new so.StringDecoder(this[oe]):null,t&&t.debugExposeBuffer===!0&&Object.defineProperty(this,"buffer",{get:()=>this[O]}),t&&t.debugExposePipes===!0&&Object.defineProperty(this,"pipes",{get:()=>this[V]});let{signal:s}=t;s&&(this[ei]=s,s.aborted?this[hr]():s.addEventListener("abort",()=>this[hr]()))}get bufferLength(){return this[v]}get encoding(){return this[oe]}set encoding(e){throw new Error("Encoding must be set at instantiation time")}setEncoding(e){throw new Error("Encoding must be set at instantiation time")}get objectMode(){return this[B]}set objectMode(e){throw new Error("objectMode must be set at instantiation time")}get async(){return this[me]}set async(e){this[me]=this[me]||!!e}[hr](){this[Ki]=!0,this.emit("abort",this[ei]?.reason),this.destroy(this[ei]?.reason)}get aborted(){return this[Ki]}set aborted(e){}write(e,t,s){if(this[Ki])return!1;if(this[_e])throw new Error("write after end");if(this[x])return this.emit("error",Object.assign(new Error("Cannot call write after a stream was destroyed"),{code:"ERR_STREAM_DESTROYED"})),!0;typeof t=="function"&&(s=t,t="utf8"),t||(t="utf8");let r=this[me]?ti:ec;if(!this[B]&&!Buffer.isBuffer(e)){if(sc(e))e=Buffer.from(e.buffer,e.byteOffset,e.byteLength);else if(ic(e))e=Buffer.from(e);else if(typeof e!="string")throw new Error("Non-contiguous data written to non-objectMode stream")}return this[B]?(this[A]&&this[v]!==0&&this[Vi](!0),this[A]?this.emit("data",e):this[or](e),this[v]!==0&&this.emit("readable"),s&&r(s),this[A]):e.length?(typeof e=="string"&&!(t===this[oe]&&!this[vt]?.lastNeed)&&(e=Buffer.from(e,t)),Buffer.isBuffer(e)&&this[oe]&&(e=this[vt].write(e)),this[A]&&this[v]!==0&&this[Vi](!0),this[A]?this.emit("data",e):this[or](e),this[v]!==0&&this.emit("readable"),s&&r(s),this[A]):(this[v]!==0&&this.emit("readable"),s&&r(s),this[A])}read(e){if(this[x])return null;if(this[J]=!1,this[v]===0||e===0||e&&e>this[v])return this[Ae](),null;this[B]&&(e=null),this[O].length>1&&!this[B]&&(this[O]=[this[oe]?this[O].join(""):Buffer.concat(this[O],this[v])]);let t=this[eo](e||null,this[O][0]);return this[Ae](),t}[eo](e,t){if(this[B])this[Gi]();else{let s=t;e===s.length||e===null?this[Gi]():typeof s=="string"?(this[O][0]=s.slice(e),t=s.slice(0,e),this[v]-=e):(this[O][0]=s.subarray(e),t=s.subarray(0,e),this[v]-=e)}return this.emit("data",t),!this[O].length&&!this[_e]&&this.emit("drain"),t}end(e,t,s){return typeof e=="function"&&(s=e,e=void 0),typeof t=="function"&&(s=t,t="utf8"),e!==void 0&&this.write(e,t),s&&this.once("end",s),this[_e]=!0,this.writable=!1,(this[A]||!this[Qt])&&this[Ae](),this}[It](){this[x]||(!this[ot]&&!this[V].length&&(this[J]=!0),this[Qt]=!1,this[A]=!0,this.emit("resume"),this[O].length?this[Vi]():this[_e]?this[Ae]():this.emit("drain"))}resume(){return this[It]()}pause(){this[A]=!1,this[Qt]=!0,this[J]=!1}get destroyed(){return this[x]}get flowing(){return this[A]}get paused(){return this[Qt]}[or](e){this[B]?this[v]+=1:this[v]+=e.length,this[O].push(e)}[Gi](){return this[B]?this[v]-=1:this[v]-=this[O][0].length,this[O].shift()}[Vi](e=!1){do;while(this[to](this[Gi]())&&this[O].length);!e&&!this[O].length&&!this[_e]&&this.emit("drain")}[to](e){return this.emit("data",e),this[A]}pipe(e,t){if(this[x])return e;this[J]=!1;let s=this[He];return t=t||{},e===Qn.stdout||e===Qn.stderr?t.end=!1:t.end=t.end!==!1,t.proxyErrors=!!t.proxyErrors,s?t.end&&e.end():(this[V].push(t.proxyErrors?new fr(this,e,t):new Zi(this,e,t)),this[me]?ti(()=>this[It]()):this[It]()),e}unpipe(e){let t=this[V].find(s=>s.dest===e);t&&(this[V].length===1?(this[A]&&this[ot]===0&&(this[A]=!1),this[V]=[]):this[V].splice(this[V].indexOf(t),1),t.unpipe())}addListener(e,t){return this.on(e,t)}on(e,t){let s=super.on(e,t);if(e==="data")this[J]=!1,this[ot]++,!this[V].length&&!this[A]&&this[It]();else if(e==="readable"&&this[v]!==0)super.emit("readable");else if(tc(e)&&this[He])super.emit(e),this.removeAllListeners(e);else if(e==="error"&&this[qt]){let r=t;this[me]?ti(()=>r.call(this,this[qt])):r.call(this,this[qt])}return s}removeListener(e,t){return this.off(e,t)}off(e,t){let s=super.off(e,t);return e==="data"&&(this[ot]=this.listeners("data").length,this[ot]===0&&!this[J]&&!this[V].length&&(this[A]=!1)),s}removeAllListeners(e){let t=super.removeAllListeners(e);return(e==="data"||e===void 0)&&(this[ot]=0,!this[J]&&!this[V].length&&(this[A]=!1)),t}get emittedEnd(){return this[He]}[Ae](){!this[ji]&&!this[He]&&!this[x]&&this[O].length===0&&this[_e]&&(this[ji]=!0,this.emit("end"),this.emit("prefinish"),this.emit("finish"),this[Hi]&&this.emit("close"),this[ji]=!1)}emit(e,...t){let s=t[0];if(e!=="error"&&e!=="close"&&e!==x&&this[x])return!1;if(e==="data")return!this[B]&&!s?!1:this[me]?(ti(()=>this[cr](s)),!0):this[cr](s);if(e==="end")return this[io]();if(e==="close"){if(this[Hi]=!0,!this[He]&&!this[x])return!1;let n=super.emit("close");return this.removeAllListeners("close"),n}else if(e==="error"){this[qt]=s,super.emit(ar,s);let n=!this[ei]||this.listeners("error").length?super.emit("error",s):!1;return this[Ae](),n}else if(e==="resume"){let n=super.emit("resume");return this[Ae](),n}else if(e==="finish"||e==="prefinish"){let n=super.emit(e);return this.removeAllListeners(e),n}let r=super.emit(e,...t);return this[Ae](),r}[cr](e){for(let s of this[V])s.dest.write(e)===!1&&this.pause();let t=this[J]?!1:super.emit("data",e);return this[Ae](),t}[io](){return this[He]?!1:(this[He]=!0,this.readable=!1,this[me]?(ti(()=>this[lr]()),!0):this[lr]())}[lr](){if(this[vt]){let t=this[vt].end();if(t){for(let s of this[V])s.dest.write(t);this[J]||super.emit("data",t)}}for(let t of this[V])t.end();let e=super.emit("end");return this.removeAllListeners("end"),e}async collect(){let e=Object.assign([],{dataLength:0});this[B]||(e.dataLength=0);let t=this.promise();return this.on("data",s=>{e.push(s),this[B]||(e.dataLength+=s.length)}),await t,e}async concat(){if(this[B])throw new Error("cannot concat in objectMode");let e=await this.collect();return this[oe]?e.join(""):Buffer.concat(e,e.dataLength)}async promise(){return new Promise((e,t)=>{this.on(x,()=>t(new Error("stream destroyed"))),this.on("error",s=>t(s)),this.on("end",()=>e())})}[Symbol.asyncIterator](){this[J]=!1;let e=!1,t=async()=>(this.pause(),e=!0,{value:void 0,done:!0});return{next:()=>{if(e)return t();let r=this.read();if(r!==null)return Promise.resolve({done:!1,value:r});if(this[_e])return t();let n,o,a=h=>{this.off("data",c),this.off("end",l),this.off(x,f),t(),o(h)},c=h=>{this.off("error",a),this.off("end",l),this.off(x,f),this.pause(),n({value:h,done:!!this[_e]})},l=()=>{this.off("error",a),this.off("data",c),this.off(x,f),t(),n({done:!0,value:void 0})},f=()=>a(new Error("stream destroyed"));return new Promise((h,m)=>{o=m,n=h,this.once(x,f),this.once("error",a),this.once("end",l),this.once("data",c)})},throw:t,return:t,[Symbol.asyncIterator](){return this}}}[Symbol.iterator](){this[J]=!1;let e=!1,t=()=>(this.pause(),this.off(ar,t),this.off(x,t),this.off("end",t),e=!0,{done:!0,value:void 0}),s=()=>{if(e)return t();let r=this.read();return r===null?t():{done:!1,value:r}};return this.once("end",t),this.once(ar,t),this.once(x,t),{next:s,throw:t,return:t,[Symbol.iterator](){return this}}}destroy(e){if(this[x])return e?this.emit("error",e):this.emit(x),this;this[x]=!0,this[J]=!0,this[O].length=0,this[v]=0;let t=this;return typeof t.close=="function"&&!this[Hi]&&t.close(),e?this.emit("error",e):this.emit(x),this}static get isStream(){return Ja}};var oc=G.default.writev,Ge=Symbol("_autoClose"),ce=Symbol("_close"),si=Symbol("_ended"),y=Symbol("_fd"),dr=Symbol("_finished"),ve=Symbol("_flags"),mr=Symbol("_flush"),br=Symbol("_handleChunk"),wr=Symbol("_makeBuf"),ni=Symbol("_mode"),Xi=Symbol("_needDrain"),Ft=Symbol("_onerror"),Nt=Symbol("_onopen"),pr=Symbol("_onread"),Pt=Symbol("_onwrite"),Ke=Symbol("_open"),ae=Symbol("_path"),Ve=Symbol("_pos"),pe=Symbol("_queue"),Dt=Symbol("_read"),gr=Symbol("_readSize"),Oe=Symbol("_reading"),ri=Symbol("_remain"),yr=Symbol("_size"),Ji=Symbol("_write"),at=Symbol("_writing"),qi=Symbol("_defaultFlag"),ct=Symbol("_errored"),lt=class extends ii{[ct]=!1;[y];[ae];[gr];[Oe]=!1;[yr];[ri];[Ge];constructor(e,t){if(t=t||{},super(t),this.readable=!0,this.writable=!1,typeof e!="string")throw new TypeError("path must be a string");this[ct]=!1,this[y]=typeof t.fd=="number"?t.fd:void 0,this[ae]=e,this[gr]=t.readSize||16*1024*1024,this[Oe]=!1,this[yr]=typeof t.size=="number"?t.size:1/0,this[ri]=this[yr],this[Ge]=typeof t.autoClose=="boolean"?t.autoClose:!0,typeof this[y]=="number"?this[Dt]():this[Ke]()}get fd(){return this[y]}get path(){return this[ae]}write(){throw new TypeError("this is a readable stream")}end(){throw new TypeError("this is a readable stream")}[Ke](){G.default.open(this[ae],"r",(e,t)=>this[Nt](e,t))}[Nt](e,t){e?this[Ft](e):(this[y]=t,this.emit("open",t),this[Dt]())}[wr](){return Buffer.allocUnsafe(Math.min(this[gr],this[ri]))}[Dt](){if(!this[Oe]){this[Oe]=!0;let e=this[wr]();if(e.length===0)return process.nextTick(()=>this[pr](null,0,e));G.default.read(this[y],e,0,e.length,null,(t,s,r)=>this[pr](t,s,r))}}[pr](e,t,s){this[Oe]=!1,e?this[Ft](e):this[br](t,s)&&this[Dt]()}[ce](){if(this[Ge]&&typeof this[y]=="number"){let e=this[y];this[y]=void 0,G.default.close(e,t=>t?this.emit("error",t):this.emit("close"))}}[Ft](e){this[Oe]=!0,this[ce](),this.emit("error",e)}[br](e,t){let s=!1;return this[ri]-=e,e>0&&(s=super.write(e<t.length?t.subarray(0,e):t)),(e===0||this[ri]<=0)&&(s=!1,this[ce](),super.end()),s}emit(e,...t){switch(e){case"prefinish":case"finish":return!1;case"drain":return typeof this[y]=="number"&&this[Dt](),!1;case"error":return this[ct]?!1:(this[ct]=!0,super.emit(e,...t));default:return super.emit(e,...t)}}},Qi=class extends lt{[Ke](){let e=!0;try{this[Nt](null,G.default.openSync(this[ae],"r")),e=!1}finally{e&&this[ce]()}}[Dt](){let e=!0;try{if(!this[Oe]){this[Oe]=!0;do{let t=this[wr](),s=t.length===0?0:G.default.readSync(this[y],t,0,t.length,null);if(!this[br](s,t))break}while(!0);this[Oe]=!1}e=!1}finally{e&&this[ce]()}}[ce](){if(this[Ge]&&typeof this[y]=="number"){let e=this[y];this[y]=void 0,G.default.closeSync(e),this.emit("close")}}},Ie=class extends ro.default{readable=!1;writable=!0;[ct]=!1;[at]=!1;[si]=!1;[pe]=[];[Xi]=!1;[ae];[ni];[Ge];[y];[qi];[ve];[dr]=!1;[Ve];constructor(e,t){t=t||{},super(t),this[ae]=e,this[y]=typeof t.fd=="number"?t.fd:void 0,this[ni]=t.mode===void 0?438:t.mode,this[Ve]=typeof t.start=="number"?t.start:void 0,this[Ge]=typeof t.autoClose=="boolean"?t.autoClose:!0;let s=this[Ve]!==void 0?"r+":"w";this[qi]=t.flags===void 0,this[ve]=t.flags===void 0?s:t.flags,this[y]===void 0&&this[Ke]()}emit(e,...t){if(e==="error"){if(this[ct])return!1;this[ct]=!0}return super.emit(e,...t)}get fd(){return this[y]}get path(){return this[ae]}[Ft](e){this[ce](),this[at]=!0,this.emit("error",e)}[Ke](){G.default.open(this[ae],this[ve],this[ni],(e,t)=>this[Nt](e,t))}[Nt](e,t){this[qi]&&this[ve]==="r+"&&e&&e.code==="ENOENT"?(this[ve]="w",this[Ke]()):e?this[Ft](e):(this[y]=t,this.emit("open",t),this[at]||this[mr]())}end(e,t){return e&&this.write(e,t),this[si]=!0,!this[at]&&!this[pe].length&&typeof this[y]=="number"&&this[Pt](null,0),this}write(e,t){return typeof e=="string"&&(e=Buffer.from(e,t)),this[si]?(this.emit("error",new Error("write() after end()")),!1):this[y]===void 0||this[at]||this[pe].length?(this[pe].push(e),this[Xi]=!0,!1):(this[at]=!0,this[Ji](e),!0)}[Ji](e){G.default.write(this[y],e,0,e.length,this[Ve],(t,s)=>this[Pt](t,s))}[Pt](e,t){e?this[Ft](e):(this[Ve]!==void 0&&typeof t=="number"&&(this[Ve]+=t),this[pe].length?this[mr]():(this[at]=!1,this[si]&&!this[dr]?(this[dr]=!0,this[ce](),this.emit("finish")):this[Xi]&&(this[Xi]=!1,this.emit("drain"))))}[mr](){if(this[pe].length===0)this[si]&&this[Pt](null,0);else if(this[pe].length===1)this[Ji](this[pe].pop());else{let e=this[pe];this[pe]=[],oc(this[y],e,this[Ve],(t,s)=>this[Pt](t,s))}}[ce](){if(this[Ge]&&typeof this[y]=="number"){let e=this[y];this[y]=void 0,G.default.close(e,t=>t?this.emit("error",t):this.emit("close"))}}},Lt=class extends Ie{[Ke](){let e;if(this[qi]&&this[ve]==="r+")try{e=G.default.openSync(this[ae],this[ve],this[ni])}catch(t){if(t?.code==="ENOENT")return this[ve]="w",this[Ke]();throw t}else e=G.default.openSync(this[ae],this[ve],this[ni]);this[Nt](null,e)}[ce](){if(this[Ge]&&typeof this[y]=="number"){let e=this[y];this[y]=void 0,G.default.closeSync(e),this.emit("close")}}[Ji](e){let t=!0;try{this[Pt](null,G.default.writeSync(this[y],e,0,e.length,this[Ve])),t=!1}finally{if(t)try{this[ce]()}catch{}}}};var ln=p(require("node:path"),1);var St=p(require("node:fs"),1),vs=require("path");var ac=new Map([["C","cwd"],["f","file"],["z","gzip"],["P","preservePaths"],["U","unlink"],["strip-components","strip"],["stripComponents","strip"],["keep-newer","newer"],["keepNewer","newer"],["keep-newer-files","newer"],["keepNewerFiles","newer"],["k","keep"],["keep-existing","keep"],["keepExisting","keep"],["m","noMtime"],["no-mtime","noMtime"],["p","preserveOwner"],["L","follow"],["h","follow"],["onentry","onReadEntry"]]),no=i=>!!i.sync&&!!i.file,oo=i=>!i.sync&&!!i.file,ao=i=>!!i.sync&&!i.file,co=i=>!i.sync&&!i.file;var lo=i=>!!i.file;var cc=i=>{let e=ac.get(i);return e||i},oi=(i={})=>{if(!i)return{};let e={};for(let[t,s]of Object.entries(i)){let r=cc(t);e[r]=s}return e.chmod===void 0&&e.noChmod===!1&&(e.chmod=!0),delete e.noChmod,e};var ge=(i,e,t,s,r)=>Object.assign((n=[],o,a)=>{Array.isArray(n)&&(o=n,n={}),typeof o=="function"&&(a=o,o=void 0),o?o=Array.from(o):o=[];let c=oi(n);if(r?.(c,o),no(c)){if(typeof a=="function")throw new TypeError("callback not supported for sync tar functions");return i(c,o)}else if(oo(c)){let l=e(c,o),f=a||void 0;return f?l.then(()=>f(),f):l}else if(ao(c)){if(typeof a=="function")throw new TypeError("callback not supported for sync tar functions");return t(c,o)}else if(co(c)){if(typeof a=="function")throw new TypeError("callback only supported with file option");return s(c,o)}else throw new Error("impossible options??")},{syncFile:i,asyncFile:e,syncNoFile:t,asyncNoFile:s,validate:r});var Lo=require("events");var as=p(require("assert"),1),Ne=require("buffer");var os=require("node:events"),_r=p(require("node:stream"),1),po=require("node:string_decoder"),ho=typeof process=="object"&&process?process:{stdout:null,stderr:null},lc=i=>!!i&&typeof i=="object"&&(i instanceof fi||i instanceof _r.default||hc(i)||fc(i)),hc=i=>!!i&&typeof i=="object"&&i instanceof os.EventEmitter&&typeof i.pipe=="function"&&i.pipe!==_r.default.Writable.prototype.pipe,fc=i=>!!i&&typeof i=="object"&&i instanceof os.EventEmitter&&typeof i.write=="function"&&typeof i.end=="function",Pe=Symbol("EOF"),De=Symbol("maybeEmitEnd"),Ze=Symbol("emittedEnd"),es=Symbol("emittingEnd"),ai=Symbol("emittedError"),ts=Symbol("closed"),fo=Symbol("read"),is=Symbol("flush"),uo=Symbol("flushChunk"),le=Symbol("encoding"),Ct=Symbol("decoder"),I=Symbol("flowing"),ci=Symbol("paused"),Mt=Symbol("resume"),P=Symbol("buffer"),K=Symbol("pipes"),D=Symbol("bufferLength"),Er=Symbol("bufferPush"),ss=Symbol("bufferShift"),z=Symbol("objectMode"),R=Symbol("destroyed"),xr=Symbol("error"),Rr=Symbol("emitData"),mo=Symbol("emitEnd"),$r=Symbol("emitEnd2"),ye=Symbol("async"),Tr=Symbol("abort"),rs=Symbol("aborted"),li=Symbol("signal"),ht=Symbol("dataListeners"),q=Symbol("discarded"),hi=i=>Promise.resolve().then(i),uc=i=>i(),dc=i=>i==="end"||i==="finish"||i==="prefinish",mc=i=>i instanceof ArrayBuffer||!!i&&typeof i=="object"&&i.constructor&&i.constructor.name==="ArrayBuffer"&&i.byteLength>=0,pc=i=>!Buffer.isBuffer(i)&&ArrayBuffer.isView(i),ns=class{src;dest;opts;ondrain;constructor(e,t,s){this.src=e,this.dest=t,this.opts=s,this.ondrain=()=>e[Mt](),this.dest.on("drain",this.ondrain)}unpipe(){this.dest.removeListener("drain",this.ondrain)}proxyErrors(e){}end(){this.unpipe(),this.opts.end&&this.dest.end()}},kr=class extends ns{unpipe(){this.src.removeListener("error",this.proxyErrors),super.unpipe()}constructor(e,t,s){super(e,t,s),this.proxyErrors=r=>t.emit("error",r),e.on("error",this.proxyErrors)}},gc=i=>!!i.objectMode,yc=i=>!i.objectMode&&!!i.encoding&&i.encoding!=="buffer",fi=class extends os.EventEmitter{[I]=!1;[ci]=!1;[K]=[];[P]=[];[z];[le];[ye];[Ct];[Pe]=!1;[Ze]=!1;[es]=!1;[ts]=!1;[ai]=null;[D]=0;[R]=!1;[li];[rs]=!1;[ht]=0;[q]=!1;writable=!0;readable=!0;constructor(...e){let t=e[0]||{};if(super(),t.objectMode&&typeof t.encoding=="string")throw new TypeError("Encoding and objectMode may not be used together");gc(t)?(this[z]=!0,this[le]=null):yc(t)?(this[le]=t.encoding,this[z]=!1):(this[z]=!1,this[le]=null),this[ye]=!!t.async,this[Ct]=this[le]?new po.StringDecoder(this[le]):null,t&&t.debugExposeBuffer===!0&&Object.defineProperty(this,"buffer",{get:()=>this[P]}),t&&t.debugExposePipes===!0&&Object.defineProperty(this,"pipes",{get:()=>this[K]});let{signal:s}=t;s&&(this[li]=s,s.aborted?this[Tr]():s.addEventListener("abort",()=>this[Tr]()))}get bufferLength(){return this[D]}get encoding(){return this[le]}set encoding(e){throw new Error("Encoding must be set at instantiation time")}setEncoding(e){throw new Error("Encoding must be set at instantiation time")}get objectMode(){return this[z]}set objectMode(e){throw new Error("objectMode must be set at instantiation time")}get async(){return this[ye]}set async(e){this[ye]=this[ye]||!!e}[Tr](){this[rs]=!0,this.emit("abort",this[li]?.reason),this.destroy(this[li]?.reason)}get aborted(){return this[rs]}set aborted(e){}write(e,t,s){if(this[rs])return!1;if(this[Pe])throw new Error("write after end");if(this[R])return this.emit("error",Object.assign(new Error("Cannot call write after a stream was destroyed"),{code:"ERR_STREAM_DESTROYED"})),!0;typeof t=="function"&&(s=t,t="utf8"),t||(t="utf8");let r=this[ye]?hi:uc;if(!this[z]&&!Buffer.isBuffer(e)){if(pc(e))e=Buffer.from(e.buffer,e.byteOffset,e.byteLength);else if(mc(e))e=Buffer.from(e);else if(typeof e!="string")throw new Error("Non-contiguous data written to non-objectMode stream")}return this[z]?(this[I]&&this[D]!==0&&this[is](!0),this[I]?this.emit("data",e):this[Er](e),this[D]!==0&&this.emit("readable"),s&&r(s),this[I]):e.length?(typeof e=="string"&&!(t===this[le]&&!this[Ct]?.lastNeed)&&(e=Buffer.from(e,t)),Buffer.isBuffer(e)&&this[le]&&(e=this[Ct].write(e)),this[I]&&this[D]!==0&&this[is](!0),this[I]?this.emit("data",e):this[Er](e),this[D]!==0&&this.emit("readable"),s&&r(s),this[I]):(this[D]!==0&&this.emit("readable"),s&&r(s),this[I])}read(e){if(this[R])return null;if(this[q]=!1,this[D]===0||e===0||e&&e>this[D])return this[De](),null;this[z]&&(e=null),this[P].length>1&&!this[z]&&(this[P]=[this[le]?this[P].join(""):Buffer.concat(this[P],this[D])]);let t=this[fo](e||null,this[P][0]);return this[De](),t}[fo](e,t){if(this[z])this[ss]();else{let s=t;e===s.length||e===null?this[ss]():typeof s=="string"?(this[P][0]=s.slice(e),t=s.slice(0,e),this[D]-=e):(this[P][0]=s.subarray(e),t=s.subarray(0,e),this[D]-=e)}return this.emit("data",t),!this[P].length&&!this[Pe]&&this.emit("drain"),t}end(e,t,s){return typeof e=="function"&&(s=e,e=void 0),typeof t=="function"&&(s=t,t="utf8"),e!==void 0&&this.write(e,t),s&&this.once("end",s),this[Pe]=!0,this.writable=!1,(this[I]||!this[ci])&&this[De](),this}[Mt](){this[R]||(!this[ht]&&!this[K].length&&(this[q]=!0),this[ci]=!1,this[I]=!0,this.emit("resume"),this[P].length?this[is]():this[Pe]?this[De]():this.emit("drain"))}resume(){return this[Mt]()}pause(){this[I]=!1,this[ci]=!0,this[q]=!1}get destroyed(){return this[R]}get flowing(){return this[I]}get paused(){return this[ci]}[Er](e){this[z]?this[D]+=1:this[D]+=e.length,this[P].push(e)}[ss](){return this[z]?this[D]-=1:this[D]-=this[P][0].length,this[P].shift()}[is](e=!1){do;while(this[uo](this[ss]())&&this[P].length);!e&&!this[P].length&&!this[Pe]&&this.emit("drain")}[uo](e){return this.emit("data",e),this[I]}pipe(e,t){if(this[R])return e;this[q]=!1;let s=this[Ze];return t=t||{},e===ho.stdout||e===ho.stderr?t.end=!1:t.end=t.end!==!1,t.proxyErrors=!!t.proxyErrors,s?t.end&&e.end():(this[K].push(t.proxyErrors?new kr(this,e,t):new ns(this,e,t)),this[ye]?hi(()=>this[Mt]()):this[Mt]()),e}unpipe(e){let t=this[K].find(s=>s.dest===e);t&&(this[K].length===1?(this[I]&&this[ht]===0&&(this[I]=!1),this[K]=[]):this[K].splice(this[K].indexOf(t),1),t.unpipe())}addListener(e,t){return this.on(e,t)}on(e,t){let s=super.on(e,t);if(e==="data")this[q]=!1,this[ht]++,!this[K].length&&!this[I]&&this[Mt]();else if(e==="readable"&&this[D]!==0)super.emit("readable");else if(dc(e)&&this[Ze])super.emit(e),this.removeAllListeners(e);else if(e==="error"&&this[ai]){let r=t;this[ye]?hi(()=>r.call(this,this[ai])):r.call(this,this[ai])}return s}removeListener(e,t){return this.off(e,t)}off(e,t){let s=super.off(e,t);return e==="data"&&(this[ht]=this.listeners("data").length,this[ht]===0&&!this[q]&&!this[K].length&&(this[I]=!1)),s}removeAllListeners(e){let t=super.removeAllListeners(e);return(e==="data"||e===void 0)&&(this[ht]=0,!this[q]&&!this[K].length&&(this[I]=!1)),t}get emittedEnd(){return this[Ze]}[De](){!this[es]&&!this[Ze]&&!this[R]&&this[P].length===0&&this[Pe]&&(this[es]=!0,this.emit("end"),this.emit("prefinish"),this.emit("finish"),this[ts]&&this.emit("close"),this[es]=!1)}emit(e,...t){let s=t[0];if(e!=="error"&&e!=="close"&&e!==R&&this[R])return!1;if(e==="data")return!this[z]&&!s?!1:this[ye]?(hi(()=>this[Rr](s)),!0):this[Rr](s);if(e==="end")return this[mo]();if(e==="close"){if(this[ts]=!0,!this[Ze]&&!this[R])return!1;let n=super.emit("close");return this.removeAllListeners("close"),n}else if(e==="error"){this[ai]=s,super.emit(xr,s);let n=!this[li]||this.listeners("error").length?super.emit("error",s):!1;return this[De](),n}else if(e==="resume"){let n=super.emit("resume");return this[De](),n}else if(e==="finish"||e==="prefinish"){let n=super.emit(e);return this.removeAllListeners(e),n}let r=super.emit(e,...t);return this[De](),r}[Rr](e){for(let s of this[K])s.dest.write(e)===!1&&this.pause();let t=this[q]?!1:super.emit("data",e);return this[De](),t}[mo](){return this[Ze]?!1:(this[Ze]=!0,this.readable=!1,this[ye]?(hi(()=>this[$r]()),!0):this[$r]())}[$r](){if(this[Ct]){let t=this[Ct].end();if(t){for(let s of this[K])s.dest.write(t);this[q]||super.emit("data",t)}}for(let t of this[K])t.end();let e=super.emit("end");return this.removeAllListeners("end"),e}async collect(){let e=Object.assign([],{dataLength:0});this[z]||(e.dataLength=0);let t=this.promise();return this.on("data",s=>{e.push(s),this[z]||(e.dataLength+=s.length)}),await t,e}async concat(){if(this[z])throw new Error("cannot concat in objectMode");let e=await this.collect();return this[le]?e.join(""):Buffer.concat(e,e.dataLength)}async promise(){return new Promise((e,t)=>{this.on(R,()=>t(new Error("stream destroyed"))),this.on("error",s=>t(s)),this.on("end",()=>e())})}[Symbol.asyncIterator](){this[q]=!1;let e=!1,t=async()=>(this.pause(),e=!0,{value:void 0,done:!0});return{next:()=>{if(e)return t();let r=this.read();if(r!==null)return Promise.resolve({done:!1,value:r});if(this[Pe])return t();let n,o,a=h=>{this.off("data",c),this.off("end",l),this.off(R,f),t(),o(h)},c=h=>{this.off("error",a),this.off("end",l),this.off(R,f),this.pause(),n({value:h,done:!!this[Pe]})},l=()=>{this.off("error",a),this.off("data",c),this.off(R,f),t(),n({done:!0,value:void 0})},f=()=>a(new Error("stream destroyed"));return new Promise((h,m)=>{o=m,n=h,this.once(R,f),this.once("error",a),this.once("end",l),this.once("data",c)})},throw:t,return:t,[Symbol.asyncIterator](){return this}}}[Symbol.iterator](){this[q]=!1;let e=!1,t=()=>(this.pause(),this.off(xr,t),this.off(R,t),this.off("end",t),e=!0,{done:!0,value:void 0}),s=()=>{if(e)return t();let r=this.read();return r===null?t():{done:!1,value:r}};return this.once("end",t),this.once(xr,t),this.once(R,t),{next:s,throw:t,return:t,[Symbol.iterator](){return this}}}destroy(e){if(this[R])return e?this.emit("error",e):this.emit(R),this;this[R]=!0,this[q]=!0,this[P].length=0,this[D]=0;let t=this;return typeof t.close=="function"&&!this[ts]&&t.close(),e?this.emit("error",e):this.emit(R),this}static get isStream(){return lc}};var bo=p(require("zlib"),1);var go=p(require("zlib"),1),bc=go.default.constants||{ZLIB_VERNUM:4736},Fe=Object.freeze(Object.assign(Object.create(null),{Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_VERSION_ERROR:-6,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,DEFLATE:1,INFLATE:2,GZIP:3,GUNZIP:4,DEFLATERAW:5,INFLATERAW:6,UNZIP:7,BROTLI_DECODE:8,BROTLI_ENCODE:9,Z_MIN_WINDOWBITS:8,Z_MAX_WINDOWBITS:15,Z_DEFAULT_WINDOWBITS:15,Z_MIN_CHUNK:64,Z_MAX_CHUNK:1/0,Z_DEFAULT_CHUNK:16384,Z_MIN_MEMLEVEL:1,Z_MAX_MEMLEVEL:9,Z_DEFAULT_MEMLEVEL:8,Z_MIN_LEVEL:-1,Z_MAX_LEVEL:9,Z_DEFAULT_LEVEL:-1,BROTLI_OPERATION_PROCESS:0,BROTLI_OPERATION_FLUSH:1,BROTLI_OPERATION_FINISH:2,BROTLI_OPERATION_EMIT_METADATA:3,BROTLI_MODE_GENERIC:0,BROTLI_MODE_TEXT:1,BROTLI_MODE_FONT:2,BROTLI_DEFAULT_MODE:0,BROTLI_MIN_QUALITY:0,BROTLI_MAX_QUALITY:11,BROTLI_DEFAULT_QUALITY:11,BROTLI_MIN_WINDOW_BITS:10,BROTLI_MAX_WINDOW_BITS:24,BROTLI_LARGE_MAX_WINDOW_BITS:30,BROTLI_DEFAULT_WINDOW:22,BROTLI_MIN_INPUT_BLOCK_BITS:16,BROTLI_MAX_INPUT_BLOCK_BITS:24,BROTLI_PARAM_MODE:0,BROTLI_PARAM_QUALITY:1,BROTLI_PARAM_LGWIN:2,BROTLI_PARAM_LGBLOCK:3,BROTLI_PARAM_DISABLE_LITERAL_CONTEXT_MODELING:4,BROTLI_PARAM_SIZE_HINT:5,BROTLI_PARAM_LARGE_WINDOW:6,BROTLI_PARAM_NPOSTFIX:7,BROTLI_PARAM_NDIRECT:8,BROTLI_DECODER_RESULT_ERROR:0,BROTLI_DECODER_RESULT_SUCCESS:1,BROTLI_DECODER_RESULT_NEEDS_MORE_INPUT:2,BROTLI_DECODER_RESULT_NEEDS_MORE_OUTPUT:3,BROTLI_DECODER_PARAM_DISABLE_RING_BUFFER_REALLOCATION:0,BROTLI_DECODER_PARAM_LARGE_WINDOW:1,BROTLI_DECODER_NO_ERROR:0,BROTLI_DECODER_SUCCESS:1,BROTLI_DECODER_NEEDS_MORE_INPUT:2,BROTLI_DECODER_NEEDS_MORE_OUTPUT:3,BROTLI_DECODER_ERROR_FORMAT_EXUBERANT_NIBBLE:-1,BROTLI_DECODER_ERROR_FORMAT_RESERVED:-2,BROTLI_DECODER_ERROR_FORMAT_EXUBERANT_META_NIBBLE:-3,BROTLI_DECODER_ERROR_FORMAT_SIMPLE_HUFFMAN_ALPHABET:-4,BROTLI_DECODER_ERROR_FORMAT_SIMPLE_HUFFMAN_SAME:-5,BROTLI_DECODER_ERROR_FORMAT_CL_SPACE:-6,BROTLI_DECODER_ERROR_FORMAT_HUFFMAN_SPACE:-7,BROTLI_DECODER_ERROR_FORMAT_CONTEXT_MAP_REPEAT:-8,BROTLI_DECODER_ERROR_FORMAT_BLOCK_LENGTH_1:-9,BROTLI_DECODER_ERROR_FORMAT_BLOCK_LENGTH_2:-10,BROTLI_DECODER_ERROR_FORMAT_TRANSFORM:-11,BROTLI_DECODER_ERROR_FORMAT_DICTIONARY:-12,BROTLI_DECODER_ERROR_FORMAT_WINDOW_BITS:-13,BROTLI_DECODER_ERROR_FORMAT_PADDING_1:-14,BROTLI_DECODER_ERROR_FORMAT_PADDING_2:-15,BROTLI_DECODER_ERROR_FORMAT_DISTANCE:-16,BROTLI_DECODER_ERROR_DICTIONARY_NOT_SET:-19,BROTLI_DECODER_ERROR_INVALID_ARGUMENTS:-20,BROTLI_DECODER_ERROR_ALLOC_CONTEXT_MODES:-21,BROTLI_DECODER_ERROR_ALLOC_TREE_GROUPS:-22,BROTLI_DECODER_ERROR_ALLOC_CONTEXT_MAP:-25,BROTLI_DECODER_ERROR_ALLOC_RING_BUFFER_1:-26,BROTLI_DECODER_ERROR_ALLOC_RING_BUFFER_2:-27,BROTLI_DECODER_ERROR_ALLOC_BLOCK_TYPE_TREES:-30,BROTLI_DECODER_ERROR_UNREACHABLE:-31},bc));var yo=Ne.Buffer.concat,ft=Symbol("_superWrite"),Ut=class extends Error{code;errno;constructor(e){super("zlib: "+e.message),this.code=e.code,this.errno=e.errno,this.code||(this.code="ZLIB_ERROR"),this.message="zlib: "+e.message,Error.captureStackTrace(this,this.constructor)}get name(){return"ZlibError"}},Ar=Symbol("flushFlag"),cs=class extends fi{#e=!1;#s=!1;#t;#o;#n;#i;#r;get sawError(){return this.#e}get handle(){return this.#i}get flushFlag(){return this.#t}constructor(e,t){if(!e||typeof e!="object")throw new TypeError("invalid options for ZlibBase constructor");super(e),this.#t=e.flush??0,this.#o=e.finishFlush??0,this.#n=e.fullFlushFlag??0;try{this.#i=new bo.default[t](e)}catch(s){throw new Ut(s)}this.#r=s=>{this.#e||(this.#e=!0,this.close(),this.emit("error",s))},this.#i?.on("error",s=>this.#r(new Ut(s))),this.once("end",()=>this.close)}close(){this.#i&&(this.#i.close(),this.#i=void 0,this.emit("close"))}reset(){if(!this.#e)return(0,as.default)(this.#i,"zlib binding closed"),this.#i.reset?.()}flush(e){this.ended||(typeof e!="number"&&(e=this.#n),this.write(Object.assign(Ne.Buffer.alloc(0),{[Ar]:e})))}end(e,t,s){return typeof e=="function"&&(s=e,t=void 0,e=void 0),typeof t=="function"&&(s=t,t=void 0),e&&(t?this.write(e,t):this.write(e)),this.flush(this.#o),this.#s=!0,super.end(s)}get ended(){return this.#s}[ft](e){return super.write(e)}write(e,t,s){if(typeof t=="function"&&(s=t,t="utf8"),typeof e=="string"&&(e=Ne.Buffer.from(e,t)),this.#e)return;(0,as.default)(this.#i,"zlib binding closed");let r=this.#i._handle,n=r.close;r.close=()=>{};let o=this.#i.close;this.#i.close=()=>{},Ne.Buffer.concat=l=>l;let a;try{let l=typeof e[Ar]=="number"?e[Ar]:this.#t;a=this.#i._processChunk(e,l),Ne.Buffer.concat=yo}catch(l){Ne.Buffer.concat=yo,this.#r(new Ut(l))}finally{this.#i&&(this.#i._handle=r,r.close=n,this.#i.close=o,this.#i.removeAllListeners("error"))}this.#i&&this.#i.on("error",l=>this.#r(new Ut(l)));let c;if(a)if(Array.isArray(a)&&a.length>0){let l=a[0];c=this[ft](Ne.Buffer.from(l));for(let f=1;f<a.length;f++)c=this[ft](a[f])}else c=this[ft](Ne.Buffer.from(a));return s&&s(),c}},ls=class extends cs{#e;#s;constructor(e,t){e=e||{},e.flush=e.flush||Fe.Z_NO_FLUSH,e.finishFlush=e.finishFlush||Fe.Z_FINISH,e.fullFlushFlag=Fe.Z_FULL_FLUSH,super(e,t),this.#e=e.level,this.#s=e.strategy}params(e,t){if(!this.sawError){if(!this.handle)throw new Error("cannot switch params when binding is closed");if(!this.handle.params)throw new Error("not supported in this implementation");if(this.#e!==e||this.#s!==t){this.flush(Fe.Z_SYNC_FLUSH),(0,as.default)(this.handle,"zlib binding closed");let s=this.handle.flush;this.handle.flush=(r,n)=>{typeof r=="function"&&(n=r,r=this.flushFlag),this.flush(r),n?.()};try{this.handle.params(e,t)}finally{this.handle.flush=s}this.handle&&(this.#e=e,this.#s=t)}}}};var hs=class extends ls{#e;constructor(e){super(e,"Gzip"),this.#e=e&&!!e.portable}[ft](e){return this.#e?(this.#e=!1,e[9]=255,super[ft](e)):super[ft](e)}};var fs=class extends ls{constructor(e){super(e,"Unzip")}},us=class extends cs{constructor(e,t){e=e||{},e.flush=e.flush||Fe.BROTLI_OPERATION_PROCESS,e.finishFlush=e.finishFlush||Fe.BROTLI_OPERATION_FINISH,e.fullFlushFlag=Fe.BROTLI_OPERATION_FLUSH,super(e,t)}},ds=class extends us{constructor(e){super(e,"BrotliCompress")}},ms=class extends us{constructor(e){super(e,"BrotliDecompress")}};var Bt=class i{tail;head;length=0;static create(e=[]){return new i(e)}constructor(e=[]){for(let t of e)this.push(t)}*[Symbol.iterator](){for(let e=this.head;e;e=e.next)yield e.value}removeNode(e){if(e.list!==this)throw new Error("removing node which does not belong to this list");let t=e.next,s=e.prev;return t&&(t.prev=s),s&&(s.next=t),e===this.head&&(this.head=t),e===this.tail&&(this.tail=s),this.length--,e.next=void 0,e.prev=void 0,e.list=void 0,t}unshiftNode(e){if(e===this.head)return;e.list&&e.list.removeNode(e);let t=this.head;e.list=this,e.next=t,t&&(t.prev=e),this.head=e,this.tail||(this.tail=e),this.length++}pushNode(e){if(e===this.tail)return;e.list&&e.list.removeNode(e);let t=this.tail;e.list=this,e.prev=t,t&&(t.next=e),this.tail=e,this.head||(this.head=e),this.length++}push(...e){for(let t=0,s=e.length;t<s;t++)Ec(this,e[t]);return this.length}unshift(...e){for(var t=0,s=e.length;t<s;t++)xc(this,e[t]);return this.length}pop(){if(!this.tail)return;let e=this.tail.value,t=this.tail;return this.tail=this.tail.prev,this.tail?this.tail.next=void 0:this.head=void 0,t.list=void 0,this.length--,e}shift(){if(!this.head)return;let e=this.head.value,t=this.head;return this.head=this.head.next,this.head?this.head.prev=void 0:this.tail=void 0,t.list=void 0,this.length--,e}forEach(e,t){t=t||this;for(let s=this.head,r=0;s;r++)e.call(t,s.value,r,this),s=s.next}forEachReverse(e,t){t=t||this;for(let s=this.tail,r=this.length-1;s;r--)e.call(t,s.value,r,this),s=s.prev}get(e){let t=0,s=this.head;for(;s&&t<e;t++)s=s.next;if(t===e&&s)return s.value}getReverse(e){let t=0,s=this.tail;for(;s&&t<e;t++)s=s.prev;if(t===e&&s)return s.value}map(e,t){t=t||this;let s=new i;for(let r=this.head;r;)s.push(e.call(t,r.value,this)),r=r.next;return s}mapReverse(e,t){t=t||this;var s=new i;for(let r=this.tail;r;)s.push(e.call(t,r.value,this)),r=r.prev;return s}reduce(e,t){let s,r=this.head;if(arguments.length>1)s=t;else if(this.head)r=this.head.next,s=this.head.value;else throw new TypeError("Reduce of empty list with no initial value");for(var n=0;r;n++)s=e(s,r.value,n),r=r.next;return s}reduceReverse(e,t){let s,r=this.tail;if(arguments.length>1)s=t;else if(this.tail)r=this.tail.prev,s=this.tail.value;else throw new TypeError("Reduce of empty list with no initial value");for(let n=this.length-1;r;n--)s=e(s,r.value,n),r=r.prev;return s}toArray(){let e=new Array(this.length);for(let t=0,s=this.head;s;t++)e[t]=s.value,s=s.next;return e}toArrayReverse(){let e=new Array(this.length);for(let t=0,s=this.tail;s;t++)e[t]=s.value,s=s.prev;return e}slice(e=0,t=this.length){t<0&&(t+=this.length),e<0&&(e+=this.length);let s=new i;if(t<e||t<0)return s;e<0&&(e=0),t>this.length&&(t=this.length);let r=this.head,n=0;for(n=0;r&&n<e;n++)r=r.next;for(;r&&n<t;n++,r=r.next)s.push(r.value);return s}sliceReverse(e=0,t=this.length){t<0&&(t+=this.length),e<0&&(e+=this.length);let s=new i;if(t<e||t<0)return s;e<0&&(e=0),t>this.length&&(t=this.length);let r=this.length,n=this.tail;for(;n&&r>t;r--)n=n.prev;for(;n&&r>e;r--,n=n.prev)s.push(n.value);return s}splice(e,t=0,...s){e>this.length&&(e=this.length-1),e<0&&(e=this.length+e);let r=this.head;for(let o=0;r&&o<e;o++)r=r.next;let n=[];for(let o=0;r&&o<t;o++)n.push(r.value),r=this.removeNode(r);r?r!==this.tail&&(r=r.prev):r=this.tail;for(let o of s)r=Sc(this,r,o);return n}reverse(){let e=this.head,t=this.tail;for(let s=e;s;s=s.prev){let r=s.prev;s.prev=s.next,s.next=r}return this.head=t,this.tail=e,this}};function Sc(i,e,t){let s=e,r=e?e.next:i.head,n=new ui(t,s,r,i);return n.next===void 0&&(i.tail=n),n.prev===void 0&&(i.head=n),i.length++,n}function Ec(i,e){i.tail=new ui(e,i.tail,void 0,i),i.head||(i.head=i.tail),i.length++}function xc(i,e){i.head=new ui(e,void 0,i.head,i),i.tail||(i.tail=i.head),i.length++}var ui=class{list;next;prev;value;constructor(e,t,s,r){this.list=r,this.value=e,t?(t.next=this,this.prev=t):this.prev=void 0,s?(s.prev=this,this.next=s):this.next=void 0}};var mt=require("node:path");var wo=(i,e)=>{if(Number.isSafeInteger(i))i<0?$c(i,e):Rc(i,e);else throw Error("cannot encode number outside of javascript safe integer range");return e},Rc=(i,e)=>{e[0]=128;for(var t=e.length;t>1;t--)e[t-1]=i&255,i=Math.floor(i/256)},$c=(i,e)=>{e[0]=255;var t=!1;i=i*-1;for(var s=e.length;s>1;s--){var r=i&255;i=Math.floor(i/256),t?e[s-1]=Eo(r):r===0?e[s-1]=0:(t=!0,e[s-1]=xo(r))}},So=i=>{let e=i[0],t=e===128?kc(i.subarray(1,i.length)):e===255?Tc(i):null;if(t===null)throw Error("invalid base256 encoding");if(!Number.isSafeInteger(t))throw Error("parsed number outside of javascript safe integer range");return t},Tc=i=>{for(var e=i.length,t=0,s=!1,r=e-1;r>-1;r--){var n=Number(i[r]),o;s?o=Eo(n):n===0?o=n:(s=!0,o=xo(n)),o!==0&&(t-=o*Math.pow(256,e-r-1))}return t},kc=i=>{for(var e=i.length,t=0,s=e-1;s>-1;s--){var r=Number(i[s]);r!==0&&(t+=r*Math.pow(256,e-s-1))}return t},Eo=i=>(255^i)&255,xo=i=>(255^i)+1&255;var ps=i=>gs.has(i);var gs=new Map([["0","File"],["","OldFile"],["1","Link"],["2","SymbolicLink"],["3","CharacterDevice"],["4","BlockDevice"],["5","Directory"],["6","FIFO"],["7","ContiguousFile"],["g","GlobalExtendedHeader"],["x","ExtendedHeader"],["A","SolarisACL"],["D","GNUDumpDir"],["I","Inode"],["K","NextFileHasLongLinkpath"],["L","NextFileHasLongPath"],["M","ContinuationFile"],["N","OldGnuLongPath"],["S","SparseFile"],["V","TapeVolumeHeader"],["X","OldExtendedHeader"]]),Ro=new Map(Array.from(gs).map(i=>[i[1],i[0]]));var Q=class{cksumValid=!1;needPax=!1;nullBlock=!1;block;path;mode;uid;gid;size;cksum;#e="Unsupported";linkpath;uname;gname;devmaj=0;devmin=0;atime;ctime;mtime;charset;comment;constructor(e,t=0,s,r){Buffer.isBuffer(e)?this.decode(e,t||0,s,r):e&&this.#s(e)}decode(e,t,s,r){if(t||(t=0),!e||!(e.length>=t+512))throw new Error("need 512 bytes for header");this.path=ut(e,t,100),this.mode=Ye(e,t+100,8),this.uid=Ye(e,t+108,8),this.gid=Ye(e,t+116,8),this.size=Ye(e,t+124,12),this.mtime=Or(e,t+136,12),this.cksum=Ye(e,t+148,12),r&&this.#s(r,!0),s&&this.#s(s);let n=ut(e,t+156,1);if(ps(n)&&(this.#e=n||"0"),this.#e==="0"&&this.path.slice(-1)==="/"&&(this.#e="5"),this.#e==="5"&&(this.size=0),this.linkpath=ut(e,t+157,100),e.subarray(t+257,t+265).toString()==="ustar\x0000")if(this.uname=ut(e,t+265,32),this.gname=ut(e,t+297,32),this.devmaj=Ye(e,t+329,8)??0,this.devmin=Ye(e,t+337,8)??0,e[t+475]!==0){let a=ut(e,t+345,155);this.path=a+"/"+this.path}else{let a=ut(e,t+345,130);a&&(this.path=a+"/"+this.path),this.atime=Or(e,t+476,12),this.ctime=Or(e,t+488,12)}let o=8*32;for(let a=t;a<t+148;a++)o+=e[a];for(let a=t+156;a<t+512;a++)o+=e[a];this.cksumValid=o===this.cksum,this.cksum===void 0&&o===8*32&&(this.nullBlock=!0)}#s(e,t=!1){Object.assign(this,Object.fromEntries(Object.entries(e).filter(([s,r])=>!(r==null||s==="path"&&t||s==="linkpath"&&t||s==="global"))))}encode(e,t=0){if(e||(e=this.block=Buffer.alloc(512)),this.#e==="Unsupported"&&(this.#e="0"),!(e.length>=t+512))throw new Error("need 512 bytes for header");let s=this.ctime||this.atime?130:155,r=Ac(this.path||"",s),n=r[0],o=r[1];this.needPax=!!r[2],this.needPax=dt(e,t,100,n)||this.needPax,this.needPax=Xe(e,t+100,8,this.mode)||this.needPax,this.needPax=Xe(e,t+108,8,this.uid)||this.needPax,this.needPax=Xe(e,t+116,8,this.gid)||this.needPax,this.needPax=Xe(e,t+124,12,this.size)||this.needPax,this.needPax=vr(e,t+136,12,this.mtime)||this.needPax,e[t+156]=this.#e.charCodeAt(0),this.needPax=dt(e,t+157,100,this.linkpath)||this.needPax,e.write("ustar\x0000",t+257,8),this.needPax=dt(e,t+265,32,this.uname)||this.needPax,this.needPax=dt(e,t+297,32,this.gname)||this.needPax,this.needPax=Xe(e,t+329,8,this.devmaj)||this.needPax,this.needPax=Xe(e,t+337,8,this.devmin)||this.needPax,this.needPax=dt(e,t+345,s,o)||this.needPax,e[t+475]!==0?this.needPax=dt(e,t+345,155,o)||this.needPax:(this.needPax=dt(e,t+345,130,o)||this.needPax,this.needPax=vr(e,t+476,12,this.atime)||this.needPax,this.needPax=vr(e,t+488,12,this.ctime)||this.needPax);let a=8*32;for(let c=t;c<t+148;c++)a+=e[c];for(let c=t+156;c<t+512;c++)a+=e[c];return this.cksum=a,Xe(e,t+148,8,this.cksum),this.cksumValid=!0,this.needPax}get type(){return this.#e==="Unsupported"?this.#e:gs.get(this.#e)}get typeKey(){return this.#e}set type(e){let t=String(Ro.get(e));if(ps(t)||t==="Unsupported")this.#e=t;else if(ps(e))this.#e=e;else throw new TypeError("invalid entry type: "+e)}},Ac=(i,e)=>{let s=i,r="",n,o=mt.posix.parse(i).root||".";if(Buffer.byteLength(s)<100)n=[s,r,!1];else{r=mt.posix.dirname(s),s=mt.posix.basename(s);do Buffer.byteLength(s)<=100&&Buffer.byteLength(r)<=e?n=[s,r,!1]:Buffer.byteLength(s)>100&&Buffer.byteLength(r)<=e?n=[s.slice(0,99),r,!0]:(s=mt.posix.join(mt.posix.basename(r),s),r=mt.posix.dirname(r));while(r!==o&&n===void 0);n||(n=[i.slice(0,99),"",!0])}return n},ut=(i,e,t)=>i.subarray(e,e+t).toString("utf8").replace(/\0.*/,""),Or=(i,e,t)=>Oc(Ye(i,e,t)),Oc=i=>i===void 0?void 0:new Date(i*1e3),Ye=(i,e,t)=>Number(i[e])&128?So(i.subarray(e,e+t)):Ic(i,e,t),vc=i=>isNaN(i)?void 0:i,Ic=(i,e,t)=>vc(parseInt(i.subarray(e,e+t).toString("utf8").replace(/\0.*$/,"").trim(),8)),Pc={12:8589934591,8:2097151},Xe=(i,e,t,s)=>s===void 0?!1:s>Pc[t]||s<0?(wo(s,i.subarray(e,e+t)),!0):(Dc(i,e,t,s),!1),Dc=(i,e,t,s)=>i.write(Fc(s,t),e,t,"ascii"),Fc=(i,e)=>Nc(Math.floor(i).toString(8),e),Nc=(i,e)=>(i.length===e-1?i:new Array(e-i.length-1).join("0")+i+" ")+"\0",vr=(i,e,t,s)=>s===void 0?!1:Xe(i,e,t,s.getTime()/1e3),Lc=new Array(156).join("\0"),dt=(i,e,t,s)=>s===void 0?!1:(i.write(s+Lc,e,t,"utf8"),s.length!==Buffer.byteLength(s)||s.length>t);var To=require("node:path");var Je=class i{atime;mtime;ctime;charset;comment;gid;uid;gname;uname;linkpath;dev;ino;nlink;path;size;mode;global;constructor(e,t=!1){this.atime=e.atime,this.charset=e.charset,this.comment=e.comment,this.ctime=e.ctime,this.dev=e.dev,this.gid=e.gid,this.global=t,this.gname=e.gname,this.ino=e.ino,this.linkpath=e.linkpath,this.mtime=e.mtime,this.nlink=e.nlink,this.path=e.path,this.size=e.size,this.uid=e.uid,this.uname=e.uname}encode(){let e=this.encodeBody();if(e==="")return Buffer.allocUnsafe(0);let t=Buffer.byteLength(e),s=512*Math.ceil(1+t/512),r=Buffer.allocUnsafe(s);for(let n=0;n<512;n++)r[n]=0;new Q({path:("PaxHeader/"+(0,To.basename)(this.path??"")).slice(0,99),mode:this.mode||420,uid:this.uid,gid:this.gid,size:t,mtime:this.mtime,type:this.global?"GlobalExtendedHeader":"ExtendedHeader",linkpath:"",uname:this.uname||"",gname:this.gname||"",devmaj:0,devmin:0,atime:this.atime,ctime:this.ctime}).encode(r),r.write(e,512,t,"utf8");for(let n=t+512;n<r.length;n++)r[n]=0;return r}encodeBody(){return this.encodeField("path")+this.encodeField("ctime")+this.encodeField("atime")+this.encodeField("dev")+this.encodeField("ino")+this.encodeField("nlink")+this.encodeField("charset")+this.encodeField("comment")+this.encodeField("gid")+this.encodeField("gname")+this.encodeField("linkpath")+this.encodeField("mtime")+this.encodeField("size")+this.encodeField("uid")+this.encodeField("uname")}encodeField(e){if(this[e]===void 0)return"";let t=this[e],s=t instanceof Date?t.getTime()/1e3:t,r=" "+(e==="dev"||e==="ino"||e==="nlink"?"SCHILY.":"")+e+"="+s+`
`,n=Buffer.byteLength(r),o=Math.floor(Math.log(n)/Math.log(10))+1;return n+o>=Math.pow(10,o)&&(o+=1),o+n+r}static parse(e,t,s=!1){return new i(Cc(Mc(e),t),s)}},Cc=(i,e)=>e?Object.assign({},e,i):i,Mc=i=>i.replace(/\n$/,"").split(`
`).reduce(Uc,Object.create(null)),Uc=(i,e)=>{let t=parseInt(e,10);if(t!==Buffer.byteLength(e)+1)return i;e=e.slice((t+" ").length);let s=e.split("="),r=s.shift();if(!r)return i;let n=r.replace(/^SCHILY\.(dev|ino|nlink)/,"$1"),o=s.join("=");return i[n]=/^([A-Z]+\.)?([mac]|birth|creation)time$/.test(n)?new Date(Number(o)*1e3):/^[0-9]+$/.test(o)?+o:o,i};var Rs=require("node:events"),Cr=p(require("node:stream"),1),vo=require("node:string_decoder"),ko=typeof process=="object"&&process?process:{stdout:null,stderr:null},Bc=i=>!!i&&typeof i=="object"&&(i instanceof we||i instanceof Cr.default||zc(i)||Wc(i)),zc=i=>!!i&&typeof i=="object"&&i instanceof Rs.EventEmitter&&typeof i.pipe=="function"&&i.pipe!==Cr.default.Writable.prototype.pipe,Wc=i=>!!i&&typeof i=="object"&&i instanceof Rs.EventEmitter&&typeof i.write=="function"&&typeof i.end=="function",Le=Symbol("EOF"),Ce=Symbol("maybeEmitEnd"),qe=Symbol("emittedEnd"),ys=Symbol("emittingEnd"),di=Symbol("emittedError"),bs=Symbol("closed"),_o=Symbol("read"),ws=Symbol("flush"),Ao=Symbol("flushChunk"),he=Symbol("encoding"),zt=Symbol("decoder"),F=Symbol("flowing"),mi=Symbol("paused"),Wt=Symbol("resume"),N=Symbol("buffer"),Z=Symbol("pipes"),L=Symbol("bufferLength"),Ir=Symbol("bufferPush"),Ss=Symbol("bufferShift"),W=Symbol("objectMode"),$=Symbol("destroyed"),Pr=Symbol("error"),Dr=Symbol("emitData"),Oo=Symbol("emitEnd"),Fr=Symbol("emitEnd2"),be=Symbol("async"),Nr=Symbol("abort"),Es=Symbol("aborted"),pi=Symbol("signal"),pt=Symbol("dataListeners"),ee=Symbol("discarded"),gi=i=>Promise.resolve().then(i),jc=i=>i(),Hc=i=>i==="end"||i==="finish"||i==="prefinish",Vc=i=>i instanceof ArrayBuffer||!!i&&typeof i=="object"&&i.constructor&&i.constructor.name==="ArrayBuffer"&&i.byteLength>=0,Gc=i=>!Buffer.isBuffer(i)&&ArrayBuffer.isView(i),xs=class{src;dest;opts;ondrain;constructor(e,t,s){this.src=e,this.dest=t,this.opts=s,this.ondrain=()=>e[Wt](),this.dest.on("drain",this.ondrain)}unpipe(){this.dest.removeListener("drain",this.ondrain)}proxyErrors(e){}end(){this.unpipe(),this.opts.end&&this.dest.end()}},Lr=class extends xs{unpipe(){this.src.removeListener("error",this.proxyErrors),super.unpipe()}constructor(e,t,s){super(e,t,s),this.proxyErrors=r=>t.emit("error",r),e.on("error",this.proxyErrors)}},Kc=i=>!!i.objectMode,Zc=i=>!i.objectMode&&!!i.encoding&&i.encoding!=="buffer",we=class extends Rs.EventEmitter{[F]=!1;[mi]=!1;[Z]=[];[N]=[];[W];[he];[be];[zt];[Le]=!1;[qe]=!1;[ys]=!1;[bs]=!1;[di]=null;[L]=0;[$]=!1;[pi];[Es]=!1;[pt]=0;[ee]=!1;writable=!0;readable=!0;constructor(...e){let t=e[0]||{};if(super(),t.objectMode&&typeof t.encoding=="string")throw new TypeError("Encoding and objectMode may not be used together");Kc(t)?(this[W]=!0,this[he]=null):Zc(t)?(this[he]=t.encoding,this[W]=!1):(this[W]=!1,this[he]=null),this[be]=!!t.async,this[zt]=this[he]?new vo.StringDecoder(this[he]):null,t&&t.debugExposeBuffer===!0&&Object.defineProperty(this,"buffer",{get:()=>this[N]}),t&&t.debugExposePipes===!0&&Object.defineProperty(this,"pipes",{get:()=>this[Z]});let{signal:s}=t;s&&(this[pi]=s,s.aborted?this[Nr]():s.addEventListener("abort",()=>this[Nr]()))}get bufferLength(){return this[L]}get encoding(){return this[he]}set encoding(e){throw new Error("Encoding must be set at instantiation time")}setEncoding(e){throw new Error("Encoding must be set at instantiation time")}get objectMode(){return this[W]}set objectMode(e){throw new Error("objectMode must be set at instantiation time")}get async(){return this[be]}set async(e){this[be]=this[be]||!!e}[Nr](){this[Es]=!0,this.emit("abort",this[pi]?.reason),this.destroy(this[pi]?.reason)}get aborted(){return this[Es]}set aborted(e){}write(e,t,s){if(this[Es])return!1;if(this[Le])throw new Error("write after end");if(this[$])return this.emit("error",Object.assign(new Error("Cannot call write after a stream was destroyed"),{code:"ERR_STREAM_DESTROYED"})),!0;typeof t=="function"&&(s=t,t="utf8"),t||(t="utf8");let r=this[be]?gi:jc;if(!this[W]&&!Buffer.isBuffer(e)){if(Gc(e))e=Buffer.from(e.buffer,e.byteOffset,e.byteLength);else if(Vc(e))e=Buffer.from(e);else if(typeof e!="string")throw new Error("Non-contiguous data written to non-objectMode stream")}return this[W]?(this[F]&&this[L]!==0&&this[ws](!0),this[F]?this.emit("data",e):this[Ir](e),this[L]!==0&&this.emit("readable"),s&&r(s),this[F]):e.length?(typeof e=="string"&&!(t===this[he]&&!this[zt]?.lastNeed)&&(e=Buffer.from(e,t)),Buffer.isBuffer(e)&&this[he]&&(e=this[zt].write(e)),this[F]&&this[L]!==0&&this[ws](!0),this[F]?this.emit("data",e):this[Ir](e),this[L]!==0&&this.emit("readable"),s&&r(s),this[F]):(this[L]!==0&&this.emit("readable"),s&&r(s),this[F])}read(e){if(this[$])return null;if(this[ee]=!1,this[L]===0||e===0||e&&e>this[L])return this[Ce](),null;this[W]&&(e=null),this[N].length>1&&!this[W]&&(this[N]=[this[he]?this[N].join(""):Buffer.concat(this[N],this[L])]);let t=this[_o](e||null,this[N][0]);return this[Ce](),t}[_o](e,t){if(this[W])this[Ss]();else{let s=t;e===s.length||e===null?this[Ss]():typeof s=="string"?(this[N][0]=s.slice(e),t=s.slice(0,e),this[L]-=e):(this[N][0]=s.subarray(e),t=s.subarray(0,e),this[L]-=e)}return this.emit("data",t),!this[N].length&&!this[Le]&&this.emit("drain"),t}end(e,t,s){return typeof e=="function"&&(s=e,e=void 0),typeof t=="function"&&(s=t,t="utf8"),e!==void 0&&this.write(e,t),s&&this.once("end",s),this[Le]=!0,this.writable=!1,(this[F]||!this[mi])&&this[Ce](),this}[Wt](){this[$]||(!this[pt]&&!this[Z].length&&(this[ee]=!0),this[mi]=!1,this[F]=!0,this.emit("resume"),this[N].length?this[ws]():this[Le]?this[Ce]():this.emit("drain"))}resume(){return this[Wt]()}pause(){this[F]=!1,this[mi]=!0,this[ee]=!1}get destroyed(){return this[$]}get flowing(){return this[F]}get paused(){return this[mi]}[Ir](e){this[W]?this[L]+=1:this[L]+=e.length,this[N].push(e)}[Ss](){return this[W]?this[L]-=1:this[L]-=this[N][0].length,this[N].shift()}[ws](e=!1){do;while(this[Ao](this[Ss]())&&this[N].length);!e&&!this[N].length&&!this[Le]&&this.emit("drain")}[Ao](e){return this.emit("data",e),this[F]}pipe(e,t){if(this[$])return e;this[ee]=!1;let s=this[qe];return t=t||{},e===ko.stdout||e===ko.stderr?t.end=!1:t.end=t.end!==!1,t.proxyErrors=!!t.proxyErrors,s?t.end&&e.end():(this[Z].push(t.proxyErrors?new Lr(this,e,t):new xs(this,e,t)),this[be]?gi(()=>this[Wt]()):this[Wt]()),e}unpipe(e){let t=this[Z].find(s=>s.dest===e);t&&(this[Z].length===1?(this[F]&&this[pt]===0&&(this[F]=!1),this[Z]=[]):this[Z].splice(this[Z].indexOf(t),1),t.unpipe())}addListener(e,t){return this.on(e,t)}on(e,t){let s=super.on(e,t);if(e==="data")this[ee]=!1,this[pt]++,!this[Z].length&&!this[F]&&this[Wt]();else if(e==="readable"&&this[L]!==0)super.emit("readable");else if(Hc(e)&&this[qe])super.emit(e),this.removeAllListeners(e);else if(e==="error"&&this[di]){let r=t;this[be]?gi(()=>r.call(this,this[di])):r.call(this,this[di])}return s}removeListener(e,t){return this.off(e,t)}off(e,t){let s=super.off(e,t);return e==="data"&&(this[pt]=this.listeners("data").length,this[pt]===0&&!this[ee]&&!this[Z].length&&(this[F]=!1)),s}removeAllListeners(e){let t=super.removeAllListeners(e);return(e==="data"||e===void 0)&&(this[pt]=0,!this[ee]&&!this[Z].length&&(this[F]=!1)),t}get emittedEnd(){return this[qe]}[Ce](){!this[ys]&&!this[qe]&&!this[$]&&this[N].length===0&&this[Le]&&(this[ys]=!0,this.emit("end"),this.emit("prefinish"),this.emit("finish"),this[bs]&&this.emit("close"),this[ys]=!1)}emit(e,...t){let s=t[0];if(e!=="error"&&e!=="close"&&e!==$&&this[$])return!1;if(e==="data")return!this[W]&&!s?!1:this[be]?(gi(()=>this[Dr](s)),!0):this[Dr](s);if(e==="end")return this[Oo]();if(e==="close"){if(this[bs]=!0,!this[qe]&&!this[$])return!1;let n=super.emit("close");return this.removeAllListeners("close"),n}else if(e==="error"){this[di]=s,super.emit(Pr,s);let n=!this[pi]||this.listeners("error").length?super.emit("error",s):!1;return this[Ce](),n}else if(e==="resume"){let n=super.emit("resume");return this[Ce](),n}else if(e==="finish"||e==="prefinish"){let n=super.emit(e);return this.removeAllListeners(e),n}let r=super.emit(e,...t);return this[Ce](),r}[Dr](e){for(let s of this[Z])s.dest.write(e)===!1&&this.pause();let t=this[ee]?!1:super.emit("data",e);return this[Ce](),t}[Oo](){return this[qe]?!1:(this[qe]=!0,this.readable=!1,this[be]?(gi(()=>this[Fr]()),!0):this[Fr]())}[Fr](){if(this[zt]){let t=this[zt].end();if(t){for(let s of this[Z])s.dest.write(t);this[ee]||super.emit("data",t)}}for(let t of this[Z])t.end();let e=super.emit("end");return this.removeAllListeners("end"),e}async collect(){let e=Object.assign([],{dataLength:0});this[W]||(e.dataLength=0);let t=this.promise();return this.on("data",s=>{e.push(s),this[W]||(e.dataLength+=s.length)}),await t,e}async concat(){if(this[W])throw new Error("cannot concat in objectMode");let e=await this.collect();return this[he]?e.join(""):Buffer.concat(e,e.dataLength)}async promise(){return new Promise((e,t)=>{this.on($,()=>t(new Error("stream destroyed"))),this.on("error",s=>t(s)),this.on("end",()=>e())})}[Symbol.asyncIterator](){this[ee]=!1;let e=!1,t=async()=>(this.pause(),e=!0,{value:void 0,done:!0});return{next:()=>{if(e)return t();let r=this.read();if(r!==null)return Promise.resolve({done:!1,value:r});if(this[Le])return t();let n,o,a=h=>{this.off("data",c),this.off("end",l),this.off($,f),t(),o(h)},c=h=>{this.off("error",a),this.off("end",l),this.off($,f),this.pause(),n({value:h,done:!!this[Le]})},l=()=>{this.off("error",a),this.off("data",c),this.off($,f),t(),n({done:!0,value:void 0})},f=()=>a(new Error("stream destroyed"));return new Promise((h,m)=>{o=m,n=h,this.once($,f),this.once("error",a),this.once("end",l),this.once("data",c)})},throw:t,return:t,[Symbol.asyncIterator](){return this}}}[Symbol.iterator](){this[ee]=!1;let e=!1,t=()=>(this.pause(),this.off(Pr,t),this.off($,t),this.off("end",t),e=!0,{done:!0,value:void 0}),s=()=>{if(e)return t();let r=this.read();return r===null?t():{done:!1,value:r}};return this.once("end",t),this.once(Pr,t),this.once($,t),{next:s,throw:t,return:t,[Symbol.iterator](){return this}}}destroy(e){if(this[$])return e?this.emit("error",e):this.emit($),this;this[$]=!0,this[ee]=!0,this[N].length=0,this[L]=0;let t=this;return typeof t.close=="function"&&!this[bs]&&t.close(),e?this.emit("error",e):this.emit($),this}static get isStream(){return Bc}};var Yc=process.env.TESTING_TAR_FAKE_PLATFORM||process.platform,u=Yc!=="win32"?i=>i:i=>i&&i.replace(/\\/g,"/");var jt=class extends we{extended;globalExtended;header;startBlockSize;blockRemain;remain;type;meta=!1;ignore=!1;path;mode;uid;gid;uname;gname;size=0;mtime;atime;ctime;linkpath;dev;ino;nlink;invalid=!1;absolute;unsupported=!1;constructor(e,t,s){switch(super({}),this.pause(),this.extended=t,this.globalExtended=s,this.header=e,this.remain=e.size??0,this.startBlockSize=512*Math.ceil(this.remain/512),this.blockRemain=this.startBlockSize,this.type=e.type,this.type){case"File":case"OldFile":case"Link":case"SymbolicLink":case"CharacterDevice":case"BlockDevice":case"Directory":case"FIFO":case"ContiguousFile":case"GNUDumpDir":break;case"NextFileHasLongLinkpath":case"NextFileHasLongPath":case"OldGnuLongPath":case"GlobalExtendedHeader":case"ExtendedHeader":case"OldExtendedHeader":this.meta=!0;break;default:this.ignore=!0}if(!e.path)throw new Error("no path provided for tar.ReadEntry");this.path=u(e.path),this.mode=e.mode,this.mode&&(this.mode=this.mode&4095),this.uid=e.uid,this.gid=e.gid,this.uname=e.uname,this.gname=e.gname,this.size=this.remain,this.mtime=e.mtime,this.atime=e.atime,this.ctime=e.ctime,this.linkpath=e.linkpath?u(e.linkpath):void 0,this.uname=e.uname,this.gname=e.gname,t&&this.#e(t),s&&this.#e(s,!0)}write(e){let t=e.length;if(t>this.blockRemain)throw new Error("writing more to entry than is appropriate");let s=this.remain,r=this.blockRemain;return this.remain=Math.max(0,s-t),this.blockRemain=Math.max(0,r-t),this.ignore?!0:s>=t?super.write(e):super.write(e.subarray(0,s))}#e(e,t=!1){e.path&&(e.path=u(e.path)),e.linkpath&&(e.linkpath=u(e.linkpath)),Object.assign(this,Object.fromEntries(Object.entries(e).filter(([s,r])=>!(r==null||s==="path"&&t))))}};var gt=(i,e,t,s={})=>{i.file&&(s.file=i.file),i.cwd&&(s.cwd=i.cwd),s.code=t instanceof Error&&t.code||e,s.tarCode=e,!i.strict&&s.recoverable!==!1?(t instanceof Error&&(s=Object.assign(t,s),t=t.message),i.emit("warn",e,t,s)):t instanceof Error?i.emit("error",Object.assign(t,s)):i.emit("error",Object.assign(new Error(`${e}: ${t}`),s))};var Xc=1024*1024,Mr=Buffer.from([31,139]),se=Symbol("state"),yt=Symbol("writeEntry"),Me=Symbol("readEntry"),Ur=Symbol("nextEntry"),Io=Symbol("processEntry"),Se=Symbol("extendedHeader"),yi=Symbol("globalExtendedHeader"),Qe=Symbol("meta"),Po=Symbol("emitMeta"),b=Symbol("buffer"),Ue=Symbol("queue"),et=Symbol("ended"),Br=Symbol("emittedEnd"),bt=Symbol("emit"),_=Symbol("unzip"),$s=Symbol("consumeChunk"),Ts=Symbol("consumeChunkSub"),zr=Symbol("consumeBody"),Do=Symbol("consumeMeta"),Fo=Symbol("consumeHeader"),bi=Symbol("consuming"),Wr=Symbol("bufferConcat"),ks=Symbol("maybeEnd"),Ht=Symbol("writing"),tt=Symbol("aborted"),_s=Symbol("onDone"),wt=Symbol("sawValidEntry"),As=Symbol("sawNullBlock"),Os=Symbol("sawEOF"),No=Symbol("closeStream"),Jc=()=>!0,Be=class extends Lo.EventEmitter{file;strict;maxMetaEntrySize;filter;brotli;writable=!0;readable=!1;[Ue]=new Bt;[b];[Me];[yt];[se]="begin";[Qe]="";[Se];[yi];[et]=!1;[_];[tt]=!1;[wt];[As]=!1;[Os]=!1;[Ht]=!1;[bi]=!1;[Br]=!1;constructor(e={}){super(),this.file=e.file||"",this.on(_s,()=>{(this[se]==="begin"||this[wt]===!1)&&this.warn("TAR_BAD_ARCHIVE","Unrecognized archive format")}),e.ondone?this.on(_s,e.ondone):this.on(_s,()=>{this.emit("prefinish"),this.emit("finish"),this.emit("end")}),this.strict=!!e.strict,this.maxMetaEntrySize=e.maxMetaEntrySize||Xc,this.filter=typeof e.filter=="function"?e.filter:Jc;let t=e.file&&(e.file.endsWith(".tar.br")||e.file.endsWith(".tbr"));this.brotli=!e.gzip&&e.brotli!==void 0?e.brotli:t?void 0:!1,this.on("end",()=>this[No]()),typeof e.onwarn=="function"&&this.on("warn",e.onwarn),typeof e.onReadEntry=="function"&&this.on("entry",e.onReadEntry)}warn(e,t,s={}){gt(this,e,t,s)}[Fo](e,t){this[wt]===void 0&&(this[wt]=!1);let s;try{s=new Q(e,t,this[Se],this[yi])}catch(r){return this.warn("TAR_ENTRY_INVALID",r)}if(s.nullBlock)this[As]?(this[Os]=!0,this[se]==="begin"&&(this[se]="header"),this[bt]("eof")):(this[As]=!0,this[bt]("nullBlock"));else if(this[As]=!1,!s.cksumValid)this.warn("TAR_ENTRY_INVALID","checksum failure",{header:s});else if(!s.path)this.warn("TAR_ENTRY_INVALID","path is required",{header:s});else{let r=s.type;if(/^(Symbolic)?Link$/.test(r)&&!s.linkpath)this.warn("TAR_ENTRY_INVALID","linkpath required",{header:s});else if(!/^(Symbolic)?Link$/.test(r)&&!/^(Global)?ExtendedHeader$/.test(r)&&s.linkpath)this.warn("TAR_ENTRY_INVALID","linkpath forbidden",{header:s});else{let n=this[yt]=new jt(s,this[Se],this[yi]);if(!this[wt])if(n.remain){let o=()=>{n.invalid||(this[wt]=!0)};n.on("end",o)}else this[wt]=!0;n.meta?n.size>this.maxMetaEntrySize?(n.ignore=!0,this[bt]("ignoredEntry",n),this[se]="ignore",n.resume()):n.size>0&&(this[Qe]="",n.on("data",o=>this[Qe]+=o),this[se]="meta"):(this[Se]=void 0,n.ignore=n.ignore||!this.filter(n.path,n),n.ignore?(this[bt]("ignoredEntry",n),this[se]=n.remain?"ignore":"header",n.resume()):(n.remain?this[se]="body":(this[se]="header",n.end()),this[Me]?this[Ue].push(n):(this[Ue].push(n),this[Ur]())))}}}[No](){queueMicrotask(()=>this.emit("close"))}[Io](e){let t=!0;if(!e)this[Me]=void 0,t=!1;else if(Array.isArray(e)){let[s,...r]=e;this.emit(s,...r)}else this[Me]=e,this.emit("entry",e),e.emittedEnd||(e.on("end",()=>this[Ur]()),t=!1);return t}[Ur](){do;while(this[Io](this[Ue].shift()));if(!this[Ue].length){let e=this[Me];!e||e.flowing||e.size===e.remain?this[Ht]||this.emit("drain"):e.once("drain",()=>this.emit("drain"))}}[zr](e,t){let s=this[yt];if(!s)throw new Error("attempt to consume body without entry??");let r=s.blockRemain??0,n=r>=e.length&&t===0?e:e.subarray(t,t+r);return s.write(n),s.blockRemain||(this[se]="header",this[yt]=void 0,s.end()),n.length}[Do](e,t){let s=this[yt],r=this[zr](e,t);return!this[yt]&&s&&this[Po](s),r}[bt](e,t,s){!this[Ue].length&&!this[Me]?this.emit(e,t,s):this[Ue].push([e,t,s])}[Po](e){switch(this[bt]("meta",this[Qe]),e.type){case"ExtendedHeader":case"OldExtendedHeader":this[Se]=Je.parse(this[Qe],this[Se],!1);break;case"GlobalExtendedHeader":this[yi]=Je.parse(this[Qe],this[yi],!0);break;case"NextFileHasLongPath":case"OldGnuLongPath":{let t=this[Se]??Object.create(null);this[Se]=t,t.path=this[Qe].replace(/\0.*/,"");break}case"NextFileHasLongLinkpath":{let t=this[Se]||Object.create(null);this[Se]=t,t.linkpath=this[Qe].replace(/\0.*/,"");break}default:throw new Error("unknown meta: "+e.type)}}abort(e){this[tt]=!0,this.emit("abort",e),this.warn("TAR_ABORT",e,{recoverable:!1})}write(e,t,s){if(typeof t=="function"&&(s=t,t=void 0),typeof e=="string"&&(e=Buffer.from(e,typeof t=="string"?t:"utf8")),this[tt])return s?.(),!1;if((this[_]===void 0||this.brotli===void 0&&this[_]===!1)&&e){if(this[b]&&(e=Buffer.concat([this[b],e]),this[b]=void 0),e.length<Mr.length)return this[b]=e,s?.(),!0;for(let a=0;this[_]===void 0&&a<Mr.length;a++)e[a]!==Mr[a]&&(this[_]=!1);let o=this.brotli===void 0;if(this[_]===!1&&o)if(e.length<512)if(this[et])this.brotli=!0;else return this[b]=e,s?.(),!0;else try{new Q(e.subarray(0,512)),this.brotli=!1}catch{this.brotli=!0}if(this[_]===void 0||this[_]===!1&&this.brotli){let a=this[et];this[et]=!1,this[_]=this[_]===void 0?new fs({}):new ms({}),this[_].on("data",l=>this[$s](l)),this[_].on("error",l=>this.abort(l)),this[_].on("end",()=>{this[et]=!0,this[$s]()}),this[Ht]=!0;let c=!!this[_][a?"end":"write"](e);return this[Ht]=!1,s?.(),c}}this[Ht]=!0,this[_]?this[_].write(e):this[$s](e),this[Ht]=!1;let n=this[Ue].length?!1:this[Me]?this[Me].flowing:!0;return!n&&!this[Ue].length&&this[Me]?.once("drain",()=>this.emit("drain")),s?.(),n}[Wr](e){e&&!this[tt]&&(this[b]=this[b]?Buffer.concat([this[b],e]):e)}[ks](){if(this[et]&&!this[Br]&&!this[tt]&&!this[bi]){this[Br]=!0;let e=this[yt];if(e&&e.blockRemain){let t=this[b]?this[b].length:0;this.warn("TAR_BAD_ARCHIVE",`Truncated input (needed ${e.blockRemain} more bytes, only ${t} available)`,{entry:e}),this[b]&&e.write(this[b]),e.end()}this[bt](_s)}}[$s](e){if(this[bi]&&e)this[Wr](e);else if(!e&&!this[b])this[ks]();else if(e){if(this[bi]=!0,this[b]){this[Wr](e);let t=this[b];this[b]=void 0,this[Ts](t)}else this[Ts](e);for(;this[b]&&this[b]?.length>=512&&!this[tt]&&!this[Os];){let t=this[b];this[b]=void 0,this[Ts](t)}this[bi]=!1}(!this[b]||this[et])&&this[ks]()}[Ts](e){let t=0,s=e.length;for(;t+512<=s&&!this[tt]&&!this[Os];)switch(this[se]){case"begin":case"header":this[Fo](e,t),t+=512;break;case"ignore":case"body":t+=this[zr](e,t);break;case"meta":t+=this[Do](e,t);break;default:throw new Error("invalid state: "+this[se])}t<s&&(this[b]?this[b]=Buffer.concat([e.subarray(t),this[b]]):this[b]=e.subarray(t))}end(e,t,s){return typeof e=="function"&&(s=e,t=void 0,e=void 0),typeof t=="function"&&(s=t,t=void 0),typeof e=="string"&&(e=Buffer.from(e,t)),s&&this.once("finish",s),this[tt]||(this[_]?(e&&this[_].write(e),this[_].end()):(this[et]=!0,this.brotli===void 0&&(e=e||Buffer.alloc(0)),e&&this.write(e),this[ks]())),this}};var Ee=i=>{let e=i.length-1,t=-1;for(;e>-1&&i.charAt(e)==="/";)t=e,e--;return t===-1?i:i.slice(0,t)};var qc=i=>{let e=i.onReadEntry;i.onReadEntry=e?t=>{e(t),t.resume()}:t=>t.resume()},jr=(i,e)=>{let t=new Map(e.map(n=>[Ee(n),!0])),s=i.filter,r=(n,o="")=>{let a=o||(0,vs.parse)(n).root||".",c;if(n===a)c=!1;else{let l=t.get(n);l!==void 0?c=l:c=r((0,vs.dirname)(n),a)}return t.set(n,c),c};i.filter=s?(n,o)=>s(n,o)&&r(Ee(n)):n=>r(Ee(n))},Qc=i=>{let e=new Be(i),t=i.file,s;try{let r=St.default.statSync(t),n=i.maxReadSize||16*1024*1024;if(r.size<n)e.end(St.default.readFileSync(t));else{let o=0,a=Buffer.allocUnsafe(n);for(s=St.default.openSync(t,"r");o<r.size;){let c=St.default.readSync(s,a,0,n,o);o+=c,e.write(a.subarray(0,c))}e.end()}}finally{if(typeof s=="number")try{St.default.closeSync(s)}catch{}}},el=(i,e)=>{let t=new Be(i),s=i.maxReadSize||16*1024*1024,r=i.file;return new Promise((o,a)=>{t.on("error",a),t.on("end",o),St.default.stat(r,(c,l)=>{if(c)a(c);else{let f=new lt(r,{readSize:s,size:l.size});f.on("error",a),f.pipe(t)}})})},Et=ge(Qc,el,i=>new Be(i),i=>new Be(i),(i,e)=>{e?.length&&jr(i,e),i.noResume||qc(i)});var $i=p(require("fs"),1);var fe=p(require("fs"),1);var Zr=p(require("path"),1);var Hr=(i,e,t)=>(i&=4095,t&&(i=(i|384)&-19),e&&(i&256&&(i|=64),i&32&&(i|=8),i&4&&(i|=1)),i);var Mo=require("node:path"),{isAbsolute:tl,parse:Co}=Mo.win32,wi=i=>{let e="",t=Co(i);for(;tl(i)||t.root;){let s=i.charAt(0)==="/"&&i.slice(0,4)!=="//?/"?"/":t.root;i=i.slice(s.length),e+=s,t=Co(i)}return[e,i]};var Is=["|","<",">","?",":"],Vr=Is.map(i=>String.fromCharCode(61440+i.charCodeAt(0))),il=new Map(Is.map((i,e)=>[i,Vr[e]])),sl=new Map(Vr.map((i,e)=>[i,Is[e]])),Gr=i=>Is.reduce((e,t)=>e.split(t).join(il.get(t)),i),Uo=i=>Vr.reduce((e,t)=>e.split(t).join(sl.get(t)),i);var Vo=(i,e)=>e?(i=u(i).replace(/^\.(\/|$)/,""),Ee(e)+"/"+i):u(i),rl=16*1024*1024,zo=Symbol("process"),Wo=Symbol("file"),jo=Symbol("directory"),Yr=Symbol("symlink"),Ho=Symbol("hardlink"),Si=Symbol("header"),Ps=Symbol("read"),Xr=Symbol("lstat"),Ds=Symbol("onlstat"),Jr=Symbol("onread"),qr=Symbol("onreadlink"),Qr=Symbol("openfile"),en=Symbol("onopenfile"),it=Symbol("close"),Fs=Symbol("mode"),tn=Symbol("awaitDrain"),Kr=Symbol("ondrain"),xe=Symbol("prefix"),Ei=class extends we{path;portable;myuid=process.getuid&&process.getuid()||0;myuser=process.env.USER||"";maxReadSize;linkCache;statCache;preservePaths;cwd;strict;mtime;noPax;noMtime;prefix;fd;blockLen=0;blockRemain=0;buf;pos=0;remain=0;length=0;offset=0;win32;absolute;header;type;linkpath;stat;onWriteEntry;#e=!1;constructor(e,t={}){let s=oi(t);super(),this.path=u(e),this.portable=!!s.portable,this.maxReadSize=s.maxReadSize||rl,this.linkCache=s.linkCache||new Map,this.statCache=s.statCache||new Map,this.preservePaths=!!s.preservePaths,this.cwd=u(s.cwd||process.cwd()),this.strict=!!s.strict,this.noPax=!!s.noPax,this.noMtime=!!s.noMtime,this.mtime=s.mtime,this.prefix=s.prefix?u(s.prefix):void 0,this.onWriteEntry=s.onWriteEntry,typeof s.onwarn=="function"&&this.on("warn",s.onwarn);let r=!1;if(!this.preservePaths){let[o,a]=wi(this.path);o&&typeof a=="string"&&(this.path=a,r=o)}this.win32=!!s.win32||process.platform==="win32",this.win32&&(this.path=Uo(this.path.replace(/\\/g,"/")),e=e.replace(/\\/g,"/")),this.absolute=u(s.absolute||Zr.default.resolve(this.cwd,e)),this.path===""&&(this.path="./"),r&&this.warn("TAR_ENTRY_INFO",`stripping ${r} from absolute path`,{entry:this,path:r+this.path});let n=this.statCache.get(this.absolute);n?this[Ds](n):this[Xr]()}warn(e,t,s={}){return gt(this,e,t,s)}emit(e,...t){return e==="error"&&(this.#e=!0),super.emit(e,...t)}[Xr](){fe.default.lstat(this.absolute,(e,t)=>{if(e)return this.emit("error",e);this[Ds](t)})}[Ds](e){this.statCache.set(this.absolute,e),this.stat=e,e.isFile()||(e.size=0),this.type=nl(e),this.emit("stat",e),this[zo]()}[zo](){switch(this.type){case"File":return this[Wo]();case"Directory":return this[jo]();case"SymbolicLink":return this[Yr]();default:return this.end()}}[Fs](e){return Hr(e,this.type==="Directory",this.portable)}[xe](e){return Vo(e,this.prefix)}[Si](){if(!this.stat)throw new Error("cannot write header before stat");this.type==="Directory"&&this.portable&&(this.noMtime=!0),this.onWriteEntry?.(this),this.header=new Q({path:this[xe](this.path),linkpath:this.type==="Link"&&this.linkpath!==void 0?this[xe](this.linkpath):this.linkpath,mode:this[Fs](this.stat.mode),uid:this.portable?void 0:this.stat.uid,gid:this.portable?void 0:this.stat.gid,size:this.stat.size,mtime:this.noMtime?void 0:this.mtime||this.stat.mtime,type:this.type==="Unsupported"?void 0:this.type,uname:this.portable?void 0:this.stat.uid===this.myuid?this.myuser:"",atime:this.portable?void 0:this.stat.atime,ctime:this.portable?void 0:this.stat.ctime}),this.header.encode()&&!this.noPax&&super.write(new Je({atime:this.portable?void 0:this.header.atime,ctime:this.portable?void 0:this.header.ctime,gid:this.portable?void 0:this.header.gid,mtime:this.noMtime?void 0:this.mtime||this.header.mtime,path:this[xe](this.path),linkpath:this.type==="Link"&&this.linkpath!==void 0?this[xe](this.linkpath):this.linkpath,size:this.header.size,uid:this.portable?void 0:this.header.uid,uname:this.portable?void 0:this.header.uname,dev:this.portable?void 0:this.stat.dev,ino:this.portable?void 0:this.stat.ino,nlink:this.portable?void 0:this.stat.nlink}).encode());let e=this.header?.block;if(!e)throw new Error("failed to encode header");super.write(e)}[jo](){if(!this.stat)throw new Error("cannot create directory entry without stat");this.path.slice(-1)!=="/"&&(this.path+="/"),this.stat.size=0,this[Si](),this.end()}[Yr](){fe.default.readlink(this.absolute,(e,t)=>{if(e)return this.emit("error",e);this[qr](t)})}[qr](e){this.linkpath=u(e),this[Si](),this.end()}[Ho](e){if(!this.stat)throw new Error("cannot create link entry without stat");this.type="Link",this.linkpath=u(Zr.default.relative(this.cwd,e)),this.stat.size=0,this[Si](),this.end()}[Wo](){if(!this.stat)throw new Error("cannot create file entry without stat");if(this.stat.nlink>1){let e=`${this.stat.dev}:${this.stat.ino}`,t=this.linkCache.get(e);if(t?.indexOf(this.cwd)===0)return this[Ho](t);this.linkCache.set(e,this.absolute)}if(this[Si](),this.stat.size===0)return this.end();this[Qr]()}[Qr](){fe.default.open(this.absolute,"r",(e,t)=>{if(e)return this.emit("error",e);this[en](t)})}[en](e){if(this.fd=e,this.#e)return this[it]();if(!this.stat)throw new Error("should stat before calling onopenfile");this.blockLen=512*Math.ceil(this.stat.size/512),this.blockRemain=this.blockLen;let t=Math.min(this.blockLen,this.maxReadSize);this.buf=Buffer.allocUnsafe(t),this.offset=0,this.pos=0,this.remain=this.stat.size,this.length=this.buf.length,this[Ps]()}[Ps](){let{fd:e,buf:t,offset:s,length:r,pos:n}=this;if(e===void 0||t===void 0)throw new Error("cannot read file without first opening");fe.default.read(e,t,s,r,n,(o,a)=>{if(o)return this[it](()=>this.emit("error",o));this[Jr](a)})}[it](e=()=>{}){this.fd!==void 0&&fe.default.close(this.fd,e)}[Jr](e){if(e<=0&&this.remain>0){let r=Object.assign(new Error("encountered unexpected EOF"),{path:this.absolute,syscall:"read",code:"EOF"});return this[it](()=>this.emit("error",r))}if(e>this.remain){let r=Object.assign(new Error("did not encounter expected EOF"),{path:this.absolute,syscall:"read",code:"EOF"});return this[it](()=>this.emit("error",r))}if(!this.buf)throw new Error("should have created buffer prior to reading");if(e===this.remain)for(let r=e;r<this.length&&e<this.blockRemain;r++)this.buf[r+this.offset]=0,e++,this.remain++;let t=this.offset===0&&e===this.buf.length?this.buf:this.buf.subarray(this.offset,this.offset+e);this.write(t)?this[Kr]():this[tn](()=>this[Kr]())}[tn](e){this.once("drain",e)}write(e,t,s){if(typeof t=="function"&&(s=t,t=void 0),typeof e=="string"&&(e=Buffer.from(e,typeof t=="string"?t:"utf8")),this.blockRemain<e.length){let r=Object.assign(new Error("writing more data than expected"),{path:this.absolute});return this.emit("error",r)}return this.remain-=e.length,this.blockRemain-=e.length,this.pos+=e.length,this.offset+=e.length,super.write(e,null,s)}[Kr](){if(!this.remain)return this.blockRemain&&super.write(Buffer.alloc(this.blockRemain)),this[it](e=>e?this.emit("error",e):this.end());if(!this.buf)throw new Error("buffer lost somehow in ONDRAIN");this.offset>=this.length&&(this.buf=Buffer.allocUnsafe(Math.min(this.blockRemain,this.buf.length)),this.offset=0),this.length=this.buf.length-this.offset,this[Ps]()}},Ns=class extends Ei{sync=!0;[Xr](){this[Ds](fe.default.lstatSync(this.absolute))}[Yr](){this[qr](fe.default.readlinkSync(this.absolute))}[Qr](){this[en](fe.default.openSync(this.absolute,"r"))}[Ps](){let e=!0;try{let{fd:t,buf:s,offset:r,length:n,pos:o}=this;if(t===void 0||s===void 0)throw new Error("fd and buf must be set in READ method");let a=fe.default.readSync(t,s,r,n,o);this[Jr](a),e=!1}finally{if(e)try{this[it](()=>{})}catch{}}}[tn](e){e()}[it](e=()=>{}){this.fd!==void 0&&fe.default.closeSync(this.fd),e()}},Ls=class extends we{blockLen=0;blockRemain=0;buf=0;pos=0;remain=0;length=0;preservePaths;portable;strict;noPax;noMtime;readEntry;type;prefix;path;mode;uid;gid;uname;gname;header;mtime;atime;ctime;linkpath;size;onWriteEntry;warn(e,t,s={}){return gt(this,e,t,s)}constructor(e,t={}){let s=oi(t);super(),this.preservePaths=!!s.preservePaths,this.portable=!!s.portable,this.strict=!!s.strict,this.noPax=!!s.noPax,this.noMtime=!!s.noMtime,this.onWriteEntry=s.onWriteEntry,this.readEntry=e;let{type:r}=e;if(r==="Unsupported")throw new Error("writing entry that should be ignored");this.type=r,this.type==="Directory"&&this.portable&&(this.noMtime=!0),this.prefix=s.prefix,this.path=u(e.path),this.mode=e.mode!==void 0?this[Fs](e.mode):void 0,this.uid=this.portable?void 0:e.uid,this.gid=this.portable?void 0:e.gid,this.uname=this.portable?void 0:e.uname,this.gname=this.portable?void 0:e.gname,this.size=e.size,this.mtime=this.noMtime?void 0:s.mtime||e.mtime,this.atime=this.portable?void 0:e.atime,this.ctime=this.portable?void 0:e.ctime,this.linkpath=e.linkpath!==void 0?u(e.linkpath):void 0,typeof s.onwarn=="function"&&this.on("warn",s.onwarn);let n=!1;if(!this.preservePaths){let[a,c]=wi(this.path);a&&typeof c=="string"&&(this.path=c,n=a)}this.remain=e.size,this.blockRemain=e.startBlockSize,this.onWriteEntry?.(this),this.header=new Q({path:this[xe](this.path),linkpath:this.type==="Link"&&this.linkpath!==void 0?this[xe](this.linkpath):this.linkpath,mode:this.mode,uid:this.portable?void 0:this.uid,gid:this.portable?void 0:this.gid,size:this.size,mtime:this.noMtime?void 0:this.mtime,type:this.type,uname:this.portable?void 0:this.uname,atime:this.portable?void 0:this.atime,ctime:this.portable?void 0:this.ctime}),n&&this.warn("TAR_ENTRY_INFO",`stripping ${n} from absolute path`,{entry:this,path:n+this.path}),this.header.encode()&&!this.noPax&&super.write(new Je({atime:this.portable?void 0:this.atime,ctime:this.portable?void 0:this.ctime,gid:this.portable?void 0:this.gid,mtime:this.noMtime?void 0:this.mtime,path:this[xe](this.path),linkpath:this.type==="Link"&&this.linkpath!==void 0?this[xe](this.linkpath):this.linkpath,size:this.size,uid:this.portable?void 0:this.uid,uname:this.portable?void 0:this.uname,dev:this.portable?void 0:this.readEntry.dev,ino:this.portable?void 0:this.readEntry.ino,nlink:this.portable?void 0:this.readEntry.nlink}).encode());let o=this.header?.block;if(!o)throw new Error("failed to encode header");super.write(o),e.pipe(this)}[xe](e){return Vo(e,this.prefix)}[Fs](e){return Hr(e,this.type==="Directory",this.portable)}write(e,t,s){typeof t=="function"&&(s=t,t=void 0),typeof e=="string"&&(e=Buffer.from(e,typeof t=="string"?t:"utf8"));let r=e.length;if(r>this.blockRemain)throw new Error("writing more to entry than is appropriate");return this.blockRemain-=r,super.write(e,s)}end(e,t,s){return this.blockRemain&&super.write(Buffer.alloc(this.blockRemain)),typeof e=="function"&&(s=e,t=void 0,e=void 0),typeof t=="function"&&(s=t,t=void 0),typeof e=="string"&&(e=Buffer.from(e,t??"utf8")),s&&this.once("finish",s),e?super.end(e,s):super.end(s),this}},nl=i=>i.isFile()?"File":i.isDirectory()?"Directory":i.isSymbolicLink()?"SymbolicLink":"Unsupported";var cn=p(require("path"),1);var Ws=class{path;absolute;entry;stat;readdir;pending=!1;ignore=!1;piped=!1;constructor(e,t){this.path=e||"./",this.absolute=t}},Go=Buffer.alloc(1024),Cs=Symbol("onStat"),xi=Symbol("ended"),ue=Symbol("queue"),Vt=Symbol("current"),xt=Symbol("process"),Ri=Symbol("processing"),Ko=Symbol("processJob"),de=Symbol("jobs"),sn=Symbol("jobDone"),Ms=Symbol("addFSEntry"),Zo=Symbol("addTarEntry"),on=Symbol("stat"),an=Symbol("readdir"),Us=Symbol("onreaddir"),Bs=Symbol("pipe"),Yo=Symbol("entry"),rn=Symbol("entryOpt"),zs=Symbol("writeEntryClass"),Xo=Symbol("write"),nn=Symbol("ondrain"),st=class extends we{opt;cwd;maxReadSize;preservePaths;strict;noPax;prefix;linkCache;statCache;file;portable;zip;readdirCache;noDirRecurse;follow;noMtime;mtime;filter;jobs;[zs];onWriteEntry;[ue];[de]=0;[Ri]=!1;[xi]=!1;constructor(e={}){if(super(),this.opt=e,this.file=e.file||"",this.cwd=e.cwd||process.cwd(),this.maxReadSize=e.maxReadSize,this.preservePaths=!!e.preservePaths,this.strict=!!e.strict,this.noPax=!!e.noPax,this.prefix=u(e.prefix||""),this.linkCache=e.linkCache||new Map,this.statCache=e.statCache||new Map,this.readdirCache=e.readdirCache||new Map,this.onWriteEntry=e.onWriteEntry,this[zs]=Ei,typeof e.onwarn=="function"&&this.on("warn",e.onwarn),this.portable=!!e.portable,e.gzip||e.brotli){if(e.gzip&&e.brotli)throw new TypeError("gzip and brotli are mutually exclusive");if(e.gzip&&(typeof e.gzip!="object"&&(e.gzip={}),this.portable&&(e.gzip.portable=!0),this.zip=new hs(e.gzip)),e.brotli&&(typeof e.brotli!="object"&&(e.brotli={}),this.zip=new ds(e.brotli)),!this.zip)throw new Error("impossible");let t=this.zip;t.on("data",s=>super.write(s)),t.on("end",()=>super.end()),t.on("drain",()=>this[nn]()),this.on("resume",()=>t.resume())}else this.on("drain",this[nn]);this.noDirRecurse=!!e.noDirRecurse,this.follow=!!e.follow,this.noMtime=!!e.noMtime,e.mtime&&(this.mtime=e.mtime),this.filter=typeof e.filter=="function"?e.filter:()=>!0,this[ue]=new Bt,this[de]=0,this.jobs=Number(e.jobs)||4,this[Ri]=!1,this[xi]=!1}[Xo](e){return super.write(e)}add(e){return this.write(e),this}end(e,t,s){return typeof e=="function"&&(s=e,e=void 0),typeof t=="function"&&(s=t,t=void 0),e&&this.add(e),this[xi]=!0,this[xt](),s&&s(),this}write(e){if(this[xi])throw new Error("write after end");return e instanceof jt?this[Zo](e):this[Ms](e),this.flowing}[Zo](e){let t=u(cn.default.resolve(this.cwd,e.path));if(!this.filter(e.path,e))e.resume();else{let s=new Ws(e.path,t);s.entry=new Ls(e,this[rn](s)),s.entry.on("end",()=>this[sn](s)),this[de]+=1,this[ue].push(s)}this[xt]()}[Ms](e){let t=u(cn.default.resolve(this.cwd,e));this[ue].push(new Ws(e,t)),this[xt]()}[on](e){e.pending=!0,this[de]+=1;let t=this.follow?"stat":"lstat";$i.default[t](e.absolute,(s,r)=>{e.pending=!1,this[de]-=1,s?this.emit("error",s):this[Cs](e,r)})}[Cs](e,t){this.statCache.set(e.absolute,t),e.stat=t,this.filter(e.path,t)||(e.ignore=!0),this[xt]()}[an](e){e.pending=!0,this[de]+=1,$i.default.readdir(e.absolute,(t,s)=>{if(e.pending=!1,this[de]-=1,t)return this.emit("error",t);this[Us](e,s)})}[Us](e,t){this.readdirCache.set(e.absolute,t),e.readdir=t,this[xt]()}[xt](){if(!this[Ri]){this[Ri]=!0;for(let e=this[ue].head;e&&this[de]<this.jobs;e=e.next)if(this[Ko](e.value),e.value.ignore){let t=e.next;this[ue].removeNode(e),e.next=t}this[Ri]=!1,this[xi]&&!this[ue].length&&this[de]===0&&(this.zip?this.zip.end(Go):(super.write(Go),super.end()))}}get[Vt](){return this[ue]&&this[ue].head&&this[ue].head.value}[sn](e){this[ue].shift(),this[de]-=1,this[xt]()}[Ko](e){if(!e.pending){if(e.entry){e===this[Vt]&&!e.piped&&this[Bs](e);return}if(!e.stat){let t=this.statCache.get(e.absolute);t?this[Cs](e,t):this[on](e)}if(e.stat&&!e.ignore){if(!this.noDirRecurse&&e.stat.isDirectory()&&!e.readdir){let t=this.readdirCache.get(e.absolute);if(t?this[Us](e,t):this[an](e),!e.readdir)return}if(e.entry=this[Yo](e),!e.entry){e.ignore=!0;return}e===this[Vt]&&!e.piped&&this[Bs](e)}}}[rn](e){return{onwarn:(t,s,r)=>this.warn(t,s,r),noPax:this.noPax,cwd:this.cwd,absolute:e.absolute,preservePaths:this.preservePaths,maxReadSize:this.maxReadSize,strict:this.strict,portable:this.portable,linkCache:this.linkCache,statCache:this.statCache,noMtime:this.noMtime,mtime:this.mtime,prefix:this.prefix,onWriteEntry:this.onWriteEntry}}[Yo](e){this[de]+=1;try{return new this[zs](e.path,this[rn](e)).on("end",()=>this[sn](e)).on("error",s=>this.emit("error",s))}catch(t){this.emit("error",t)}}[nn](){this[Vt]&&this[Vt].entry&&this[Vt].entry.resume()}[Bs](e){e.piped=!0,e.readdir&&e.readdir.forEach(r=>{let n=e.path,o=n==="./"?"":n.replace(/\/*$/,"/");this[Ms](o+r)});let t=e.entry,s=this.zip;if(!t)throw new Error("cannot pipe without source");s?t.on("data",r=>{s.write(r)||t.pause()}):t.on("data",r=>{super.write(r)||t.pause()})}pause(){return this.zip&&this.zip.pause(),super.pause()}warn(e,t,s={}){gt(this,e,t,s)}},Rt=class extends st{sync=!0;constructor(e){super(e),this[zs]=Ns}pause(){}resume(){}[on](e){let t=this.follow?"statSync":"lstatSync";this[Cs](e,$i.default[t](e.absolute))}[an](e){this[Us](e,$i.default.readdirSync(e.absolute))}[Bs](e){let t=e.entry,s=this.zip;if(e.readdir&&e.readdir.forEach(r=>{let n=e.path,o=n==="./"?"":n.replace(/\/*$/,"/");this[Ms](o+r)}),!t)throw new Error("Cannot pipe without source");s?t.on("data",r=>{s.write(r)}):t.on("data",r=>{super[Xo](r)})}};var ol=(i,e)=>{let t=new Rt(i),s=new Lt(i.file,{mode:i.mode||438});t.pipe(s),Jo(t,e)},al=(i,e)=>{let t=new st(i),s=new Ie(i.file,{mode:i.mode||438});t.pipe(s);let r=new Promise((n,o)=>{s.on("error",o),s.on("close",n),t.on("error",o)});return qo(t,e),r},Jo=(i,e)=>{e.forEach(t=>{t.charAt(0)==="@"?Et({file:ln.default.resolve(i.cwd,t.slice(1)),sync:!0,noResume:!0,onReadEntry:s=>i.add(s)}):i.add(t)}),i.end()},qo=async(i,e)=>{for(let t=0;t<e.length;t++){let s=String(e[t]);s.charAt(0)==="@"?await Et({file:ln.default.resolve(String(i.cwd),s.slice(1)),noResume:!0,onReadEntry:r=>{i.add(r)}}):i.add(s)}i.end()},cl=(i,e)=>{let t=new Rt(i);return Jo(t,e),t},ll=(i,e)=>{let t=new st(i);return qo(t,e),t},hl=ge(ol,al,cl,ll,(i,e)=>{if(!e?.length)throw new TypeError("no paths specified to add to archive")});var Pn=p(require("node:fs"),1);var ma=p(require("node:assert"),1),In=require("node:crypto"),g=p(require("node:fs"),1),$e=p(require("node:path"),1);var hn=p(require("fs"),1),fl=process.env.__FAKE_PLATFORM__||process.platform,ul=fl==="win32",{O_CREAT:dl,O_TRUNC:ml,O_WRONLY:pl}=hn.default.constants,Qo=Number(process.env.__FAKE_FS_O_FILENAME__)||hn.default.constants.UV_FS_O_FILEMAP||0,gl=ul&&!!Qo,yl=512*1024,bl=Qo|ml|dl|pl,fn=gl?i=>i<yl?bl:"w":()=>"w";var Ti=p(require("node:fs"),1),Gt=p(require("node:path"),1),un=(i,e,t)=>{try{return Ti.default.lchownSync(i,e,t)}catch(s){if(s?.code!=="ENOENT")throw s}},js=(i,e,t,s)=>{Ti.default.lchown(i,e,t,r=>{s(r&&r?.code!=="ENOENT"?r:null)})},wl=(i,e,t,s,r)=>{if(e.isDirectory())dn(Gt.default.resolve(i,e.name),t,s,n=>{if(n)return r(n);let o=Gt.default.resolve(i,e.name);js(o,t,s,r)});else{let n=Gt.default.resolve(i,e.name);js(n,t,s,r)}},dn=(i,e,t,s)=>{Ti.default.readdir(i,{withFileTypes:!0},(r,n)=>{if(r){if(r.code==="ENOENT")return s();if(r.code!=="ENOTDIR"&&r.code!=="ENOTSUP")return s(r)}if(r||!n.length)return js(i,e,t,s);let o=n.length,a=null,c=l=>{if(!a){if(l)return s(a=l);if(--o===0)return js(i,e,t,s)}};for(let l of n)wl(i,l,e,t,c)})},Sl=(i,e,t,s)=>{e.isDirectory()&&mn(Gt.default.resolve(i,e.name),t,s),un(Gt.default.resolve(i,e.name),t,s)},mn=(i,e,t)=>{let s;try{s=Ti.default.readdirSync(i,{withFileTypes:!0})}catch(r){let n=r;if(n?.code==="ENOENT")return;if(n?.code==="ENOTDIR"||n?.code==="ENOTSUP")return un(i,e,t);throw n}for(let r of s)Sl(i,r,e,t);return un(i,e,t)};var te=p(require("fs"),1);var pn=require("path");var rt=require("fs"),re=i=>{if(!i)i={mode:511};else if(typeof i=="object")i={mode:511,...i};else if(typeof i=="number")i={mode:i};else if(typeof i=="string")i={mode:parseInt(i,8)};else throw new TypeError("invalid options argument");let e=i,t=i.fs||{};return i.mkdir=i.mkdir||t.mkdir||rt.mkdir,i.mkdirAsync=i.mkdirAsync?i.mkdirAsync:async(s,r)=>new Promise((n,o)=>e.mkdir(s,r,(a,c)=>a?o(a):n(c))),i.stat=i.stat||t.stat||rt.stat,i.statAsync=i.statAsync?i.statAsync:async s=>new Promise((r,n)=>e.stat(s,(o,a)=>o?n(o):r(a))),i.statSync=i.statSync||t.statSync||rt.statSync,i.mkdirSync=i.mkdirSync||t.mkdirSync||rt.mkdirSync,e};var Re=(i,e,t)=>{let s=(0,pn.dirname)(i),r={...re(e),recursive:!1};if(s===i)try{return r.mkdirSync(i,r)}catch(n){let o=n;if(o&&o.code!=="EISDIR")throw n;return}try{return r.mkdirSync(i,r),t||i}catch(n){let o=n;if(o&&o.code==="ENOENT")return Re(i,r,Re(s,r,t));if(o&&o.code!=="EEXIST"&&o&&o.code!=="EROFS")throw n;try{if(!r.statSync(i).isDirectory())throw n}catch{throw n}}},ze=Object.assign(async(i,e,t)=>{let s=re(e);s.recursive=!1;let r=(0,pn.dirname)(i);return r===i?s.mkdirAsync(i,s).catch(n=>{let o=n;if(o&&o.code!=="EISDIR")throw n}):s.mkdirAsync(i,s).then(()=>t||i,async n=>{let o=n;if(o&&o.code==="ENOENT")return ze(r,s).then(a=>ze(i,s,a));if(o&&o.code!=="EEXIST"&&o.code!=="EROFS")throw n;return s.statAsync(i).then(a=>{if(a.isDirectory())return t;throw n},()=>{throw n})})},{sync:Re});var wn=require("path");var gn=require("path"),yn=async(i,e,t)=>{if(t!==e)return i.statAsync(e).then(s=>s.isDirectory()?t:void 0,s=>{let r=s;return r&&r.code==="ENOENT"?yn(i,(0,gn.dirname)(e),e):void 0})},bn=(i,e,t)=>{if(t!==e)try{return i.statSync(e).isDirectory()?t:void 0}catch(s){let r=s;return r&&r.code==="ENOENT"?bn(i,(0,gn.dirname)(e),e):void 0}};var Kt=(i,e)=>{let t=re(e);if(t.recursive=!0,(0,wn.dirname)(i)===i)return t.mkdirSync(i,t);let r=bn(t,i);try{return t.mkdirSync(i,t),r}catch(n){let o=n;if(o&&o.code==="ENOENT")return Re(i,t);throw n}},ki=Object.assign(async(i,e)=>{let t={...re(e),recursive:!0};return(0,wn.dirname)(i)===i?await t.mkdirAsync(i,t):yn(t,i).then(r=>t.mkdirAsync(i,t).then(n=>r||n).catch(n=>{let o=n;if(o&&o.code==="ENOENT")return ze(i,t);throw n}))},{sync:Kt});var Hs=require("path"),El=process.env.__TESTING_MKDIRP_PLATFORM__||process.platform,Sn=i=>{if(/\0/.test(i))throw Object.assign(new TypeError("path must be a string without null bytes"),{path:i,code:"ERR_INVALID_ARG_VALUE"});if(i=(0,Hs.resolve)(i),El==="win32"){let e=/[*|"<>?:]/,{root:t}=(0,Hs.parse)(i);if(e.test(i.substring(t.length)))throw Object.assign(new Error("Illegal characters in path."),{path:i,code:"EINVAL"})}return i};var Vs=require("fs");var xl=process.env.__TESTING_MKDIRP_NODE_VERSION__||process.version,En=xl.replace(/^v/,"").split("."),ea=+En[0]>10||+En[0]==10&&+En[1]>=12,_i=ea?i=>re(i).mkdirSync===Vs.mkdirSync:()=>!1,Gs=Object.assign(ea?i=>re(i).mkdir===Vs.mkdir:()=>!1,{sync:_i});var Ks=(i,e)=>{i=Sn(i);let t=re(e);return _i(t)?Kt(i,t):Re(i,t)};var ta=Object.assign(async(i,e)=>{i=Sn(i);let t=re(e);return Gs(t)?ki(i,t):ze(i,t)},{mkdirpSync:Ks,mkdirpNative:ki,mkdirpNativeSync:Kt,mkdirpManual:ze,mkdirpManualSync:Re,sync:Ks,native:ki,nativeSync:Kt,manual:ze,manualSync:Re,useNative:Gs,useNativeSync:_i});var Ii=p(require("node:path"),1);var Ai=class extends Error{path;code;syscall="chdir";constructor(e,t){super(`${t}: Cannot cd into '${e}'`),this.path=e,this.code=t}get name(){return"CwdError"}};var Oi=class extends Error{path;symlink;syscall="symlink";code="TAR_SYMLINK_ERROR";constructor(e,t){super("TAR_SYMLINK_ERROR: Cannot extract through symbolic link"),this.symlink=e,this.path=t}get name(){return"SymlinkError"}};var Zs=(i,e)=>i.get(u(e)),vi=(i,e,t)=>i.set(u(e),t),Rl=(i,e)=>{te.default.stat(i,(t,s)=>{(t||!s.isDirectory())&&(t=new Ai(i,t?.code||"ENOTDIR")),e(t)})},ia=(i,e,t)=>{i=u(i);let s=e.umask??18,r=e.mode|448,n=(r&s)!==0,o=e.uid,a=e.gid,c=typeof o=="number"&&typeof a=="number"&&(o!==e.processUid||a!==e.processGid),l=e.preserve,f=e.unlink,h=e.cache,m=u(e.cwd),E=(U,k)=>{U?t(U):(vi(h,i,!0),k&&c?dn(k,o,a,Zn=>E(Zn)):n?te.default.chmod(i,r,t):t())};if(h&&Zs(h,i)===!0)return E();if(i===m)return Rl(i,E);if(l)return ta(i,{mode:r}).then(U=>E(null,U??void 0),E);let S=u(Ii.default.relative(m,i)).split("/");Ys(m,S,r,h,f,m,void 0,E)},Ys=(i,e,t,s,r,n,o,a)=>{if(!e.length)return a(null,o);let c=e.shift(),l=u(Ii.default.resolve(i+"/"+c));if(Zs(s,l))return Ys(l,e,t,s,r,n,o,a);te.default.mkdir(l,t,sa(l,e,t,s,r,n,o,a))},sa=(i,e,t,s,r,n,o,a)=>c=>{c?te.default.lstat(i,(l,f)=>{if(l)l.path=l.path&&u(l.path),a(l);else if(f.isDirectory())Ys(i,e,t,s,r,n,o,a);else if(r)te.default.unlink(i,h=>{if(h)return a(h);te.default.mkdir(i,t,sa(i,e,t,s,r,n,o,a))});else{if(f.isSymbolicLink())return a(new Oi(i,i+"/"+e.join("/")));a(c)}}):(o=o||i,Ys(i,e,t,s,r,n,o,a))},$l=i=>{let e=!1,t;try{e=te.default.statSync(i).isDirectory()}catch(s){t=s?.code}finally{if(!e)throw new Ai(i,t??"ENOTDIR")}},ra=(i,e)=>{i=u(i);let t=e.umask??18,s=e.mode|448,r=(s&t)!==0,n=e.uid,o=e.gid,a=typeof n=="number"&&typeof o=="number"&&(n!==e.processUid||o!==e.processGid),c=e.preserve,l=e.unlink,f=e.cache,h=u(e.cwd),m=U=>{vi(f,i,!0),U&&a&&mn(U,n,o),r&&te.default.chmodSync(i,s)};if(f&&Zs(f,i)===!0)return m();if(i===h)return $l(h),m();if(c)return m(Ks(i,s)??void 0);let T=u(Ii.default.relative(h,i)).split("/"),S;for(let U=T.shift(),k=h;U&&(k+="/"+U);U=T.shift())if(k=u(Ii.default.resolve(k)),!Zs(f,k))try{te.default.mkdirSync(k,s),S=S||k,vi(f,k,!0)}catch{let Yn=te.default.lstatSync(k);if(Yn.isDirectory()){vi(f,k,!0);continue}else if(l){te.default.unlinkSync(k),te.default.mkdirSync(k,s),S=S||k,vi(f,k,!0);continue}else if(Yn.isSymbolicLink())return new Oi(k,k+"/"+T.join("/"))}return m(S)};var xn=Object.create(null),{hasOwnProperty:Tl}=Object.prototype,Xs=i=>(Tl.call(xn,i)||(xn[i]=i.normalize("NFD")),xn[i]);var Rn=require("node:path");var kl=process.env.TESTING_TAR_FAKE_PLATFORM||process.platform,_l=kl==="win32",Al=i=>i.split("/").slice(0,-1).reduce((t,s)=>{let r=t[t.length-1];return r!==void 0&&(s=(0,Rn.join)(r,s)),t.push(s||"/"),t},[]),Js=class{#e=new Map;#s=new Map;#t=new Set;reserve(e,t){e=_l?["win32 parallelization disabled"]:e.map(r=>Ee((0,Rn.join)(Xs(r))).toLowerCase());let s=new Set(e.map(r=>Al(r)).reduce((r,n)=>r.concat(n)));this.#s.set(t,{dirs:s,paths:e});for(let r of e){let n=this.#e.get(r);n?n.push(t):this.#e.set(r,[t])}for(let r of s){let n=this.#e.get(r);if(!n)this.#e.set(r,[new Set([t])]);else{let o=n[n.length-1];o instanceof Set?o.add(t):n.push(new Set([t]))}}return this.#n(t)}#o(e){let t=this.#s.get(e);if(!t)throw new Error("function does not have any path reservations");return{paths:t.paths.map(s=>this.#e.get(s)),dirs:[...t.dirs].map(s=>this.#e.get(s))}}check(e){let{paths:t,dirs:s}=this.#o(e);return t.every(r=>r&&r[0]===e)&&s.every(r=>r&&r[0]instanceof Set&&r[0].has(e))}#n(e){return this.#t.has(e)||!this.check(e)?!1:(this.#t.add(e),e(()=>this.#i(e)),!0)}#i(e){if(!this.#t.has(e))return!1;let t=this.#s.get(e);if(!t)throw new Error("invalid reservation");let{paths:s,dirs:r}=t,n=new Set;for(let o of s){let a=this.#e.get(o);if(!a||a?.[0]!==e)continue;let c=a[1];if(!c){this.#e.delete(o);continue}if(a.shift(),typeof c=="function")n.add(c);else for(let l of c)n.add(l)}for(let o of r){let a=this.#e.get(o),c=a?.[0];if(!(!a||!(c instanceof Set)))if(c.size===1&&a.length===1){this.#e.delete(o);continue}else if(c.size===1){a.shift();let l=a[0];typeof l=="function"&&n.add(l)}else c.delete(e)}return this.#t.delete(e),n.forEach(o=>this.#n(o)),!0}};var na=Symbol("onEntry"),kn=Symbol("checkFs"),oa=Symbol("checkFs2"),er=Symbol("pruneCache"),_n=Symbol("isReusable"),ne=Symbol("makeFs"),An=Symbol("file"),On=Symbol("directory"),tr=Symbol("link"),aa=Symbol("symlink"),ca=Symbol("hardlink"),la=Symbol("unsupported"),ha=Symbol("checkPath"),nt=Symbol("mkdir"),j=Symbol("onError"),qs=Symbol("pending"),fa=Symbol("pend"),Zt=Symbol("unpend"),$n=Symbol("ended"),Tn=Symbol("maybeClose"),vn=Symbol("skip"),Pi=Symbol("doChown"),Di=Symbol("uid"),Fi=Symbol("gid"),Ni=Symbol("checkedCwd"),Ol=process.env.TESTING_TAR_FAKE_PLATFORM||process.platform,Li=Ol==="win32",vl=1024,Il=(i,e)=>{if(!Li)return g.default.unlink(i,e);let t=i+".DELETE."+(0,In.randomBytes)(16).toString("hex");g.default.rename(i,t,s=>{if(s)return e(s);g.default.unlink(t,e)})},Pl=i=>{if(!Li)return g.default.unlinkSync(i);let e=i+".DELETE."+(0,In.randomBytes)(16).toString("hex");g.default.renameSync(i,e),g.default.unlinkSync(e)},ua=(i,e,t)=>i!==void 0&&i===i>>>0?i:e!==void 0&&e===e>>>0?e:t,da=i=>Ee(u(Xs(i))).toLowerCase(),Dl=(i,e)=>{e=da(e);for(let t of i.keys()){let s=da(t);(s===e||s.indexOf(e+"/")===0)&&i.delete(t)}},Fl=i=>{for(let e of i.keys())i.delete(e)},Yt=class extends Be{[$n]=!1;[Ni]=!1;[qs]=0;reservations=new Js;transform;writable=!0;readable=!1;dirCache;uid;gid;setOwner;preserveOwner;processGid;processUid;maxDepth;forceChown;win32;newer;keep;noMtime;preservePaths;unlink;cwd;strip;processUmask;umask;dmode;fmode;chmod;constructor(e={}){if(e.ondone=()=>{this[$n]=!0,this[Tn]()},super(e),this.transform=e.transform,this.dirCache=e.dirCache||new Map,this.chmod=!!e.chmod,typeof e.uid=="number"||typeof e.gid=="number"){if(typeof e.uid!="number"||typeof e.gid!="number")throw new TypeError("cannot set owner without number uid and gid");if(e.preserveOwner)throw new TypeError("cannot preserve owner in archive and also set owner explicitly");this.uid=e.uid,this.gid=e.gid,this.setOwner=!0}else this.uid=void 0,this.gid=void 0,this.setOwner=!1;e.preserveOwner===void 0&&typeof e.uid!="number"?this.preserveOwner=!!(process.getuid&&process.getuid()===0):this.preserveOwner=!!e.preserveOwner,this.processUid=(this.preserveOwner||this.setOwner)&&process.getuid?process.getuid():void 0,this.processGid=(this.preserveOwner||this.setOwner)&&process.getgid?process.getgid():void 0,this.maxDepth=typeof e.maxDepth=="number"?e.maxDepth:vl,this.forceChown=e.forceChown===!0,this.win32=!!e.win32||Li,this.newer=!!e.newer,this.keep=!!e.keep,this.noMtime=!!e.noMtime,this.preservePaths=!!e.preservePaths,this.unlink=!!e.unlink,this.cwd=u($e.default.resolve(e.cwd||process.cwd())),this.strip=Number(e.strip)||0,this.processUmask=this.chmod?typeof e.processUmask=="number"?e.processUmask:process.umask():0,this.umask=typeof e.umask=="number"?e.umask:this.processUmask,this.dmode=e.dmode||511&~this.umask,this.fmode=e.fmode||438&~this.umask,this.on("entry",t=>this[na](t))}warn(e,t,s={}){return(e==="TAR_BAD_ARCHIVE"||e==="TAR_ABORT")&&(s.recoverable=!1),super.warn(e,t,s)}[Tn](){this[$n]&&this[qs]===0&&(this.emit("prefinish"),this.emit("finish"),this.emit("end"))}[ha](e){let t=u(e.path),s=t.split("/");if(this.strip){if(s.length<this.strip)return!1;if(e.type==="Link"){let r=u(String(e.linkpath)).split("/");if(r.length>=this.strip)e.linkpath=r.slice(this.strip).join("/");else return!1}s.splice(0,this.strip),e.path=s.join("/")}if(isFinite(this.maxDepth)&&s.length>this.maxDepth)return this.warn("TAR_ENTRY_ERROR","path excessively deep",{entry:e,path:t,depth:s.length,maxDepth:this.maxDepth}),!1;if(!this.preservePaths){if(s.includes("..")||Li&&/^[a-z]:\.\.$/i.test(s[0]??""))return this.warn("TAR_ENTRY_ERROR","path contains '..'",{entry:e,path:t}),!1;let[r,n]=wi(t);r&&(e.path=String(n),this.warn("TAR_ENTRY_INFO",`stripping ${r} from absolute path`,{entry:e,path:t}))}if($e.default.isAbsolute(e.path)?e.absolute=u($e.default.resolve(e.path)):e.absolute=u($e.default.resolve(this.cwd,e.path)),!this.preservePaths&&typeof e.absolute=="string"&&e.absolute.indexOf(this.cwd+"/")!==0&&e.absolute!==this.cwd)return this.warn("TAR_ENTRY_ERROR","path escaped extraction target",{entry:e,path:u(e.path),resolvedPath:e.absolute,cwd:this.cwd}),!1;if(e.absolute===this.cwd&&e.type!=="Directory"&&e.type!=="GNUDumpDir")return!1;if(this.win32){let{root:r}=$e.default.win32.parse(String(e.absolute));e.absolute=r+Gr(String(e.absolute).slice(r.length));let{root:n}=$e.default.win32.parse(e.path);e.path=n+Gr(e.path.slice(n.length))}return!0}[na](e){if(!this[ha](e))return e.resume();switch(ma.default.equal(typeof e.absolute,"string"),e.type){case"Directory":case"GNUDumpDir":e.mode&&(e.mode=e.mode|448);case"File":case"OldFile":case"ContiguousFile":case"Link":case"SymbolicLink":return this[kn](e);case"CharacterDevice":case"BlockDevice":case"FIFO":default:return this[la](e)}}[j](e,t){e.name==="CwdError"?this.emit("error",e):(this.warn("TAR_ENTRY_ERROR",e,{entry:t}),this[Zt](),t.resume())}[nt](e,t,s){ia(u(e),{uid:this.uid,gid:this.gid,processUid:this.processUid,processGid:this.processGid,umask:this.processUmask,preserve:this.preservePaths,unlink:this.unlink,cache:this.dirCache,cwd:this.cwd,mode:t},s)}[Pi](e){return this.forceChown||this.preserveOwner&&(typeof e.uid=="number"&&e.uid!==this.processUid||typeof e.gid=="number"&&e.gid!==this.processGid)||typeof this.uid=="number"&&this.uid!==this.processUid||typeof this.gid=="number"&&this.gid!==this.processGid}[Di](e){return ua(this.uid,e.uid,this.processUid)}[Fi](e){return ua(this.gid,e.gid,this.processGid)}[An](e,t){let s=typeof e.mode=="number"?e.mode&4095:this.fmode,r=new Ie(String(e.absolute),{flags:fn(e.size),mode:s,autoClose:!1});r.on("error",c=>{r.fd&&g.default.close(r.fd,()=>{}),r.write=()=>!0,this[j](c,e),t()});let n=1,o=c=>{if(c){r.fd&&g.default.close(r.fd,()=>{}),this[j](c,e),t();return}--n===0&&r.fd!==void 0&&g.default.close(r.fd,l=>{l?this[j](l,e):this[Zt](),t()})};r.on("finish",()=>{let c=String(e.absolute),l=r.fd;if(typeof l=="number"&&e.mtime&&!this.noMtime){n++;let f=e.atime||new Date,h=e.mtime;g.default.futimes(l,f,h,m=>m?g.default.utimes(c,f,h,E=>o(E&&m)):o())}if(typeof l=="number"&&this[Pi](e)){n++;let f=this[Di](e),h=this[Fi](e);typeof f=="number"&&typeof h=="number"&&g.default.fchown(l,f,h,m=>m?g.default.chown(c,f,h,E=>o(E&&m)):o())}o()});let a=this.transform&&this.transform(e)||e;a!==e&&(a.on("error",c=>{this[j](c,e),t()}),e.pipe(a)),a.pipe(r)}[On](e,t){let s=typeof e.mode=="number"?e.mode&4095:this.dmode;this[nt](String(e.absolute),s,r=>{if(r){this[j](r,e),t();return}let n=1,o=()=>{--n===0&&(t(),this[Zt](),e.resume())};e.mtime&&!this.noMtime&&(n++,g.default.utimes(String(e.absolute),e.atime||new Date,e.mtime,o)),this[Pi](e)&&(n++,g.default.chown(String(e.absolute),Number(this[Di](e)),Number(this[Fi](e)),o)),o()})}[la](e){e.unsupported=!0,this.warn("TAR_ENTRY_UNSUPPORTED",`unsupported entry type: ${e.type}`,{entry:e}),e.resume()}[aa](e,t){this[tr](e,String(e.linkpath),"symlink",t)}[ca](e,t){let s=u($e.default.resolve(this.cwd,String(e.linkpath)));this[tr](e,s,"link",t)}[fa](){this[qs]++}[Zt](){this[qs]--,this[Tn]()}[vn](e){this[Zt](),e.resume()}[_n](e,t){return e.type==="File"&&!this.unlink&&t.isFile()&&t.nlink<=1&&!Li}[kn](e){this[fa]();let t=[e.path];e.linkpath&&t.push(e.linkpath),this.reservations.reserve(t,s=>this[oa](e,s))}[er](e){e.type==="SymbolicLink"?Fl(this.dirCache):e.type!=="Directory"&&Dl(this.dirCache,String(e.absolute))}[oa](e,t){this[er](e);let s=a=>{this[er](e),t(a)},r=()=>{this[nt](this.cwd,this.dmode,a=>{if(a){this[j](a,e),s();return}this[Ni]=!0,n()})},n=()=>{if(e.absolute!==this.cwd){let a=u($e.default.dirname(String(e.absolute)));if(a!==this.cwd)return this[nt](a,this.dmode,c=>{if(c){this[j](c,e),s();return}o()})}o()},o=()=>{g.default.lstat(String(e.absolute),(a,c)=>{if(c&&(this.keep||this.newer&&c.mtime>(e.mtime??c.mtime))){this[vn](e),s();return}if(a||this[_n](e,c))return this[ne](null,e,s);if(c.isDirectory()){if(e.type==="Directory"){let l=this.chmod&&e.mode&&(c.mode&4095)!==e.mode,f=h=>this[ne](h??null,e,s);return l?g.default.chmod(String(e.absolute),Number(e.mode),f):f()}if(e.absolute!==this.cwd)return g.default.rmdir(String(e.absolute),l=>this[ne](l??null,e,s))}if(e.absolute===this.cwd)return this[ne](null,e,s);Il(String(e.absolute),l=>this[ne](l??null,e,s))})};this[Ni]?n():r()}[ne](e,t,s){if(e){this[j](e,t),s();return}switch(t.type){case"File":case"OldFile":case"ContiguousFile":return this[An](t,s);case"Link":return this[ca](t,s);case"SymbolicLink":return this[aa](t,s);case"Directory":case"GNUDumpDir":return this[On](t,s)}}[tr](e,t,s,r){g.default[s](t,String(e.absolute),n=>{n?this[j](n,e):(this[Zt](),e.resume()),r()})}},Qs=i=>{try{return[null,i()]}catch(e){return[e,null]}},Ci=class extends Yt{sync=!0;[ne](e,t){return super[ne](e,t,()=>{})}[kn](e){if(this[er](e),!this[Ni]){let n=this[nt](this.cwd,this.dmode);if(n)return this[j](n,e);this[Ni]=!0}if(e.absolute!==this.cwd){let n=u($e.default.dirname(String(e.absolute)));if(n!==this.cwd){let o=this[nt](n,this.dmode);if(o)return this[j](o,e)}}let[t,s]=Qs(()=>g.default.lstatSync(String(e.absolute)));if(s&&(this.keep||this.newer&&s.mtime>(e.mtime??s.mtime)))return this[vn](e);if(t||this[_n](e,s))return this[ne](null,e);if(s.isDirectory()){if(e.type==="Directory"){let o=this.chmod&&e.mode&&(s.mode&4095)!==e.mode,[a]=o?Qs(()=>{g.default.chmodSync(String(e.absolute),Number(e.mode))}):[];return this[ne](a,e)}let[n]=Qs(()=>g.default.rmdirSync(String(e.absolute)));this[ne](n,e)}let[r]=e.absolute===this.cwd?[]:Qs(()=>Pl(String(e.absolute)));this[ne](r,e)}[An](e,t){let s=typeof e.mode=="number"?e.mode&4095:this.fmode,r=a=>{let c;try{g.default.closeSync(n)}catch(l){c=l}(a||c)&&this[j](a||c,e),t()},n;try{n=g.default.openSync(String(e.absolute),fn(e.size),s)}catch(a){return r(a)}let o=this.transform&&this.transform(e)||e;o!==e&&(o.on("error",a=>this[j](a,e)),e.pipe(o)),o.on("data",a=>{try{g.default.writeSync(n,a,0,a.length)}catch(c){r(c)}}),o.on("end",()=>{let a=null;if(e.mtime&&!this.noMtime){let c=e.atime||new Date,l=e.mtime;try{g.default.futimesSync(n,c,l)}catch(f){try{g.default.utimesSync(String(e.absolute),c,l)}catch{a=f}}}if(this[Pi](e)){let c=this[Di](e),l=this[Fi](e);try{g.default.fchownSync(n,Number(c),Number(l))}catch(f){try{g.default.chownSync(String(e.absolute),Number(c),Number(l))}catch{a=a||f}}}r(a)})}[On](e,t){let s=typeof e.mode=="number"?e.mode&4095:this.dmode,r=this[nt](String(e.absolute),s);if(r){this[j](r,e),t();return}if(e.mtime&&!this.noMtime)try{g.default.utimesSync(String(e.absolute),e.atime||new Date,e.mtime)}catch{}if(this[Pi](e))try{g.default.chownSync(String(e.absolute),Number(this[Di](e)),Number(this[Fi](e)))}catch{}t(),e.resume()}[nt](e,t){try{return ra(u(e),{uid:this.uid,gid:this.gid,processUid:this.processUid,processGid:this.processGid,umask:this.processUmask,preserve:this.preservePaths,unlink:this.unlink,cache:this.dirCache,cwd:this.cwd,mode:t})}catch(s){return s}}[tr](e,t,s,r){let n=`${s}Sync`;try{g.default[n](t,String(e.absolute)),r(),e.resume()}catch(o){return this[j](o,e)}}};var Nl=i=>{let e=new Ci(i),t=i.file,s=Pn.default.statSync(t),r=i.maxReadSize||16*1024*1024;new Qi(t,{readSize:r,size:s.size}).pipe(e)},Ll=(i,e)=>{let t=new Yt(i),s=i.maxReadSize||16*1024*1024,r=i.file;return new Promise((o,a)=>{t.on("error",a),t.on("close",o),Pn.default.stat(r,(c,l)=>{if(c)a(c);else{let f=new lt(r,{readSize:s,size:l.size});f.on("error",a),f.pipe(t)}})})},Dn=ge(Nl,Ll,i=>new Ci(i),i=>new Yt(i),(i,e)=>{e?.length&&jr(i,e)});var Y=p(require("node:fs"),1),Fn=p(require("node:path"),1);var Cl=(i,e)=>{let t=new Rt(i),s=!0,r,n;try{try{r=Y.default.openSync(i.file,"r+")}catch(c){if(c?.code==="ENOENT")r=Y.default.openSync(i.file,"w+");else throw c}let o=Y.default.fstatSync(r),a=Buffer.alloc(512);e:for(n=0;n<o.size;n+=512){for(let f=0,h=0;f<512;f+=h){if(h=Y.default.readSync(r,a,f,a.length-f,n+f),n===0&&a[0]===31&&a[1]===139)throw new Error("cannot append to compressed archives");if(!h)break e}let c=new Q(a);if(!c.cksumValid)break;let l=512*Math.ceil((c.size||0)/512);if(n+l+512>o.size)break;n+=l,i.mtimeCache&&c.mtime&&i.mtimeCache.set(String(c.path),c.mtime)}s=!1,Ml(i,t,n,r,e)}finally{if(s)try{Y.default.closeSync(r)}catch{}}},Ml=(i,e,t,s,r)=>{let n=new Lt(i.file,{fd:s,start:t});e.pipe(n),Bl(e,r)},Ul=(i,e)=>{e=Array.from(e);let t=new st(i),s=(n,o,a)=>{let c=(E,T)=>{E?Y.default.close(n,S=>a(E)):a(null,T)},l=0;if(o===0)return c(null,0);let f=0,h=Buffer.alloc(512),m=(E,T)=>{if(E||typeof T>"u")return c(E);if(f+=T,f<512&&T)return Y.default.read(n,h,f,h.length-f,l+f,m);if(l===0&&h[0]===31&&h[1]===139)return c(new Error("cannot append to compressed archives"));if(f<512)return c(null,l);let S=new Q(h);if(!S.cksumValid)return c(null,l);let U=512*Math.ceil((S.size??0)/512);if(l+U+512>o||(l+=U+512,l>=o))return c(null,l);i.mtimeCache&&S.mtime&&i.mtimeCache.set(String(S.path),S.mtime),f=0,Y.default.read(n,h,0,512,l,m)};Y.default.read(n,h,0,512,l,m)};return new Promise((n,o)=>{t.on("error",o);let a="r+",c=(l,f)=>{if(l&&l.code==="ENOENT"&&a==="r+")return a="w+",Y.default.open(i.file,a,c);if(l||!f)return o(l);Y.default.fstat(f,(h,m)=>{if(h)return Y.default.close(f,()=>o(h));s(f,m.size,(E,T)=>{if(E)return o(E);let S=new Ie(i.file,{fd:f,start:T});t.pipe(S),S.on("error",o),S.on("close",n),zl(t,e)})})};Y.default.open(i.file,a,c)})},Bl=(i,e)=>{e.forEach(t=>{t.charAt(0)==="@"?Et({file:Fn.default.resolve(i.cwd,t.slice(1)),sync:!0,noResume:!0,onReadEntry:s=>i.add(s)}):i.add(t)}),i.end()},zl=async(i,e)=>{for(let t=0;t<e.length;t++){let s=String(e[t]);s.charAt(0)==="@"?await Et({file:Fn.default.resolve(String(i.cwd),s.slice(1)),noResume:!0,onReadEntry:r=>i.add(r)}):i.add(s)}i.end()},$t=ge(Cl,Ul,()=>{throw new TypeError("file is required")},()=>{throw new TypeError("file is required")},(i,e)=>{if(!lo(i))throw new TypeError("file is required");if(i.gzip||i.brotli||i.file.endsWith(".br")||i.file.endsWith(".tbr"))throw new TypeError("cannot append to compressed archives");if(!e?.length)throw new TypeError("no paths specified to add/replace")});var Wl=ge($t.syncFile,$t.asyncFile,$t.syncNoFile,$t.asyncNoFile,(i,e=[])=>{$t.validate?.(i,e),jl(i)}),jl=i=>{let e=i.filter;i.mtimeCache||(i.mtimeCache=new Map),i.filter=e?(t,s)=>e(t,s)&&!((i.mtimeCache?.get(t)??s.mtime??0)>(s.mtime??0)):(t,s)=>!((i.mtimeCache?.get(t)??s.mtime??0)>(s.mtime??0))};var Ot=require("@raycast/api");var je=require("child_process"),M=p(require("fs")),Te=p(require("os")),C=p(require("path")),d=require("@raycast/api");var Tt=p(require("react")),H=require("@raycast/api");var ba=p(require("node:child_process")),wa=require("node:buffer"),Xt=p(require("node:stream")),Sa=require("node:util");var Ea=require("react/jsx-runtime");var Nn=globalThis;var ir=i=>!!i&&typeof i=="object"&&typeof i.removeListener=="function"&&typeof i.emit=="function"&&typeof i.reallyExit=="function"&&typeof i.listeners=="function"&&typeof i.kill=="function"&&typeof i.pid=="number"&&typeof i.on=="function",Ln=Symbol.for("signal-exit emitter"),Mn=class{constructor(){if(this.emitted={afterExit:!1,exit:!1},this.listeners={afterExit:[],exit:[]},this.count=0,this.id=Math.random(),Nn[Ln])return Nn[Ln];Object.defineProperty(Nn,Ln,{value:this,writable:!1,enumerable:!1,configurable:!1})}on(e,t){this.listeners[e].push(t)}removeListener(e,t){let s=this.listeners[e],r=s.indexOf(t);r!==-1&&(r===0&&s.length===1?s.length=0:s.splice(r,1))}emit(e,t,s){if(this.emitted[e])return!1;this.emitted[e]=!0;let r=!1;for(let n of this.listeners[e])r=n(t,s)===!0||r;return e==="exit"&&(r=this.emit("afterExit",t,s)||r),r}},Un=class{onExit(){return()=>{}}load(){}unload(){}},Bn=class{#e;#s;#t;#o;#n;#i;#r;#a;constructor(e){this.#e=process.platform==="win32"?"SIGINT":"SIGHUP",this.#s=new Mn,this.#i={},this.#r=!1,this.#a=[],this.#a.push("SIGHUP","SIGINT","SIGTERM"),globalThis.process.platform!=="win32"&&this.#a.push("SIGALRM","SIGABRT","SIGVTALRM","SIGXCPU","SIGXFSZ","SIGUSR2","SIGTRAP","SIGSYS","SIGQUIT","SIGIOT"),globalThis.process.platform==="linux"&&this.#a.push("SIGIO","SIGPOLL","SIGPWR","SIGSTKFLT"),this.#t=e,this.#i={};for(let t of this.#a)this.#i[t]=()=>{let s=this.#t.listeners(t),{count:r}=this.#s,n=e;if(typeof n.__signal_exit_emitter__=="object"&&typeof n.__signal_exit_emitter__.count=="number"&&(r+=n.__signal_exit_emitter__.count),s.length===r){this.unload();let o=this.#s.emit("exit",null,t),a=t==="SIGHUP"?this.#e:t;o||e.kill(e.pid,a)}};this.#n=e.reallyExit,this.#o=e.emit}onExit(e,t){if(!ir(this.#t))return()=>{};this.#r===!1&&this.load();let s=t?.alwaysLast?"afterExit":"exit";return this.#s.on(s,e),()=>{this.#s.removeListener(s,e),this.#s.listeners.exit.length===0&&this.#s.listeners.afterExit.length===0&&this.unload()}}load(){if(!this.#r){this.#r=!0,this.#s.count+=1;for(let e of this.#a)try{let t=this.#i[e];t&&this.#t.on(e,t)}catch{}this.#t.emit=(e,...t)=>this.#l(e,...t),this.#t.reallyExit=e=>this.#c(e)}}unload(){this.#r&&(this.#r=!1,this.#a.forEach(e=>{let t=this.#i[e];if(!t)throw new Error("Listener not defined for signal: "+e);try{this.#t.removeListener(e,t)}catch{}}),this.#t.emit=this.#o,this.#t.reallyExit=this.#n,this.#s.count-=1)}#c(e){return ir(this.#t)?(this.#t.exitCode=e||0,this.#s.emit("exit",this.#t.exitCode,null),this.#n.call(this.#t,this.#t.exitCode)):0}#l(e,...t){let s=this.#o;if(e==="exit"&&ir(this.#t)){typeof t[0]=="number"&&(this.#t.exitCode=t[0]);let r=s.call(this.#t,e,...t);return this.#s.emit("exit",this.#t.exitCode,null),r}else return s.call(this.#t,e,...t)}},Cn=null,Vl=(i,e)=>(Cn||(Cn=ir(process)?new Bn(process):new Un),Cn.onExit(i,e));function Gl(i,{timeout:e}={}){let t=new Promise((a,c)=>{i.on("exit",(l,f)=>{a({exitCode:l,signal:f,timedOut:!1})}),i.on("error",l=>{c(l)}),i.stdin&&i.stdin.on("error",l=>{c(l)})}),s=Vl(()=>{i.kill()});if(e===0||e===void 0)return t.finally(()=>s());let r,n=new Promise((a,c)=>{r=setTimeout(()=>{i.kill("SIGTERM"),c(Object.assign(new Error("Timed out"),{timedOut:!0,signal:"SIGTERM"}))},e)}),o=t.finally(()=>{clearTimeout(r)});return Promise.race([n,o]).finally(()=>s())}var zn=class extends Error{constructor(){super("The output is too big"),this.name="MaxBufferError"}};function Kl(i){let{encoding:e}=i,t=e==="buffer",s=new Xt.default.PassThrough({objectMode:!1});e&&e!=="buffer"&&s.setEncoding(e);let r=0,n=[];return s.on("data",o=>{n.push(o),r+=o.length}),s.getBufferedValue=()=>t?Buffer.concat(n,r):n.join(""),s.getBufferedLength=()=>r,s}async function pa(i,e){let t=Kl(e);return await new Promise((s,r)=>{let n=o=>{o&&t.getBufferedLength()<=wa.constants.MAX_LENGTH&&(o.bufferedData=t.getBufferedValue()),r(o)};(async()=>{try{await(0,Sa.promisify)(Xt.default.pipeline)(i,t),s()}catch(o){n(o)}})(),t.on("data",()=>{t.getBufferedLength()>8e7&&n(new zn)})}),t.getBufferedValue()}async function ga(i,e){i.destroy();try{return await e}catch(t){return t.bufferedData}}async function Zl({stdout:i,stderr:e},{encoding:t},s){let r=pa(i,{encoding:t}),n=pa(e,{encoding:t});try{return await Promise.all([s,r,n])}catch(o){return Promise.all([{error:o,exitCode:null,signal:o.signal,timedOut:o.timedOut||!1},ga(i,r),ga(e,n)])}}function Yl(i){let e=typeof i=="string"?`
`:10,t=typeof i=="string"?"\r":13;return i[i.length-1]===e&&(i=i.slice(0,-1)),i[i.length-1]===t&&(i=i.slice(0,-1)),i}function ya(i,e){return i.stripFinalNewline?Yl(e):e}function Xl({timedOut:i,timeout:e,signal:t,exitCode:s}){return i?`timed out after ${e} milliseconds`:t!=null?`was killed with ${t}`:s!=null?`failed with exit code ${s}`:"failed"}function Jl({stdout:i,stderr:e,error:t,signal:s,exitCode:r,command:n,timedOut:o,options:a,parentError:c}){let f=`Command ${Xl({timedOut:o,timeout:a?.timeout,signal:s,exitCode:r})}: ${n}`,h=t?`${f}
${t.message}`:f,m=[h,e,i].filter(Boolean).join(`
`);return t?t.originalMessage=t.message:t=c,t.message=m,t.shortMessage=h,t.command=n,t.exitCode=r,t.signal=s,t.stdout=i,t.stderr=e,"bufferedData"in t&&delete t.bufferedData,t}function ql({stdout:i,stderr:e,error:t,exitCode:s,signal:r,timedOut:n,command:o,options:a,parentError:c}){if(t||s!==0||r!==null)throw Jl({error:t,exitCode:s,signal:r,stdout:i,stderr:e,command:o,timedOut:n,options:a,parentError:c});return i}async function We(i,e,t){if(process.platform!=="darwin")throw new Error("AppleScript is only supported on macOS");let{humanReadableOutput:s,language:r,timeout:n,...o}=Array.isArray(e)?t||{}:e||{},a=s!==!1?[]:["-ss"];r==="JavaScript"&&a.push("-l","JavaScript"),Array.isArray(e)&&a.push("-",...e);let c=ba.default.spawn("osascript",a,{...o,env:{PATH:"/usr/local/bin:/usr/bin:/bin:/usr/sbin:/sbin"}}),l=Gl(c,{timeout:n??1e4});c.stdin.end(i);let[{error:f,exitCode:h,signal:m,timedOut:E},T,S]=await Zl(c,{encoding:"utf8"},l),U=ya({stripFinalNewline:!0},T),k=ya({stripFinalNewline:!0},S);return ql({stdout:U,stderr:k,error:f,exitCode:h,signal:m,timedOut:E,command:"osascript",options:t,parentError:new Error})}var Jt=require("child_process"),X=require("@raycast/api");var xa=require("fs");async function Ql(){let i="";try{i=(0,Jt.execSync)(`/bin/zsh -lc 'realpath "$(which brew)"'`).toString().trim()}catch(e){console.error(e)}if(i==="")return await(0,X.showToast)({title:"Homebrew is required to install the AVIF encoder.",message:"Please install Homebrew and try again. Visit https://brew.sh for more information. Once Homebrew is installed, run the command `brew install libavif` to install the AVIF encoder manually (Otherwise, this command will be run automatically).",style:X.Toast.Style.Failure}),!1;if(await(0,X.confirmAlert)({title:"Install AVIF Encoder",message:"The libavif Homebrew formula is required to convert images to/from AVIF format. Would you like to install it now?",primaryAction:{title:"Install"}})){let e=await(0,X.showToast)({title:"Installing AVIF Encoder...",style:X.Toast.Style.Animated});try{if((0,Jt.execSync)(`/bin/zsh -ilc '${i} install --quiet libavif || true'`),!eh())throw new Error("The avifenc binary has not been added to the user's $PATH");return e.title="AVIF Encoder installed successfully!",e.style=X.Toast.Style.Success,!0}catch(t){console.error(t),ie("Failed to install AVIF Encoder.",t,e,"If you previously attempted to install libavif or avifenc, please run `brew doctor` followed by `brew cleanup` and try again.")}}return await(0,X.showToast)({title:"AVIF Encoder not installed.",style:X.Toast.Style.Failure}),!1}async function eh(){let t=!1,s=0;for(;!t&&s<7;){let r=(0,Jt.execSync)("/bin/zsh -lc 'command -v avifenc'").toString().trim();if((0,xa.existsSync)(r)){t=!0;break}await new Promise(n=>setTimeout(n,1e3)),s++}return t}async function Wn(){let i=await X.LocalStorage.getItem("avifEncoderPath"),e=await X.LocalStorage.getItem("avifDecoderPath");if(!i||!e)try{i=(0,Jt.execSync)(`/bin/zsh -lc 'realpath "$(which avifenc)"'`).toString().trim(),e=(0,Jt.execSync)(`/bin/zsh -lc 'realpath "$(which avifdec)"'`).toString().trim()}catch(t){if(await Ql())try{return await Wn()}catch(s){console.error(s),ie("AVIF Encoder not found.",s,void 0,"Please install the libavif Homebrew formula manually and try again.")}else ie("AVIF Encoder not found.",t,void 0,"Please install the libavif Homebrew formula and try again.")}return{encoderPath:i,decoderPath:e}}var Ra=async()=>We(`use framework "AppKit"
      use framework "PDFKit"
      
      set pb to current application's NSPasteboard's generalPasteboard()
      set theItems to pb's readObjectsForClasses:({current application's NSURL, current application's NSImage, current application's NSAttributedString}) options:{}
      
      set theImages to {}
      repeat with i from 0 to ((theItems's |count|()) - 1)
        set theItem to (theItems's objectAtIndex:i)
        if (theItem's |class|()) is current application's NSImage then
          copy theItem to end of theImages
        else if (theItem's |class|()) is current application's NSURL then
          if (theItem's absoluteString() as text) ends with ".pdf" then
            set theImage to (current application's PDFDocument's alloc()'s initWithURL:theItem)
          else
            set theImage to (current application's NSImage's alloc()'s initWithContentsOfURL:theItem)
          end if
          if theImage is not missing value then
            copy theImage to end of theImages
          end if
        else if (theItem's |class|()) is current application's NSConcreteAttributedString then
          repeat with i from 0 to ((theItem's |length|()) - 1)
            set attrs to (theItem's attributesAtIndex:i longestEffectiveRange:(missing value) inRange:{i, (theItem's |length|()) - i})
            set theAttachment to (attrs's objectForKey:"NSAttachment")
            if theAttachment is not missing value then
              set cell to theAttachment's attachmentCell()
              set theImage to cell's image()
              copy theImage to end of theImages
            end if
          end repeat
        end if
      end repeat
      
      set tempDir to current application's NSTemporaryDirectory() as text
      set filePaths to {}
      repeat with i from 1 to count theImages
        set theImage to item i of theImages
        set theFile to tempDir & "clipboardImage_" & i
        if theImage's |class|() is current application's PDFDocument then
          set theFile to theFile & ".pdf"
          (theImage's writeToFile:theFile)
        else
          set theFile to theFile & ".png"
          set theTIFFData to theImage's TIFFRepresentation()
          set theBitmap to (current application's NSBitmapImageRep's alloc()'s initWithData:theTIFFData)
          set thePNGData to (theBitmap's representationUsingType:(current application's NSBitmapImageFileTypePNG) |properties|:(current application's NSDictionary's alloc()'s init()))
          (thePNGData's writeToFile:theFile atomically:false)
        end if
        copy theFile to end of filePaths
      end repeat
      
      return filePaths`),$a=async i=>{let e=Array.isArray(i)?i:[i];await We(`use framework "Foundation"
      use framework "PDFKit"
      use scripting additions
  
      set thePasteboard to current application's NSPasteboard's generalPasteboard()
      thePasteboard's clearContents()
      
      -- Handle PDFs separately
      set pdfPaths to {"${e.filter(t=>t.endsWith(".pdf")).join('", "')}"}
  
      set pdfItems to current application's NSMutableArray's alloc()'s init()
      repeat with pdfPath in pdfPaths
        if length of pdfPath is not 0 then
          set pdfItem to current application's NSPasteboardItem's alloc()'s init()
          set pdfData to current application's NSData's dataWithContentsOfFile:pdfPath
          pdfItem's setData:pdfData forType:(current application's NSPasteboardTypePDF)
          pdfItems's addObject:pdfItem
        end if
      end repeat
  
      if pdfItems's |count|() > 0 then
        thePasteboard's writeObjects:pdfItems
      end if
        
      -- Handle all other image types
      set theFiles to {"${e.join('", "')}"}
    
      set theImages to {}
      repeat with theFile in theFiles
        if length of theFile is not 0 then
          set theImage to (current application's NSImage's alloc()'s initWithContentsOfFile:theFile)
          if theImage is not missing value then
            copy theImage to end of theImages
          end if
        end if
      end repeat
      
      if (count theImages) > 0 then
        thePasteboard's writeObjects:theImages
      end if`)};var _t=p(require("path"));var sr=require("child_process");function kt(i,e){let t=e?.command,s=e?.language,r=[...e?.leadingArgs?.map(h=>h.toString())||[]],n=e?.trailingArgs||[];!t&&(s===void 0||s==="AppleScript"||s==="JXA")&&(t="/usr/bin/osascript",r.push("-l",s==="JXA"?"JavaScript":"AppleScript",...i.startsWith("/")?[]:["-e"],i,...n.map(h=>h.toString())));let o=process.env;if(e?.command&&(o.PATH=`${o.PATH}:${(0,sr.execSync)(`$(/bin/bash -lc 'echo $SHELL') -lc 'echo "$PATH"'`).toString()}`,t=e.command,r.push(i,...n.map(h=>h.toString()))),!t)throw new Error("No command specified.");let a="",c=h=>{console.log(h)},l=(0,sr.spawn)(t,r,{env:o});return e?.logDebugMessages&&console.log(`Running shell command "${t} ${r.join(" ")}"`),l.stdout?.on("data",h=>{a+=h.toString(),e?.logIntermediateOutput&&console.log(`Data from script: ${a}`)}),l.stderr?.on("data",h=>{e?.stderrCallback&&e.stderrCallback(h.toString()),e?.logErrors&&console.error(h.toString())}),l.stdin.on("error",h=>{e?.logErrors&&console.error(`Error writing to stdin: ${h}`)}),c=async h=>{h?.length>0&&(l.stdin.cork(),l.stdin.write(`${h}\r
`),process.nextTick(()=>l.stdin.uncork()),e?.logSentMessages&&console.log(`Sent message: ${h}`))},{data:(async()=>new Promise((h,m)=>{let E=e?.timeout?setTimeout(()=>{try{l.kill()}catch(T){e?.logErrors&&console.error(`Error killing process: ${T}`)}return e?.logErrors&&console.error("Script timed out"),l.stdin.end(),l.kill(),m("Script timed out")},e?.timeout):void 0;l.on("close",T=>{if(T!==0)return e?.logErrors&&console.error(`Script exited with code ${T}`),l.stdin.end(),l.kill(),m(`Script exited with code ${T}`);clearTimeout(E);let S;try{S=JSON.parse(a)}catch{S=a.trim()}return e?.logFinalOutput&&console.log(`Script output: ${S}`),h(S)})}))(),sendMessage:c}}var At=require("@raycast/api");async function Ta(){let i=_t.default.join(At.environment.assetsPath,"scripts","finder.scpt"),e=await kt(i,{language:"AppleScript",stderrCallback:t=>ie("Finder Selection Error",new Error(t))}).data;return Array.isArray(e)?e:e.split(",").map(t=>t.trim())}async function ka(){let i=_t.default.join(At.environment.assetsPath,"scripts","houdahSpot.scpt"),e=await kt(i,{language:"AppleScript",stderrCallback:t=>ie("HoudahSpot Selection Error",new Error(t))}).data;return Array.isArray(e)?e:e.split(",").map(t=>t.trim())}async function _a(){let i=_t.default.join(At.environment.assetsPath,"scripts","neofinder.scpt"),e=await kt(i,{language:"AppleScript",stderrCallback:t=>ie("NeoFinder Selection Error",new Error(t))}).data;return Array.isArray(e)?e:e.split(",").map(t=>t.trim())}async function Aa(){let i=_t.default.join(At.environment.assetsPath,"scripts","pathfinder.scpt"),e=await kt(i,{language:"JXA",stderrCallback:t=>ie("Path Finder Selection Error",new Error(t))}).data;return Array.isArray(e)?e:e.split(",").map(t=>t.trim())}async function Oa(){let i=_t.default.join(At.environment.assetsPath,"scripts","qspace.scpt"),e=await kt(i,{language:"JXA",stderrCallback:t=>ie("QSpace Pro Selection Error",new Error(t))}).data;return Array.isArray(e)?e:e.split(",").map(t=>t.trim())}async function va(){let i=_t.default.join(At.environment.assetsPath,"scripts","forklift-beta.scpt"),e=await kt(i,{language:"JXA",stderrCallback:t=>ie("ForkLift Selection Error",new Error(t))}).data;return Array.isArray(e)?e:e.split(",").map(t=>t.trim())}var jn=async(i,e)=>{let t=C.default.join(Te.tmpdir(),`${i}.${e}`);return{path:t,[Symbol.asyncDispose]:async()=>{M.existsSync(t)&&await M.promises.rm(t,{recursive:!0})}}};var rr=async()=>{let e=(await d.LocalStorage.getItem("itemsToRemove")??"").toString().split(", ");for(let t of e)M.existsSync(t)&&await M.promises.rm(t,{recursive:!0});await d.LocalStorage.removeItem("itemsToRemove")},Pa=async()=>{let i=[],t=(0,d.getPreferenceValues)().inputMethod,s=!1;if(t=="Clipboard")try{let o=(await Ra()).split(", ");if(await d.LocalStorage.setItem("itemsToRemove",o.join(", ")),o.filter(a=>a.trim().length>0).length>0)return o}catch(o){console.error(`Couldn't get images from clipboard: ${o}`),s=!0}let r=t;try{r=(await(0,d.getFrontmostApplication)()).name}catch(o){console.error(`Couldn't get frontmost application: ${o}`)}try{(t=="Path Finder"||r=="Path Finder")&&(i=await Aa())}catch(o){console.error(`Couldn't get images from Path Finder: ${o}`),s=!0}try{(t=="NeoFinder"||r=="NeoFinder")&&(i=await _a())}catch(o){console.error(`Couldn't get images from NeoFinder: ${o}`),s=!0}try{(t=="HoudahSpot"||r=="HoudahSpot")&&(i=await ka())}catch(o){console.error(`Couldn't get images from HoudahSpot: ${o}`),s=!0}try{(t=="QSpace Pro"||r=="QSpace Pro")&&(i=await Oa())}catch(o){console.error(`Couldn't get images from QSpace Pro: ${o}`),s=!0}try{(t=="ForkLift"||r=="ForkLift")&&(i=await va())}catch(o){console.error(`Couldn't get images from ForkLift: ${o}`),s=!0}if(i.length>0)return i.filter((o,a)=>i.indexOf(o)===a);let n=await Ta();return r=="Finder"||t=="Finder"||s?i=n:n.forEach(o=>{o.split("/").at(-2)=="Desktop"&&!i.includes(o)&&i.push(o)}),i.filter((o,a)=>i.indexOf(o)===a)},Da=async i=>{let e="Finder";try{e=(await(0,d.getFrontmostApplication)()).name}catch(s){console.error(`Couldn't get frontmost application: : ${s}`)}let t=(0,d.getPreferenceValues)();t.imageResultHandling=="copyToClipboard"?(await $a(i),Ia(i)):t.imageResultHandling=="openInPreview"?(await rh(i),Ia(i)):t.inputMethod=="NeoFinder"||e=="NeoFinder"?await(0,d.showInFinder)(i[0]):(t.inputMethod=="HoudahSpot"||e=="HoudahSpot")&&await(0,d.showInFinder)(i[0])},ih=async()=>(Te.cpus()[0].model.includes("Apple")?"arm":"x86")=="arm"?((0,je.execSync)(`chmod +x ${d.environment.assetsPath}/webp/arm/dwebp`),(0,je.execSync)(`chmod +x ${d.environment.assetsPath}/webp/arm/cwebp`),M.existsSync(`${d.environment.assetsPath}/webp/x86/dwebp`)&&await M.promises.rm(`${d.environment.assetsPath}/webp/x86/dwebp`),M.existsSync(`${d.environment.assetsPath}/webp/x86/cwebp`)&&await M.promises.rm(`${d.environment.assetsPath}/webp/x86/cwebp`),[`${d.environment.assetsPath}/webp/arm/dwebp`,`${d.environment.assetsPath}/webp/arm/cwebp`]):((0,je.execSync)(`chmod +x ${d.environment.assetsPath}/webp/x86/dwebp`),(0,je.execSync)(`chmod +x ${d.environment.assetsPath}/webp/x86/cwebp`),M.existsSync(`${d.environment.assetsPath}/webp/arm/dwebp`)&&await M.promises.rm(`${d.environment.assetsPath}/webp/arm/dwebp`),M.existsSync(`${d.environment.assetsPath}/webp/arm/cwebp`)&&await M.promises.rm(`${d.environment.assetsPath}/webp/arm/cwebp`),[`${d.environment.assetsPath}/webp/x86/dwebp`,`${d.environment.assetsPath}/webp/x86/cwebp`]),Fa=async(i,e)=>{var a=[];try{let t=(0,d.getPreferenceValues)();let s=zi(a,await jn("tmp","png"),!0);let r=(await Mi([e]))[0];let[n,o]=await ih();(0,je.execSync)(`${n} "${e}" -o "${s.path}" && ${i} "${s.path}" && ${o} ${t.useLosslessConversion?"-lossless":""} "${s.path}" -o "${r}"`);return r}catch(c){var l=c,f=!0}finally{var h=Wi(a,l,f);h&&await h}},Na=async(i,e)=>{var a=[];try{let t=(0,d.getPreferenceValues)();let s=zi(a,await jn("tmp","png"),!0);let r=(await Mi([e]))[0];let{encoderPath:n,decoderPath:o}=await Wn();(0,je.execSync)(`${o} "${e}" "${s.path}" && ${i} "${s.path}" && ${n} ${t.useLosslessConversion?"-s 0 --min 0 --max 0 --minalpha 0 --maxalpha 0 --qcolor 100 --qalpha 100":""}  "${s.path}" "${r}"`);return r}catch(c){var l=c,f=!0}finally{var h=Wi(a,l,f);h&&await h}},La=async(i,e)=>{var r=[];try{let t=zi(r,await jn("tmp","bmp"),!0);let s=(await Mi([e]))[0];await sh("BMP",e,t.path);(0,je.execSync)(`chmod +x ${d.environment.assetsPath}/potrace/potrace`);(0,je.execSync)(`${i} "${t.path}" && ${d.environment.assetsPath}/potrace/potrace -s --tight -o "${s}" "${t.path}"`);return s}catch(n){var o=n,a=!0}finally{var c=Wi(r,o,a);c&&await c}},sh=async(i,e,t)=>We(`use framework "Foundation"
  use scripting additions

  -- Load SVG image from file
  set svgFilePath to "${e}"
  set svgData to current application's NSData's alloc()'s initWithContentsOfFile:svgFilePath
  
  -- Create image from SVG data
  set svgImage to current application's NSImage's alloc()'s initWithData:svgData
  
  -- Convert image to PNG data
  set tiffData to svgImage's TIFFRepresentation()
  set theBitmap to current application's NSBitmapImageRep's alloc()'s initWithData:tiffData

  try
    set pngData to theBitmap's representationUsingType:(current application's NSBitmapImageFileType${i}) |properties|:(missing value)
  on error
    set pngData to theBitmap's representationUsingType:(current application's NSBitmapImageFileTypePNG) |properties|:(missing value)
  end
  
  -- Save PNG data to file
  pngData's writeToFile:"${t}" atomically:false`);var rh=async i=>{let e=Array.isArray(i)?i:[i],t=e.some(s=>C.default.extname(s)==".svg");await We(`use framework "Foundation"
    use scripting additions
    set pageImages to {${e.map(s=>`current application's NSURL's fileURLWithPath:"${s}"`).join(", ")}}

    set workspace to current application's NSWorkspace's sharedWorkspace()
    set config to current application's NSWorkspaceOpenConfiguration's configuration()

    ${t?`tell application "Finder"
            set safariPath to POSIX path of ((application file id "com.apple.Safari") as text)
            set safariURL to current application's NSURL's fileURLWithPath:safariPath
          end tell

          workspace's openURLs:pageImages withApplicationAtURL:safariURL configuration:config completionHandler:(missing value)
          
          tell application "Safari"
            set finished to false
            set iter to 0
            repeat while ((count of windows) = 0 or finished is not true) and iter < 10
              delay 0.5
              set iter to iter + 1

              set currentStatus to true
              repeat with doc in (path of documents as list)
                repeat with thePath in {"${e.map(s=>encodeURI(`file://${s}`)).join('", "')}"}
                  if thePath is not in doc then
                    set currentStatus to false
                  end if
                end repeat
              end repeat
              set finished to currentStatus
            end repeat
          end tell
          `:`tell application "Finder"
            set previewPath to POSIX path of ((application file id "com.apple.Preview") as text)
            set previewURL to current application's NSURL's fileURLWithPath:previewPath
          end tell

          workspace's openURLs:pageImages withApplicationAtURL:previewURL configuration:config completionHandler:(missing value)
          
          tell application "Preview"
            set finished to false
            set iter to 0
            repeat while ((count of windows) = 0 or finished is not true) and iter < 10
              delay 0.5
              set iter to iter + 1

              set currentStatus to true
              repeat with doc in (path of documents as list)
                repeat with thePath in {"${e.join('", "')}"}
                  if thePath is not in doc then
                    set currentStatus to false
                  end if
                end repeat
              end repeat
              set finished to currentStatus
            end repeat
          end tell`}`)},Ia=i=>{let e=Array.isArray(i)?i:[i];for(let t of e)M.unlinkSync(t)},nh=async()=>We(`use framework "Foundation"
    use scripting additions
    set workspace to current application's NSWorkspace's sharedWorkspace()
    set runningApps to workspace's runningApplications()
    
    set targetApp to missing value
    repeat with theApp in runningApps
      if theApp's ownsMenuBar() then
        set targetApp to theApp
        exit repeat
      end if
    end repeat
    
    if targetApp is missing value then
      return "Finder"
    else
      return targetApp's localizedName() as text
    end if`),oh=async i=>{let e="Finder";try{e=await nh()}catch(t){console.error(`Couldn't get frontmost application: ${t}`)}try{if(e=="Path Finder")return We(`tell application "Path Finder"
        if 1 \u2264 (count finder windows) then
          try
          get POSIX path of (target of finder window 1)
          on error message number -1728
            -- Folder is nonstandard, use container of selection
            tell application "System Events"
              set itemPath to POSIX file "${i}" as alias
              return POSIX path of container of itemPath
            end tell
          end try
        else
          get POSIX path of desktop
        end if
      end tell`)}catch(t){console.error(`Couldn't get current directory of Path Finder: ${t}`)}return We(`tell application "Finder"
    if 1 \u2264 (count Finder windows) then
      try
        return POSIX path of (target of window 1 as alias)
      on error message number -1700
        -- Folder is nonstandard, use container of selection
        set itemPath to POSIX file "${i}" as alias
        return POSIX path of (container of itemPath as alias)
      end try
    else
      return POSIX path of (desktop as alias)
    end if
  end tell`)},Mi=async(i,e=!1,t=void 0)=>{let s=(0,d.getPreferenceValues)(),r=await oh(i[0]);return i.map(n=>{let o=n;if(s.imageResultHandling=="saveToDownloads"?o=C.default.join(Te.homedir(),"Downloads",C.default.basename(o)):s.imageResultHandling=="saveToDesktop"?o=C.default.join(Te.homedir(),"Desktop",C.default.basename(o)):(s.imageResultHandling=="saveInContainingFolder"||s.imageResultHandling=="replaceOriginal")&&(s.inputMethod=="Clipboard"||e)?o=C.default.join(r,C.default.basename(o)):(s.imageResultHandling=="copyToClipboard"||s.imageResultHandling=="openInPreview")&&(o=C.default.join(Te.tmpdir(),C.default.basename(o))),o=t?o.replace(C.default.extname(o),`.${t}`):o,s.imageResultHandling!="replaceOriginal"&&Te.tmpdir()!=C.default.dirname(o)){let a=2;for(;M.existsSync(o);)o=C.default.join(C.default.dirname(o),C.default.basename(o,C.default.extname(o))+`-${a}${C.default.extname(o)}`),a++}return o})},ie=async(i,e,t,s)=>{console.error(e),t?(t.title=i,t.message=s??e.message,t.style=d.Toast.Style.Failure,t.primaryAction={title:"Copy Error",onAction:async()=>{await d.Clipboard.copy(e.message)}}):t=await(0,d.showToast)({title:i,message:s??e.message,style:d.Toast.Style.Failure,primaryAction:{title:"Copy Error",onAction:async()=>{await d.Clipboard.copy(e.message)}}})};var Ca=i=>{let e=Te.homedir();if(i.startsWith("~"))return i.replace(/^~(?=$|\/|\\)/,e);let t=/(\/Users\/.*?)\/.*/,s=i.match(t);return s?i.replace(s[1],e):i};async function Hn(i){if(i.selectedImages.length===0||i.selectedImages.length===1&&i.selectedImages[0]===""){await(0,Ot.showToast)({title:"No images selected",message:"No images found in your selection. Make sure the image(s) still exist on the disk. If using a third-party file manager, make sure the app's index is up to date.",style:Ot.Toast.Style.Failure});return}let e=await(0,Ot.showToast)({title:i.inProgressMessage,style:Ot.Toast.Style.Animated}),t=`image${i.selectedImages.length===1?"":"s"}`;try{let s=await i.operation();return e.title=`${i.successMessage} ${i.selectedImages.length.toString()} ${t}`,e.style=Ot.Toast.Style.Success,s}catch(s){await ie(`${i.failureMessage} ${i.selectedImages.length.toString()} ${t}`,s,e)}finally{await rr()}}var nr=require("child_process"),Ui=require("@raycast/api");async function Vn(i,e){let t=(0,Ui.getPreferenceValues)(),s=i.map(a=>Ca(a)),r=await Mi(s),n=[],o=e==="path"?"exiftool":`"${Ui.environment.supportPath}/exiftool/exiftool"`;e==="support"&&(0,nr.execSync)(`chmod +x "${Ui.environment.supportPath}/exiftool/exiftool"`);for(let a of s)if(a.toLowerCase().endsWith(".webp"))n.push(await Fa(`${o} -all= "${a}"`,a));else if(a.toLowerCase().endsWith(".svg"))n.push(await La(`${o} -all= "${a}"`,a));else if(a.toLowerCase().endsWith(".avif"))n.push(await Na(`${o} -all= "${a}" -overwrite_original`,a));else{let c=r[s.indexOf(a)];n.push(c),t.imageResultHandling==="replaceOriginal"?(0,nr.execSync)(`${o} -all= "${a}" -overwrite_original`):(0,nr.execSync)(`${o} -all= -o "${c}" "${a}"`)}return await Da(n),await rr(),n}async function za(){let i=ke.existsSync(`${w.environment.supportPath}/Image-ExifTool-12.74`);if(await(0,w.confirmAlert)({title:"Install ExifTool",message:i?`A new version of ExifTool is required to strip EXIF data. Would you like to install it now?

This will use 30.2 MB of disk space.`:"ExifTool is required to strip EXIF data. Would you like to install it now?",primaryAction:{title:"Install"}})){if(i){let o=await(0,w.showToast)({title:"Removing old version...",style:w.Toast.Style.Animated});await ke.promises.rmdir(`${w.environment.supportPath}/Image-ExifTool-12.74`,{recursive:!0}),o.title="Old version removed",o.style=w.Toast.Style.Success}let e=await(0,w.showToast)({title:"Installing ExifTool...",style:w.Toast.Style.Animated}),t=w.environment.supportPath,s="https://exiftool.org/Image-ExifTool-13.21.tar.gz",r="c009024d0405ddc12fb448f0d3b2acc63ed5d87d55bf1f242522f22f0a03985c",n=!0;for(Ua.get(s,async o=>{let c=Ba.default.join(t,"Image-ExifTool-13.21.tar.gz"),l=ke.createWriteStream(c);o.pipe(l);let f=!1,h=Ma.createHash("sha256");o.on("data",m=>h.update(m)),o.on("end",async()=>{if(h.digest("hex")!==r){e.title="Checksum verification failed",e.style=w.Toast.Style.Failure,n=!1;return}f=!0}),l.on("finish",async()=>{l.close(),f&&(await Dn({file:`${t}/Image-ExifTool-13.21.tar.gz`,cwd:t}),await ke.promises.rename(`${t}/Image-ExifTool-13.21`,`${t}/exiftool`),await w.LocalStorage.setItem("exifToolLocation","support"),n=!1,e.title="Done!",e.style=w.Toast.Style.Success),await ke.promises.unlink(c)})});n;)await new Promise(o=>setTimeout(o,1e3))}else await w.LocalStorage.removeItem("exifToolLocation")}async function Gn(){try{(0,Kn.execSync)("exiftool -ver"),await w.LocalStorage.setItem("exifToolLocation","path")}catch{await za()}}async function Wa(){let i=await w.LocalStorage.getItem("exifToolLocation");if(i!=="path"&&(i!=="support"||!ke.existsSync(`${w.environment.supportPath}/exiftool/exiftool`))&&(ke.existsSync(`${w.environment.supportPath}/exiftool/exiftool`)?await w.LocalStorage.setItem("exifToolLocation","support"):await Gn()),i==="path")try{return(0,Kn.execSync)("exiftool -ver"),"path"}catch{await Gn()}return await w.LocalStorage.getItem("exifToolLocation")}async function ja(){let i=await Pa(),e=await Wa();if(!e){await(0,w.showToast)({title:"Command Cancelled",message:"ExifTool is required to strip EXIF data.",style:w.Toast.Style.Failure});return}await Hn({operation:()=>Vn(i,e),selectedImages:i,inProgressMessage:"Sanitizing...",successMessage:"Sanitized",failureMessage:"Failed to sanitize"})}0&&(module.exports={getExifToolLocation,installExifTool,setExifToolLocation});
